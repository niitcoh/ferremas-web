{
  "public": {
    "index.html": "<!DOCTYPE html>\r\n<html lang=\"es\">\r\n<head>\r\n  <meta charset=\"UTF-8\">\r\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\r\n  <title>FERREMAS | Ferretería y Materiales</title>\r\n  <link href=\"https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css\" rel=\"stylesheet\">\r\n  <link rel=\"stylesheet\" href=\"https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css\" />\r\n  <link rel=\"stylesheet\" href=\"/styles.css\">\r\n</head>\r\n<body>\r\n  <!-- Barra superior -->\r\n  <div class=\"bg-dark text-white py-2\">\r\n    <div class=\"container d-flex justify-content-between align-items-center\">\r\n      <small>Envío gratuito en compras sobre $50.000</small>\r\n      <div>\r\n        <small class=\"me-3\">\r\n          <i class=\"fas fa-home me-1\"></i>\r\n          Santiago, Chile\r\n        </small>\r\n        <small>\r\n          <i class=\"fas fa-phone me-1\"></i>+56 2 2345 6789\r\n        </small>\r\n      </div>\r\n    </div>\r\n  </div>\r\n\r\n  <!-- Navbar -->\r\n  <nav class=\"navbar navbar-expand-lg navbar-dark bg-primary py-3\">\r\n    <div class=\"container\">\r\n      <a class=\"navbar-brand\" href=\"/\">\r\n        <img src=\"https://placehold.co/150x50/primary/white?text=FERREMAS\" alt=\"FERREMAS\" height=\"40\">\r\n      </a>\r\n      <button class=\"navbar-toggler\" type=\"button\" data-bs-toggle=\"collapse\" data-bs-target=\"#navbarNav\">\r\n        <span class=\"navbar-toggler-icon\"></span>\r\n      </button>\r\n      <div class=\"collapse navbar-collapse\" id=\"navbarNav\">\r\n        <ul class=\"navbar-nav me-auto\">\r\n          <li class=\"nav-item\">\r\n            <a class=\"nav-link mx-2 active\" href=\"/\">Inicio</a>\r\n          </li>\r\n          <li class=\"nav-item dropdown\">\r\n            <a class=\"nav-link dropdown-toggle mx-2\" href=\"#\" role=\"button\" data-bs-toggle=\"dropdown\">\r\n              Categorías\r\n            </a>\r\n            <ul class=\"dropdown-menu\" id=\"categorias-menu\">\r\n              <!-- Las categorías se cargarán dinámicamente aquí -->\r\n              <li><hr class=\"dropdown-divider\"></li>\r\n              <li><a class=\"dropdown-item\" href=\"/productos\">Ver todos los productos</a></li>\r\n            </ul>\r\n          </li>\r\n          <li class=\"nav-item\">\r\n            <a class=\"nav-link mx-2\" href=\"/ofertas\">Ofertas</a>\r\n          </li>\r\n          <li class=\"nav-item\">\r\n            <a class=\"nav-link mx-2\" href=\"/contacto\">Contacto</a>\r\n          </li>\r\n        </ul>\r\n        <ul class=\"navbar-nav ms-auto\">\r\n          <li class=\"nav-item\">\r\n            <a class=\"nav-link mx-2\" href=\"/carrito\" id=\"cart-link\">\r\n              <i class=\"fas fa-shopping-cart me-1\"></i> Carrito\r\n            </a>\r\n          </li>\r\n          <li class=\"nav-item\" id=\"login-item\">\r\n            <a class=\"nav-link mx-2\" href=\"/login\">\r\n              <i class=\"fas fa-user me-1\"></i> Iniciar Sesión\r\n            </a>\r\n          </li>\r\n          <li class=\"nav-item dropdown d-none\" id=\"user-dropdown\">\r\n            <a class=\"nav-link dropdown-toggle mx-2\" href=\"#\" role=\"button\" data-bs-toggle=\"dropdown\">\r\n              <i class=\"fas fa-user-circle me-1\"></i> <span id=\"user-name\">Usuario</span>\r\n            </a>\r\n            <ul class=\"dropdown-menu dropdown-menu-end\">\r\n              <li><a class=\"dropdown-item\" href=\"/profile\">Mi Perfil</a></li>\r\n              <li><a class=\"dropdown-item\" href=\"/profile#pedidos\">Mis Pedidos</a></li>\r\n              <li><hr class=\"dropdown-divider\"></li>\r\n              <li><a class=\"dropdown-item text-danger\" href=\"#\" id=\"logout-link\">Cerrar Sesión</a></li>\r\n            </ul>\r\n          </li>\r\n        </ul>\r\n      </div>\r\n    </div>\r\n  </nav>\r\n\r\n  <!-- Contenido principal -->\r\n  <main>\r\n    <!-- Carrusel -->\r\n    <div id=\"mainCarousel\" class=\"carousel slide\" data-bs-ride=\"carousel\">\r\n      <div class=\"carousel-inner\">\r\n        <div class=\"carousel-item active\">\r\n          <img src=\"https://placehold.co/1200x400/222/white?text=Ofertas+Especiales\" class=\"d-block w-100\" alt=\"Ofertas Especiales\">\r\n          <div class=\"carousel-caption\">\r\n            <h3>Ofertas Especiales</h3>\r\n            <p>Descuentos de hasta 40% en herramientas seleccionadas</p>\r\n            <a href=\"/ofertas\" class=\"btn btn-primary\">Ver Ofertas</a>\r\n          </div>\r\n        </div>\r\n        <div class=\"carousel-item\">\r\n          <img src=\"https://placehold.co/1200x400/222/white?text=Nuevos+Productos\" class=\"d-block w-100\" alt=\"Nuevos Productos\">\r\n          <div class=\"carousel-caption\">\r\n            <h3>Nuevos Productos</h3>\r\n            <p>Conoce nuestras últimas novedades en artículos de ferretería</p>\r\n            <a href=\"/productos\" class=\"btn btn-primary\">Ver Productos</a>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n\r\n    <div class=\"container py-5\">\r\n      <!-- Categorías -->\r\n      <section id=\"categorias-principales\">\r\n        <h2 class=\"text-center mb-4\">Categorías Principales</h2>\r\n        <div class=\"row g-4 mb-5\">\r\n          <!-- Las categorías se cargarán dinámicamente aquí -->\r\n        </div>\r\n      </section>\r\n\r\n      <!-- Productos Destacados -->\r\n      <section id=\"productos-destacados\">\r\n        <h2 class=\"text-center mb-4\">Productos Destacados</h2>\r\n        <div class=\"row g-4 mb-5\">\r\n          <!-- Los productos destacados se cargarán dinámicamente aquí -->\r\n        </div>\r\n      </section>\r\n\r\n      <!-- Beneficios -->\r\n      <h2 class=\"text-center mb-4\">¿Por qué elegirnos?</h2>\r\n      <div class=\"row g-4 mb-5 text-center\">\r\n        <div class=\"col-md-3\">\r\n          <div class=\"p-3\">\r\n            <img src=\"https://placehold.co/100/007bff/white?text=Envío\" alt=\"Envío\" class=\"mb-3\" width=\"100\" height=\"100\">\r\n            <h5>Envío Rápido</h5>\r\n            <p>Entrega en todo Chile</p>\r\n          </div>\r\n        </div>\r\n        <div class=\"col-md-3\">\r\n          <div class=\"p-3\">\r\n            <img src=\"https://placehold.co/100/007bff/white?text=Calidad\" alt=\"Calidad\" class=\"mb-3\" width=\"100\" height=\"100\">\r\n            <h5>Productos de Calidad</h5>\r\n            <p>Las mejores marcas</p>\r\n          </div>\r\n        </div>\r\n        <div class=\"col-md-3\">\r\n          <div class=\"p-3\">\r\n            <img src=\"https://placehold.co/100/007bff/white?text=Atención\" alt=\"Atención\" class=\"mb-3\" width=\"100\" height=\"100\">\r\n            <h5>Atención Personalizada</h5>\r\n            <p>Asesores especializados</p>\r\n          </div>\r\n        </div>\r\n        <div class=\"col-md-3\">\r\n          <div class=\"p-3\">\r\n            <img src=\"https://placehold.co/100/007bff/white?text=Seguridad\" alt=\"Seguridad\" class=\"mb-3\" width=\"100\" height=\"100\">\r\n            <h5>Compra Segura</h5>\r\n            <p>Pagos protegidos</p>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </main>\r\n\r\n  <!-- Footer -->\r\n  <footer class=\"bg-dark text-light py-4 mt-5\">\r\n    <div class=\"container\">\r\n      <div class=\"row\">\r\n        <div class=\"col-md-4 mb-4 mb-md-0\">\r\n          <h5>FERREMAS</h5>\r\n          <p class=\"text-muted\">\r\n            Empresa chilena de productos de ferretería y construcción, \r\n            establecida desde la década de los 80 con más de 7 sucursales \r\n            en todo el país.\r\n          </p>\r\n        </div>\r\n        <div class=\"col-md-3 mb-4 mb-md-0\">\r\n          <h5>Enlaces Rápidos</h5>\r\n          <ul class=\"list-unstyled\">\r\n            <li><a href=\"/\" class=\"text-muted\">Inicio</a></li>\r\n            <li><a href=\"/productos\" class=\"text-muted\">Productos</a></li>\r\n            <li><a href=\"/ofertas\" class=\"text-muted\">Ofertas</a></li>\r\n            <li><a href=\"/contacto\" class=\"text-muted\">Contacto</a></li>\r\n          </ul>\r\n        </div>\r\n        <div class=\"col-md-3 mb-4 mb-md-0\">\r\n          <h5>Categorías</h5>\r\n          <ul class=\"list-unstyled\" id=\"footer-categorias\">\r\n            <!-- Las categorías se cargarán dinámicamente aquí -->\r\n          </ul>\r\n        </div>\r\n        <div class=\"col-md-2\">\r\n          <h5>Contacto</h5>\r\n          <ul class=\"list-unstyled\">\r\n            <li class=\"mb-2\">\r\n              <i class=\"fas fa-map-marker-alt me-2\"></i>\r\n              <span class=\"text-muted\">Santiago, Chile</span>\r\n            </li>\r\n            <li class=\"mb-2\">\r\n              <i class=\"fas fa-phone me-2\"></i>\r\n              <span class=\"text-muted\">+56 2 2345 6789</span>\r\n            </li>\r\n            <li>\r\n              <i class=\"fas fa-envelope me-2\"></i>\r\n              <span class=\"text-muted\">contacto@ferremas.cl</span>\r\n            </li>\r\n          </ul>\r\n        </div>\r\n      </div>\r\n      <hr class=\"my-4 bg-secondary\">\r\n      <div class=\"row\">\r\n        <div class=\"col text-center text-muted\">\r\n          <p class=\"mb-0\">© 2025 FERREMAS. Todos los derechos reservados.</p>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </footer>\r\n\r\n  <!-- Scripts -->\r\n  <script src=\"https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js\"></script>\r\n  <script src=\"/js/auth.js\"></script>\r\n  <script src=\"/js/productos.js\"></script>\r\n  <script src=\"/script.js\"></script>\r\n  <script src=\"/js/home.js\"></script>\r\n</body>\r\n</html>",
    "js": {
      "auth.js": "const API_URL = 'http://localhost:3003/api'; // URL base de la API de usuarios\r\n\r\n// Función para registrar un nuevo usuario\r\nasync function registrarUsuario(userData) {\r\n  try {\r\n    console.log('Enviando datos de registro:', userData);\r\n    \r\n    const response = await fetch(`${API_URL}/auth/register`, {\r\n      method: 'POST',\r\n      headers: {\r\n        'Content-Type': 'application/json'\r\n      },\r\n      body: JSON.stringify(userData)\r\n    });\r\n    \r\n    const data = await response.json();\r\n    \r\n    if (!response.ok) {\r\n      throw new Error(data.message || 'Error al registrar usuario');\r\n    }\r\n    \r\n    // Guardar token en localStorage\r\n    localStorage.setItem('authToken', data.token);\r\n    localStorage.setItem('userData', JSON.stringify(data.usuario));\r\n    \r\n    return data;\r\n  } catch (error) {\r\n    console.error('Error en registro:', error);\r\n    throw error;\r\n  }\r\n}\r\n\r\n// Función para iniciar sesión\r\nasync function iniciarSesion(credentials) {\r\n  try {\r\n    console.log('Iniciando sesión con:', credentials.email);\r\n    \r\n    const response = await fetch(`${API_URL}/auth/login`, {\r\n      method: 'POST',\r\n      headers: {\r\n        'Content-Type': 'application/json'\r\n      },\r\n      body: JSON.stringify(credentials)\r\n    });\r\n    \r\n    const data = await response.json();\r\n    \r\n    if (!response.ok) {\r\n      throw new Error(data.message || 'Credenciales inválidas');\r\n    }\r\n    \r\n    // Guardar token en localStorage\r\n    localStorage.setItem('authToken', data.token);\r\n    localStorage.setItem('userData', JSON.stringify(data.usuario));\r\n    \r\n    return data;\r\n  } catch (error) {\r\n    console.error('Error en login:', error);\r\n    throw error;\r\n  }\r\n}\r\n\r\n// Función para cerrar sesión\r\nfunction cerrarSesion() {\r\n  localStorage.removeItem('authToken');\r\n  localStorage.removeItem('userData');\r\n  window.location.href = '/';\r\n}\r\n\r\n// Función para verificar si el usuario está autenticado\r\nfunction estaAutenticado() {\r\n  const token = localStorage.getItem('authToken');\r\n  return !!token;\r\n}\r\n\r\n// Función para obtener datos del usuario en sesión\r\nfunction getUsuarioActual() {\r\n  const userData = localStorage.getItem('userData');\r\n  return userData ? JSON.parse(userData) : null;\r\n}\r\n\r\n// Función para actualizar perfil de usuario\r\nasync function actualizarPerfil(userId, userData) {\r\n  try {\r\n    const token = localStorage.getItem('authToken');\r\n    \r\n    const response = await fetch(`${API_URL}/usuarios/${userId}`, {\r\n      method: 'PUT',\r\n      headers: {\r\n        'Content-Type': 'application/json',\r\n        'Authorization': `Bearer ${token}`\r\n      },\r\n      body: JSON.stringify(userData)\r\n    });\r\n    \r\n    const data = await response.json();\r\n    \r\n    if (!response.ok) {\r\n      throw new Error(data.message || 'Error al actualizar perfil');\r\n    }\r\n    \r\n    // Actualizar datos en localStorage\r\n    const currentUser = JSON.parse(localStorage.getItem('userData'));\r\n    const updatedUser = {...currentUser, ...userData};\r\n    localStorage.setItem('userData', JSON.stringify(updatedUser));\r\n    \r\n    return data;\r\n  } catch (error) {\r\n    console.error('Error al actualizar perfil:', error);\r\n    throw error;\r\n  }\r\n}\r\n\r\n// Función para validar el token\r\nasync function validarToken() {\r\n  try {\r\n    const token = localStorage.getItem('authToken');\r\n    \r\n    if (!token) {\r\n      return false;\r\n    }\r\n    \r\n    const response = await fetch(`${API_URL}/auth/validate-token`, {\r\n      method: 'GET',\r\n      headers: {\r\n        'Authorization': `Bearer ${token}`\r\n      }\r\n    });\r\n    \r\n    if (!response.ok) {\r\n      cerrarSesion();\r\n      return false;\r\n    }\r\n    \r\n    return true;\r\n  } catch (error) {\r\n    console.error('Error al validar token:', error);\r\n    cerrarSesion();\r\n    return false;\r\n  }\r\n}",
      "config.js": "// Configuración global para la aplicación\r\nconst CONFIG = {\r\n  // Configuración de la API\r\n  API: {\r\n    // URL base de la API (actualizado al puerto correcto)\r\n    BASE_URL: 'http://localhost:3001/api',\r\n    \r\n    // Endpoints principales\r\n    ENDPOINTS: {\r\n      PRODUCTOS: '/productos',\r\n      CATEGORIAS: '/categorias',\r\n      MARCAS: '/marcas',\r\n      SUBCATEGORIAS: '/subcategorias',\r\n      IMAGENES: '/imagenes'\r\n    }\r\n  },\r\n  \r\n  // Configuración del sitio\r\n  SITE: {\r\n    // Nombre del sitio\r\n    NAME: 'FERREMAS',\r\n    \r\n    // URL base para recursos estáticos (imágenes, etc.)\r\n    STATIC_URL: 'http://localhost:3001',\r\n    \r\n    // Número de productos por página\r\n    PRODUCTOS_POR_PAGINA: 12,\r\n    \r\n    // Moneda\r\n    CURRENCY: {\r\n      CODE: 'CLP',\r\n      SYMBOL: '$',\r\n      LOCALE: 'es-CL'\r\n    }\r\n  },\r\n  \r\n  // Claves para LocalStorage\r\n  STORAGE_KEYS: {\r\n    AUTH_TOKEN: 'authToken',\r\n    USER_DATA: 'userData',\r\n    CART: 'carrito'\r\n  }\r\n};\r\n\r\n// Función para obtener la URL completa de un endpoint\r\nCONFIG.getApiUrl = function(endpoint) {\r\n  return this.API.BASE_URL + endpoint;\r\n};\r\n\r\n// Función para formatear precios según la configuración\r\nCONFIG.formatPrice = function(price) {\r\n  return this.SITE.CURRENCY.SYMBOL + price.toLocaleString(this.SITE.CURRENCY.LOCALE);\r\n};\r\n\r\n// No permitir modificaciones al objeto de configuración\r\nObject.freeze(CONFIG);",
      "diagnostico.js": "async function probarConexionAPI() {\r\n  const endpoints = [\r\n    '/api',\r\n    '/api/categorias',\r\n    '/api/productos',\r\n    '/productos'\r\n  ];\r\n  \r\n  const resultados = document.getElementById('diagnostico-resultados');\r\n  resultados.innerHTML = '<h3>Probando conexiones a la API...</h3>';\r\n  \r\n  for (const endpoint of endpoints) {\r\n    try {\r\n      const response = await fetch(endpoint);\r\n      const status = response.status;\r\n      let message = '';\r\n      \r\n      try {\r\n        const data = await response.json();\r\n        message = `Respuesta: ${JSON.stringify(data).substring(0, 100)}...`;\r\n      } catch (e) {\r\n        message = 'No se pudo parsear la respuesta como JSON';\r\n      }\r\n      \r\n      resultados.innerHTML += `<div class=\"${response.ok ? 'alert alert-success' : 'alert alert-danger'}\">\r\n        <strong>${endpoint}</strong>: ${status} ${response.statusText}<br>\r\n        ${message}\r\n      </div>`;\r\n    } catch (error) {\r\n      resultados.innerHTML += `<div class=\"alert alert-danger\">\r\n        <strong>${endpoint}</strong>: Error - ${error.message}\r\n      </div>`;\r\n    }\r\n  }\r\n}\r\n\r\ndocument.addEventListener('DOMContentLoaded', function() {\r\n  const botonProbar = document.getElementById('boton-probar-api');\r\n  if (botonProbar) {\r\n    botonProbar.addEventListener('click', probarConexionAPI);\r\n  }\r\n});",
      "ferremas-api-client.js": "// FERREMAS - API Client unificado\r\n// Este archivo reemplaza productos.js, productos-page.js y config.js\r\n// Versión: 1.0.0\r\n\r\n// IIFE para evitar la contaminación del ámbito global\r\n(function() {\r\n  // Configuración base - No redefine API_URL si ya existe\r\n  const API_CONFIG = {\r\n    BASE_URL: 'http://localhost:3001',\r\n    TIMEOUT: 10000,\r\n    ENDPOINTS: {\r\n      CATEGORIAS: '/categorias',\r\n      PRODUCTOS: '/productos',\r\n      IMAGENES: '/imagenes'\r\n    }\r\n  };\r\n\r\n  // ===== FUNCIONES BASE DE API =====\r\n  \r\n  // Función para manejar errores de fetch\r\n  function handleFetchError(response) {\r\n    if (!response.ok) {\r\n      throw new Error(`Error en la petición: ${response.status} ${response.statusText}`);\r\n    }\r\n    return response.json();\r\n  }\r\n\r\n  // Función para obtener todas las categorías\r\n  async function obtenerCategorias() {\r\n    try {\r\n      console.log('Obteniendo categorías desde:', `${API_CONFIG.BASE_URL}${API_CONFIG.ENDPOINTS.CATEGORIAS}`);\r\n      const response = await fetch(`${API_CONFIG.BASE_URL}${API_CONFIG.ENDPOINTS.CATEGORIAS}`);\r\n      return handleFetchError(response);\r\n    } catch (error) {\r\n      console.error('Error al obtener categorías:', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  // Función para obtener productos con paginación\r\n  async function obtenerProductos(page = 1, limit = 12) {\r\n    try {\r\n      console.log(`Obteniendo productos página ${page} desde:`, \r\n        `${API_CONFIG.BASE_URL}${API_CONFIG.ENDPOINTS.PRODUCTOS}?page=${page}&limit=${limit}`);\r\n      const response = await fetch(`${API_CONFIG.BASE_URL}${API_CONFIG.ENDPOINTS.PRODUCTOS}?page=${page}&limit=${limit}`);\r\n      return handleFetchError(response);\r\n    } catch (error) {\r\n      console.error('Error al obtener productos:', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  // Función para obtener un producto por su ID\r\n  async function obtenerProductoPorId(id) {\r\n    try {\r\n      const response = await fetch(`${API_CONFIG.BASE_URL}${API_CONFIG.ENDPOINTS.PRODUCTOS}/${id}`);\r\n      return handleFetchError(response);\r\n    } catch (error) {\r\n      console.error(`Error al obtener producto con ID ${id}:`, error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  // Función para obtener las imágenes de un producto\r\n  async function obtenerImagenesProducto(productoId) {\r\n    try {\r\n      console.log(`Obteniendo imágenes del producto ${productoId}`);\r\n      const response = await fetch(`${API_CONFIG.BASE_URL}${API_CONFIG.ENDPOINTS.PRODUCTOS}/${productoId}/imagenes`);\r\n      return handleFetchError(response);\r\n    } catch (error) {\r\n      console.error(`Error al obtener imágenes del producto ${productoId}:`, error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  // Función para obtener la URL completa de una imagen\r\nfunction getFullImageUrl(imagen, producto) {\r\n  // Usar el mapeador de imágenes si está disponible\r\n  if (window.imagenMapper) {\r\n    return imagenMapper.getImageUrl(imagen, producto);\r\n  }\r\n  \r\n  // Implementación de respaldo para cuando el mapeador no esté disponible\r\n  \r\n  // Si recibimos un objeto imagen completo\r\n  if (imagen && typeof imagen === 'object') {\r\n    // Si tiene url, usarla\r\n    if (imagen.url) {\r\n      return getFullImageUrl(imagen.url, producto);\r\n    }\r\n    // Si no tiene ninguna URL, usar un placeholder\r\n    return `https://placehold.co/300x200/007bff/white?text=${encodeURIComponent('Producto')}`;\r\n  }\r\n  \r\n  // Si la URL es nula o vacía, devolver un placeholder\r\n  if (!imagen) {\r\n    const categoriaTexto = producto && producto.categoria_id ? `Cat ${producto.categoria_id}` : 'Producto';\r\n    return `https://placehold.co/300x200/007bff/white?text=${encodeURIComponent(categoriaTexto)}`;\r\n  }\r\n  \r\n  // Si ya es una URL completa, devolverla tal cual\r\n  if (imagen.startsWith('http://') || imagen.startsWith('https://')) {\r\n    return imagen;\r\n  }\r\n  \r\n  // Obtener solo el nombre del archivo\r\n  const nombreArchivo = imagen.split('/').pop().split('\\\\').pop();\r\n  \r\n  // Crear un placeholder con el nombre del producto o archivo\r\n  const textoProducto = producto && producto.nombre ? producto.nombre : nombreArchivo;\r\n  return `https://placehold.co/300x200/007bff/white?text=${encodeURIComponent(textoProducto)}`;\r\n}\r\n\r\n  // Función para agregar un producto al carrito\r\n  function agregarAlCarrito(id, nombre, precio, imagen) {\r\n    let carrito = JSON.parse(localStorage.getItem('carrito')) || [];\r\n    \r\n    // Verificar si el producto ya está en el carrito\r\n    const productoExistente = carrito.find(item => item.id === id);\r\n    \r\n    if (productoExistente) {\r\n      // Incrementar cantidad si ya existe\r\n      productoExistente.cantidad += 1;\r\n    } else {\r\n      // Agregar nuevo producto al carrito\r\n      carrito.push({\r\n        id,\r\n        nombre,\r\n        precio,\r\n        imagen,\r\n        cantidad: 1\r\n      });\r\n    }\r\n    \r\n    // Guardar carrito actualizado\r\n    localStorage.setItem('carrito', JSON.stringify(carrito));\r\n    \r\n    // Mostrar notificación\r\n    mostrarNotificacion(`${nombre} añadido al carrito`);\r\n    \r\n    // Actualizar contador del carrito\r\n    actualizarContadorCarrito();\r\n  }\r\n\r\n  // Función para mostrar notificación \r\n  function mostrarNotificacion(mensaje) {\r\n    // Verificar si Bootstrap está disponible\r\n    if (typeof bootstrap !== 'undefined' && bootstrap.Toast) {\r\n      // Crear elemento de notificación\r\n      const notificacion = document.createElement('div');\r\n      notificacion.className = 'toast align-items-center text-white bg-success';\r\n      notificacion.setAttribute('role', 'alert');\r\n      notificacion.setAttribute('aria-live', 'assertive');\r\n      notificacion.setAttribute('aria-atomic', 'true');\r\n      notificacion.innerHTML = `\r\n        <div class=\"d-flex\">\r\n          <div class=\"toast-body\">\r\n            ${mensaje}\r\n          </div>\r\n          <button type=\"button\" class=\"btn-close btn-close-white me-2 m-auto\" data-bs-dismiss=\"toast\" aria-label=\"Close\"></button>\r\n        </div>\r\n      `;\r\n      \r\n      // Crear contenedor si no existe\r\n      let toastContainer = document.querySelector('.toast-container');\r\n      if (!toastContainer) {\r\n        toastContainer = document.createElement('div');\r\n        toastContainer.className = 'toast-container position-fixed bottom-0 end-0 p-3';\r\n        document.body.appendChild(toastContainer);\r\n      }\r\n      \r\n      // Agregar notificación al contenedor\r\n      toastContainer.appendChild(notificacion);\r\n      \r\n      // Mostrar notificación\r\n      const toast = new bootstrap.Toast(notificacion);\r\n      toast.show();\r\n      \r\n      // Eliminar notificación después de ocultarse\r\n      notificacion.addEventListener('hidden.bs.toast', function() {\r\n        notificacion.remove();\r\n      });\r\n    } else {\r\n      // Si Bootstrap no está disponible, usar alert\r\n      alert(mensaje);\r\n    }\r\n  }\r\n\r\n  // Función para actualizar contador de carrito\r\n  function actualizarContadorCarrito() {\r\n    const carrito = JSON.parse(localStorage.getItem('carrito')) || [];\r\n    const totalItems = carrito.reduce((total, item) => total + item.cantidad, 0);\r\n    \r\n    const cartLink = document.getElementById('cart-link');\r\n    if (cartLink) {\r\n      cartLink.innerHTML = `<i class=\"fas fa-shopping-cart me-1\"></i> Carrito ${totalItems > 0 ? `(${totalItems})` : ''}`;\r\n    }\r\n  }\r\n\r\n  // ===== FUNCIONES DE LA PÁGINA DE PRODUCTOS =====\r\n\r\n  // Función para cargar categorías\r\n  async function cargarCategorias() {\r\n    try {\r\n      console.log('Cargando categorías...');\r\n      const categorias = await obtenerCategorias();\r\n      console.log('Categorías obtenidas:', categorias);\r\n      \r\n      // Verificar que tenemos categorías válidas\r\n      if (!Array.isArray(categorias)) {\r\n        throw new Error('La API no devolvió un array de categorías');\r\n      }\r\n      \r\n      // Llenar menú de categorías en navbar\r\n      const menuCategorias = document.getElementById('categorias-menu');\r\n      if (!menuCategorias) {\r\n        console.warn('Elemento categorias-menu no encontrado');\r\n        return;\r\n      }\r\n      \r\n      // Encontrar el divisor\r\n      const divider = menuCategorias.querySelector('hr');\r\n      const dividerParent = divider ? divider.parentElement : null;\r\n      \r\n      // Limpiar categorías existentes manteniendo el divisor\r\n      if (dividerParent) {\r\n        // Guardar todos los elementos del menú\r\n        const elementos = Array.from(menuCategorias.children);\r\n        // Limpiar el menú\r\n        menuCategorias.innerHTML = '';\r\n        \r\n        // Volver a añadir solo el divisor y los elementos después de él\r\n        let encontradoDivisor = false;\r\n        elementos.forEach(elemento => {\r\n          if (elemento === dividerParent) {\r\n            encontradoDivisor = true;\r\n          }\r\n          \r\n          if (encontradoDivisor) {\r\n            menuCategorias.appendChild(elemento);\r\n          }\r\n        });\r\n      }\r\n      \r\n      // Agregar nuevas categorías\r\n      categorias.forEach(categoria => {\r\n        // Verificar que la categoría tiene los datos necesarios\r\n        if (!categoria || !categoria.nombre) {\r\n          console.warn('Categoría inválida:', categoria);\r\n          return;\r\n        }\r\n        \r\n        const li = document.createElement('li');\r\n        const a = document.createElement('a');\r\n        a.className = 'dropdown-item';\r\n        a.href = `/categoria/${categoria.slug || categoria.id}`;\r\n        a.textContent = categoria.nombre;\r\n        li.appendChild(a);\r\n        \r\n        if (dividerParent) {\r\n          menuCategorias.insertBefore(li, dividerParent);\r\n        } else {\r\n          menuCategorias.appendChild(li);\r\n          \r\n          // Si no hay divisor, añadirlo después de todas las categorías\r\n          if (menuCategorias.querySelector('hr') === null) {\r\n            const dividerLi = document.createElement('li');\r\n            dividerLi.innerHTML = '<hr class=\"dropdown-divider\">';\r\n            menuCategorias.appendChild(dividerLi);\r\n            \r\n            // Y añadir el enlace \"Ver todos los productos\"\r\n            const verTodosLi = document.createElement('li');\r\n            const verTodosA = document.createElement('a');\r\n            verTodosA.className = 'dropdown-item';\r\n            verTodosA.href = '/productos';\r\n            verTodosA.textContent = 'Ver todos los productos';\r\n            verTodosLi.appendChild(verTodosA);\r\n            menuCategorias.appendChild(verTodosLi);\r\n          }\r\n        }\r\n      });\r\n      \r\n      // Llenar categorías en el footer\r\n      const footerCategorias = document.getElementById('footer-categorias');\r\n      if (footerCategorias) {\r\n        footerCategorias.innerHTML = '';\r\n        \r\n        const categoriasAMostrar = categorias.slice(0, 4);\r\n        categoriasAMostrar.forEach(categoria => {\r\n          const li = document.createElement('li');\r\n          const a = document.createElement('a');\r\n          a.href = `/categoria/${categoria.slug || categoria.id}`;\r\n          a.className = 'text-muted';\r\n          a.textContent = categoria.nombre;\r\n          li.appendChild(a);\r\n          footerCategorias.appendChild(li);\r\n        });\r\n      }\r\n      \r\n    } catch (error) {\r\n      console.error('Error al cargar categorías:', error);\r\n      mostrarErrorCategorias('No se pudieron cargar las categorías');\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  // Función para cargar productos\r\n  async function cargarProductos(page = 1) {\r\n    try {\r\n      console.log(`Cargando productos página ${page}...`);\r\n      \r\n      // Obtener elementos del DOM necesarios\r\n      const containerElement = document.getElementById('productos-container');\r\n      const loadingElement = document.getElementById('loading');\r\n      const noProductsElement = document.getElementById('no-products');\r\n      \r\n      // Verificar que existan los elementos necesarios\r\n      if (!containerElement) {\r\n        throw new Error('Elemento productos-container no encontrado');\r\n      }\r\n      \r\n      // Mostrar indicador de carga\r\n      if (loadingElement) {\r\n        loadingElement.classList.remove('d-none');\r\n      }\r\n      \r\n      // Ocultar mensaje de no productos\r\n      if (noProductsElement) {\r\n        noProductsElement.classList.add('d-none');\r\n      }\r\n      \r\n      // Limpiar contenedor de productos\r\n      containerElement.innerHTML = '';\r\n      \r\n      // Obtener ordenamiento seleccionado\r\n      const sortSelect = document.getElementById('sort-select');\r\n      const sortValue = sortSelect ? sortSelect.value : 'default';\r\n      \r\n      // Obtener productos desde la API\r\n      const resultado = await obtenerProductos(page, 12);\r\n      console.log('Productos obtenidos:', resultado);\r\n      \r\n      // Verificar que la respuesta tiene la estructura esperada\r\n      if (!resultado || !resultado.productos) {\r\n        throw new Error('Respuesta de API inválida');\r\n      }\r\n      \r\n      // Ocultar indicador de carga\r\n      if (loadingElement) {\r\n        loadingElement.classList.add('d-none');\r\n      }\r\n      \r\n      // Verificar si hay productos\r\n      if (resultado.productos.length === 0) {\r\n        if (noProductsElement) {\r\n          noProductsElement.classList.remove('d-none');\r\n        }\r\n        return;\r\n      }\r\n      \r\n      // Ordenar productos según selección\r\n      let productosOrdenados = [...resultado.productos];\r\n      switch (sortValue) {\r\n        case 'price_asc':\r\n          productosOrdenados.sort((a, b) => (a.precio_oferta || a.precio) - (b.precio_oferta || b.precio));\r\n          break;\r\n        case 'price_desc':\r\n          productosOrdenados.sort((a, b) => (b.precio_oferta || b.precio) - (a.precio_oferta || a.precio));\r\n          break;\r\n        case 'name_asc':\r\n          productosOrdenados.sort((a, b) => a.nombre.localeCompare(b.nombre));\r\n          break;\r\n        case 'name_desc':\r\n          productosOrdenados.sort((a, b) => b.nombre.localeCompare(a.nombre));\r\n          break;\r\n        default:\r\n          // Mantener orden original\r\n          break;\r\n      }\r\n      \r\n      // Crear las tarjetas de productos\r\n      productosOrdenados.forEach(producto => {\r\n        // Crear tarjeta de producto con placeholder de imagen\r\n        const col = document.createElement('div');\r\n        col.className = 'col-md-3 mb-4';\r\n        \r\n        const card = document.createElement('div');\r\n        card.className = 'card h-100';\r\n        card.dataset.id = producto.id;\r\n        \r\n        // Imagen del producto (inicialmente placeholder)\r\n        const img = document.createElement('img');\r\n        img.className = 'card-img-top';\r\n        img.src = `https://placehold.co/300x200/007bff/white?text=${encodeURIComponent(producto.nombre)}`;\r\n        img.alt = producto.nombre;\r\n        \r\n        const cardBody = document.createElement('div');\r\n        cardBody.className = 'card-body d-flex flex-column';\r\n        \r\n        // Título del producto\r\n        const title = document.createElement('h5');\r\n        title.className = 'card-title';\r\n        title.textContent = producto.nombre;\r\n        \r\n        // Precio\r\n        const price = document.createElement('p');\r\n        price.className = 'card-text text-danger fw-bold';\r\n        \r\n        if (producto.precio_oferta && producto.precio_oferta < producto.precio) {\r\n          // Si hay precio de oferta\r\n          const oldPrice = document.createElement('span');\r\n          oldPrice.className = 'text-muted text-decoration-line-through me-2';\r\n          oldPrice.textContent = `$${producto.precio.toLocaleString('es-CL')}`;\r\n          \r\n          const newPrice = document.createTextNode(`$${producto.precio_oferta.toLocaleString('es-CL')}`);\r\n          \r\n          price.appendChild(oldPrice);\r\n          price.appendChild(newPrice);\r\n        } else {\r\n          // Precio normal\r\n          price.textContent = `$${producto.precio.toLocaleString('es-CL')}`;\r\n        }\r\n        \r\n        // Stock (si está disponible)\r\n        if (producto.stock !== undefined) {\r\n          const stock = document.createElement('p');\r\n          stock.className = 'card-text small';\r\n          \r\n          if (producto.stock > 10) {\r\n            stock.innerHTML = '<span class=\"text-success\"><i class=\"fas fa-check-circle me-1\"></i>En stock</span>';\r\n          } else if (producto.stock > 0) {\r\n            stock.innerHTML = `<span class=\"text-warning\"><i class=\"fas fa-exclamation-circle me-1\"></i>Quedan ${producto.stock} unidades</span>`;\r\n          } else {\r\n            stock.innerHTML = '<span class=\"text-danger\"><i class=\"fas fa-times-circle me-1\"></i>Sin stock</span>';\r\n          }\r\n          \r\n          cardBody.appendChild(stock);\r\n        }\r\n        \r\n        // Botones\r\n        const buttonDiv = document.createElement('div');\r\n        buttonDiv.className = 'mt-auto d-grid gap-2';\r\n        \r\n        const detailBtn = document.createElement('a');\r\n        detailBtn.className = 'btn btn-outline-primary';\r\n        detailBtn.href = `/producto/${producto.id}`;\r\n        detailBtn.textContent = 'Ver Detalles';\r\n        \r\n        const addBtn = document.createElement('button');\r\n        addBtn.className = 'btn btn-primary';\r\n        addBtn.textContent = 'Agregar al Carrito';\r\n        \r\n        // Deshabilitar botón si no hay stock\r\n        if (producto.stock !== undefined && producto.stock <= 0) {\r\n          addBtn.disabled = true;\r\n          addBtn.textContent = 'Sin Stock';\r\n        }\r\n        \r\n        // Configurar evento click\r\n        addBtn.addEventListener('click', function() {\r\n          agregarAlCarrito(\r\n            producto.id, \r\n            producto.nombre, \r\n            producto.precio_oferta || producto.precio, \r\n            img.src\r\n          );\r\n        });\r\n        \r\n        // Añadir elementos al DOM\r\n        buttonDiv.appendChild(detailBtn);\r\n        buttonDiv.appendChild(addBtn);\r\n        \r\n        cardBody.appendChild(title);\r\n        cardBody.appendChild(price);\r\n        cardBody.appendChild(buttonDiv);\r\n        \r\n        card.appendChild(img);\r\n        card.appendChild(cardBody);\r\n        \r\n        col.appendChild(card);\r\n        containerElement.appendChild(col);\r\n      });\r\n      \r\n      // Cargar imágenes para los productos mostrados\r\n      cargarImagenesProductos(productosOrdenados);\r\n      \r\n      // Crear paginación\r\n      if (resultado.pagination) {\r\n        generarPaginacion(resultado.pagination);\r\n      }\r\n      \r\n    } catch (error) {\r\n      console.error('Error al cargar productos:', error);\r\n      const loadingElement = document.getElementById('loading');\r\n      const noProductsElement = document.getElementById('no-products');\r\n      \r\n      if (loadingElement) {\r\n        loadingElement.classList.add('d-none');\r\n      }\r\n      \r\n      if (noProductsElement) {\r\n        noProductsElement.classList.remove('d-none');\r\n        const mensajeElement = noProductsElement.querySelector('p');\r\n        if (mensajeElement) {\r\n          mensajeElement.textContent = 'Error al cargar productos. Intente nuevamente.';\r\n        }\r\n      }\r\n      \r\n      throw error;\r\n    }\r\n  }\r\n\r\n  // Función auxiliar para cargar imágenes de productos\r\n  async function cargarImagenesProductos(productos) {\r\n  if (!productos || productos.length === 0) return;\r\n  \r\n  try {\r\n    // Para cada producto, intentar obtener sus imágenes\r\n    for (const producto of productos) {\r\n      try {\r\n        // Buscar la tarjeta del producto\r\n        const card = document.querySelector(`.card[data-id=\"${producto.id}\"]`);\r\n        if (!card) continue;\r\n        \r\n        const img = card.querySelector('img');\r\n        if (!img) continue;\r\n        \r\n        // Intentar cargar imágenes desde la API\r\n        const imagenes = await obtenerImagenesProducto(producto.id).catch(() => []);\r\n        console.log(`Imágenes para producto ${producto.id}:`, imagenes);\r\n        \r\n        // Imagen principal, si existe\r\n        const imagenPrincipal = imagenes.length > 0\r\n          ? imagenes.find(img => img.es_principal) || imagenes[0]\r\n          : null;\r\n        \r\n        // Actualizar la imagen usando el mapeador\r\n        if (imagenPrincipal) {\r\n          img.src = getFullImageUrl(imagenPrincipal, producto);\r\n        } else {\r\n          // Si no hay imágenes, usar el mapeador con solo el producto\r\n          img.src = getFullImageUrl(null, producto);\r\n        }\r\n        \r\n        // Añadir el nombre del producto como alt para accesibilidad\r\n        img.alt = producto.nombre || 'Producto';\r\n        \r\n      } catch (error) {\r\n        console.error(`Error al procesar imágenes del producto ${producto.id}:`, error);\r\n      }\r\n    }\r\n  } catch (error) {\r\n    console.error('Error global al cargar imágenes:', error);\r\n  }\r\n}\r\n\r\n  // Función para generar la paginación\r\n  function generarPaginacion(pagination) {\r\n    const paginationElement = document.getElementById('pagination');\r\n    if (!paginationElement) {\r\n      console.warn('Elemento pagination no encontrado');\r\n      return;\r\n    }\r\n    \r\n    // Limpiar paginación existente\r\n    paginationElement.innerHTML = '';\r\n    \r\n    // Si solo hay una página, no mostrar paginación\r\n    if (pagination.totalPages <= 1) {\r\n      return;\r\n    }\r\n    \r\n    // Botón \"Anterior\"\r\n    const prevLi = document.createElement('li');\r\n    prevLi.className = `page-item ${pagination.page <= 1 ? 'disabled' : ''}`;\r\n    \r\n    const prevLink = document.createElement('a');\r\n    prevLink.className = 'page-link';\r\n    prevLink.href = '#';\r\n    prevLink.setAttribute('aria-label', 'Anterior');\r\n    prevLink.innerHTML = '<span aria-hidden=\"true\">&laquo;</span>';\r\n    \r\n    prevLink.addEventListener('click', function(e) {\r\n      e.preventDefault();\r\n      if (pagination.page > 1) {\r\n        cargarProductos(pagination.page - 1);\r\n        \r\n        // Actualizar URL sin recargar página\r\n        const url = new URL(window.location);\r\n        url.searchParams.set('page', pagination.page - 1);\r\n        window.history.pushState({}, '', url);\r\n      }\r\n    });\r\n    \r\n    prevLi.appendChild(prevLink);\r\n    paginationElement.appendChild(prevLi);\r\n    \r\n    // Determinar qué páginas mostrar\r\n    let startPage = Math.max(1, pagination.page - 2);\r\n    let endPage = Math.min(pagination.totalPages, startPage + 4);\r\n    \r\n    // Ajustar si estamos cerca del final\r\n    if (endPage - startPage < 4) {\r\n      startPage = Math.max(1, endPage - 4);\r\n    }\r\n    \r\n    // Generar números de página\r\n    for (let i = startPage; i <= endPage; i++) {\r\n      const pageLi = document.createElement('li');\r\n      pageLi.className = `page-item ${i === pagination.page ? 'active' : ''}`;\r\n      \r\n      const pageLink = document.createElement('a');\r\n      pageLink.className = 'page-link';\r\n      pageLink.href = '#';\r\n      pageLink.textContent = i;\r\n      \r\n      pageLink.addEventListener('click', function(e) {\r\n        e.preventDefault();\r\n        cargarProductos(i);\r\n        \r\n        // Actualizar URL sin recargar página\r\n        const url = new URL(window.location);\r\n        url.searchParams.set('page', i);\r\n        window.history.pushState({}, '', url);\r\n      });\r\n      \r\n      pageLi.appendChild(pageLink);\r\n      paginationElement.appendChild(pageLi);\r\n    }\r\n    \r\n    // Botón \"Siguiente\"\r\n    const nextLi = document.createElement('li');\r\n    nextLi.className = `page-item ${pagination.page >= pagination.totalPages ? 'disabled' : ''}`;\r\n    \r\n    const nextLink = document.createElement('a');\r\n    nextLink.className = 'page-link';\r\n    nextLink.href = '#';\r\n    nextLink.setAttribute('aria-label', 'Siguiente');\r\n    nextLink.innerHTML = '<span aria-hidden=\"true\">&raquo;</span>';\r\n    \r\n    nextLink.addEventListener('click', function(e) {\r\n      e.preventDefault();\r\n      if (pagination.page < pagination.totalPages) {\r\n        cargarProductos(pagination.page + 1);\r\n        \r\n        // Actualizar URL sin recargar página\r\n        const url = new URL(window.location);\r\n        url.searchParams.set('page', pagination.page + 1);\r\n        window.history.pushState({}, '', url);\r\n      }\r\n    });\r\n    \r\n    nextLi.appendChild(nextLink);\r\n    paginationElement.appendChild(nextLi);\r\n  }\r\n\r\n  // Función para mostrar error general\r\n  function mostrarErrorGeneral(mensaje) {\r\n    const container = document.querySelector('.container.my-5');\r\n    if (!container) {\r\n      console.error('No se encontró contenedor para mostrar error:', mensaje);\r\n      alert(mensaje); // Fallback a alert si no hay contenedor\r\n      return;\r\n    }\r\n    \r\n    const alerta = document.createElement('div');\r\n    alerta.className = 'alert alert-danger mb-4';\r\n    alerta.role = 'alert';\r\n    alerta.innerHTML = `\r\n      <i class=\"fas fa-exclamation-triangle me-2\"></i>\r\n      ${mensaje}\r\n    `;\r\n    \r\n    // Insertar al principio del contenedor\r\n    container.insertBefore(alerta, container.firstChild);\r\n    \r\n    // Eliminar después de 10 segundos\r\n    setTimeout(() => {\r\n      if (alerta.parentNode) {\r\n        alerta.remove();\r\n      }\r\n    }, 10000);\r\n  }\r\n\r\n  // Función para mostrar error de categorías\r\n  function mostrarErrorCategorias(mensaje) {\r\n    console.log('Mostrando error de categorías:', mensaje);\r\n    const menuCategorias = document.getElementById('categorias-menu');\r\n    if (!menuCategorias) {\r\n      console.error('No se encontró el menú de categorías');\r\n      return;\r\n    }\r\n    \r\n    // Buscar el divisor\r\n    const divider = menuCategorias.querySelector('hr');\r\n    const dividerParent = divider ? divider.parentElement : null;\r\n    \r\n    // Agregar mensaje de error\r\n    const errorLi = document.createElement('li');\r\n    errorLi.className = 'px-3 py-2 text-danger small';\r\n    errorLi.innerHTML = `<i class=\"fas fa-exclamation-circle me-1\"></i> ${mensaje}`;\r\n    \r\n    if (dividerParent) {\r\n      menuCategorias.insertBefore(errorLi, dividerParent);\r\n    } else {\r\n      menuCategorias.appendChild(errorLi);\r\n    }\r\n    \r\n    // Agregar categorías estáticas como fallback\r\n    const categorias = [\r\n      { nombre: 'Herramientas', slug: 'herramientas' },\r\n      { nombre: 'Materiales', slug: 'materiales' },\r\n      { nombre: 'Seguridad', slug: 'seguridad' }\r\n    ];\r\n    \r\n    // Agregar categorías estáticas\r\n    categorias.forEach(categoria => {\r\n      const li = document.createElement('li');\r\n      const a = document.createElement('a');\r\n      a.className = 'dropdown-item';\r\n      a.href = `/categoria/${categoria.slug}`;\r\n      a.textContent = categoria.nombre;\r\n      li.appendChild(a);\r\n      \r\n      if (dividerParent) {\r\n        menuCategorias.insertBefore(li, dividerParent);\r\n      } else {\r\n        menuCategorias.appendChild(li);\r\n      }\r\n    });\r\n  }\r\n\r\n  // ===== INICIALIZACIÓN =====\r\n  \r\n  // Inicializar cuando el DOM esté cargado\r\n  document.addEventListener('DOMContentLoaded', async function() {\r\n    // Configurar manejo de errores global\r\n    window.addEventListener('error', function(e) {\r\n      console.error('Error en la página:', e.message);\r\n      mostrarErrorGeneral('Ha ocurrido un error en la página. Por favor, intenta nuevamente.');\r\n    });\r\n  \r\n    try {\r\n      console.log('Inicializando página de productos con FERREMAS API Client...');\r\n      \r\n      // Verificar que los elementos DOM necesarios existen\r\n      const elementosRequeridos = ['productos-container', 'loading', 'no-products', 'pagination'];\r\n      for (const id of elementosRequeridos) {\r\n        if (!document.getElementById(id)) {\r\n          console.warn(`Elemento ${id} no encontrado en el DOM`);\r\n        }\r\n      }\r\n      \r\n      // Verificar autenticación para mostrar el menú de usuario adecuado\r\n      if (window.estaAutenticado && typeof estaAutenticado === 'function' && estaAutenticado()) {\r\n        const usuario = getUsuarioActual();\r\n        \r\n        // Actualizar nombre de usuario\r\n        const userNameElement = document.getElementById('user-name');\r\n        if (userNameElement && usuario) {\r\n          userNameElement.textContent = usuario.nombre;\r\n        }\r\n        \r\n        // Mostrar dropdown de usuario y ocultar enlace de login\r\n        const loginItem = document.getElementById('login-item');\r\n        const userDropdown = document.getElementById('user-dropdown');\r\n        \r\n        if (loginItem) loginItem.classList.add('d-none');\r\n        if (userDropdown) userDropdown.classList.remove('d-none');\r\n        \r\n        // Configurar evento de logout\r\n        const logoutLink = document.getElementById('logout-link');\r\n        if (logoutLink && typeof cerrarSesion === 'function') {\r\n          logoutLink.addEventListener('click', function(e) {\r\n            e.preventDefault();\r\n            cerrarSesion();\r\n          });\r\n        }\r\n      }\r\n      \r\n      // Cargar categorías\r\n      await cargarCategorias().catch(error => {\r\n        console.error('Error al cargar categorías:', error);\r\n        mostrarErrorCategorias('No se pudieron cargar las categorías');\r\n      });\r\n      \r\n      // Cargar productos (primera página)\r\n      await cargarProductos(1).catch(error => {\r\n        console.error('Error al cargar productos:', error);\r\n      });\r\n      \r\n      // Configurar búsqueda\r\n      const searchButton = document.getElementById('search-button');\r\n      const searchInput = document.getElementById('search-input');\r\n      \r\n      if (searchButton && searchInput) {\r\n        searchButton.addEventListener('click', function() {\r\n          const termino = searchInput.value.trim();\r\n          if (termino) {\r\n            window.location.href = `/buscar?q=${encodeURIComponent(termino)}`;\r\n          }\r\n        });\r\n        \r\n        // Permitir búsqueda también presionando Enter\r\n        searchInput.addEventListener('keypress', function(e) {\r\n          if (e.key === 'Enter' && searchButton) {\r\n            searchButton.click();\r\n          }\r\n        });\r\n      }\r\n      \r\n      // Configurar ordenamiento\r\n      const sortSelect = document.getElementById('sort-select');\r\n      if (sortSelect) {\r\n        sortSelect.addEventListener('change', function() {\r\n          const currentPage = new URLSearchParams(window.location.search).get('page') || 1;\r\n          cargarProductos(parseInt(currentPage));\r\n        });\r\n      }\r\n  \r\n      // Verificar si hay parámetros de página en la URL\r\n      const urlParams = new URLSearchParams(window.location.search);\r\n      const pageParam = urlParams.get('page');\r\n      if (pageParam) {\r\n        cargarProductos(parseInt(pageParam));\r\n      }\r\n    } catch (error) {\r\n      console.error('Error al inicializar la página de productos:', error);\r\n      mostrarErrorGeneral('No se pudo cargar la página de productos. Por favor, intenta nuevamente más tarde.');\r\n    }\r\n  });\r\n\r\n})(); ",
      "forgot-password.js": "document.addEventListener('DOMContentLoaded', function() {\r\n  const forgotPasswordForm = document.getElementById('forgot-password-form');\r\n  const emailInput = document.getElementById('email');\r\n  const errorDiv = document.getElementById('error-message');\r\n  const successDiv = document.getElementById('success-message');\r\n  \r\n  // Verificar si ya está autenticado\r\n  if (estaAutenticado()) {\r\n    window.location.href = '/';\r\n    return;\r\n  }\r\n  \r\n  forgotPasswordForm.addEventListener('submit', async function(e) {\r\n    e.preventDefault();\r\n    \r\n    // Limpiar mensajes anteriores\r\n    errorDiv.classList.add('d-none');\r\n    successDiv.classList.add('d-none');\r\n    \r\n    // Validación básica del lado del cliente\r\n    if (!emailInput.value.trim()) {\r\n      errorDiv.textContent = 'El correo electrónico es obligatorio';\r\n      errorDiv.classList.remove('d-none');\r\n      return;\r\n    }\r\n    \r\n    try {\r\n      const response = await fetch(`${API_URL}/auth/forgot-password`, {\r\n        method: 'POST',\r\n        headers: {\r\n          'Content-Type': 'application/json'\r\n        },\r\n        body: JSON.stringify({ email: emailInput.value })\r\n      });\r\n      \r\n      const data = await response.json();\r\n      \r\n      if (!response.ok) {\r\n        throw new Error(data.message || 'Error al procesar solicitud');\r\n      }\r\n      \r\n      // Mostrar mensaje de éxito\r\n      successDiv.classList.remove('d-none');\r\n      forgotPasswordForm.reset();\r\n      \r\n    } catch (error) {\r\n      // Mostrar mensaje de error\r\n      errorDiv.textContent = error.message;\r\n      errorDiv.classList.remove('d-none');\r\n    }\r\n  });\r\n});",
      "home.js": "// public/js/home.js\r\ndocument.addEventListener('DOMContentLoaded', async function() {\r\n  // Verificar si hay usuario logueado\r\n  if (estaAutenticado()) {\r\n    const usuario = getUsuarioActual();\r\n    \r\n    // Actualizar nombre de usuario\r\n    document.getElementById('user-name').textContent = usuario.nombre;\r\n    \r\n    // Mostrar dropdown de usuario y ocultar enlace de login\r\n    document.getElementById('login-item').classList.add('d-none');\r\n    document.getElementById('user-dropdown').classList.remove('d-none');\r\n    \r\n    // Configurar evento de logout\r\n    document.getElementById('logout-link').addEventListener('click', function(e) {\r\n      e.preventDefault();\r\n      cerrarSesion();\r\n    });\r\n  }\r\n  \r\n  // Cargar contenido de la página principal con manejo de errores mejorado\r\n  try {\r\n    // Verificar la disponibilidad de la API\r\n    const apiDisponible = await verificarAPI();\r\n    \r\n    if (apiDisponible) {\r\n      // Si la API está disponible, cargar datos dinámicos\r\n      await cargarCategorias();\r\n      await cargarProductosDestacados();\r\n    } else {\r\n      // Si la API no está disponible, cargar datos estáticos\r\n      mostrarErrorCargaAPI();\r\n      cargarDatosEstaticos();\r\n    }\r\n  } catch (error) {\r\n    console.error('Error al cargar contenido inicial:', error);\r\n    mostrarErrorCargaAPI();\r\n    cargarDatosEstaticos();\r\n  }\r\n});\r\n\r\n// Función para verificar si la API está disponible\r\nasync function verificarAPI() {\r\n  try {\r\n    const response = await fetch('/api');\r\n    return response.ok;\r\n  } catch (error) {\r\n    console.error('Error al verificar la API:', error);\r\n    return false;\r\n  }\r\n}\r\n\r\n// Función para cargar datos estáticos cuando la API no está disponible\r\nfunction cargarDatosEstaticos() {\r\n  // Cargar categorías estáticas\r\n  const categoriasRow = document.querySelector('#categorias-principales .row');\r\n  if (categoriasRow) {\r\n    cargarCategoriasEstaticas(categoriasRow);\r\n  }\r\n  \r\n  // Cargar productos estáticos\r\n  const productosRow = document.querySelector('#productos-destacados .row');\r\n  if (productosRow) {\r\n    cargarProductosEstaticos(productosRow);\r\n  }\r\n  \r\n  // Configurar el menú con categorías estáticas\r\n  const menuCategorias = document.getElementById('categorias-menu');\r\n  if (menuCategorias) {\r\n    const divider = menuCategorias.querySelector('.dropdown-divider');\r\n    \r\n    // Limpiar elementos existentes antes del separador\r\n    Array.from(menuCategorias.children).forEach(child => {\r\n      if (child.querySelector('.dropdown-divider') === null && \r\n          !child.querySelector('a[href=\"/productos\"]')) {\r\n        menuCategorias.removeChild(child);\r\n      }\r\n    });\r\n    \r\n    // Agregar categorías estáticas\r\n    const categorias = [\r\n      { nombre: 'Herramientas', slug: 'herramientas' },\r\n      { nombre: 'Materiales', slug: 'materiales' },\r\n      { nombre: 'Seguridad', slug: 'seguridad' }\r\n    ];\r\n    \r\n    categorias.forEach(categoria => {\r\n      const li = document.createElement('li');\r\n      const a = document.createElement('a');\r\n      a.className = 'dropdown-item';\r\n      a.href = `/categoria/${categoria.slug}`;\r\n      a.textContent = categoria.nombre;\r\n      li.appendChild(a);\r\n      menuCategorias.insertBefore(li, divider.parentElement);\r\n    });\r\n  }\r\n  \r\n  // Configurar categorías en el footer\r\n  const footerCategorias = document.getElementById('footer-categorias');\r\n  if (footerCategorias) {\r\n    footerCategorias.innerHTML = '';\r\n    \r\n    const categorias = [\r\n      { nombre: 'Herramientas', slug: 'herramientas' },\r\n      { nombre: 'Materiales', slug: 'materiales' },\r\n      { nombre: 'Seguridad', slug: 'seguridad' },\r\n      { nombre: 'Accesorios', slug: 'accesorios' }\r\n    ];\r\n    \r\n    categorias.forEach(categoria => {\r\n      const li = document.createElement('li');\r\n      const a = document.createElement('a');\r\n      a.href = `/categoria/${categoria.slug}`;\r\n      a.className = 'text-muted';\r\n      a.textContent = categoria.nombre;\r\n      li.appendChild(a);\r\n      footerCategorias.appendChild(li);\r\n    });\r\n  }\r\n}\r\n\r\n// Función para mostrar un mensaje de error en caso de problemas con la API\r\nfunction mostrarErrorCargaAPI() {\r\n  // Crear un mensaje de alerta\r\n  const alertDiv = document.createElement('div');\r\n  alertDiv.className = 'alert alert-warning alert-dismissible fade show';\r\n  alertDiv.setAttribute('role', 'alert');\r\n  alertDiv.innerHTML = `\r\n    <strong>¡Atención!</strong> No se pudo conectar con el servidor de productos. \r\n    Se están mostrando datos de ejemplo. <button type=\"button\" id=\"retry-connection\" class=\"btn btn-sm btn-warning ms-3\">Reintentar</button>\r\n    <button type=\"button\" class=\"btn-close\" data-bs-dismiss=\"alert\" aria-label=\"Close\"></button>\r\n  `;\r\n  \r\n  // Agregar el mensaje al inicio del contenido principal\r\n  const container = document.querySelector('.container.py-5');\r\n  container.insertBefore(alertDiv, container.firstChild);\r\n  \r\n  // Agregar evento para reintentar la conexión\r\n  document.getElementById('retry-connection').addEventListener('click', function() {\r\n    location.reload();\r\n  });\r\n}\r\n\r\n// Función para cargar categorías estáticas en caso de error\r\nfunction cargarCategoriasEstaticas(container) {\r\n  // Limpiar el contenedor\r\n  container.innerHTML = '';\r\n  \r\n  // Categorías estáticas como fallback\r\n  const categorias = [\r\n    { nombre: 'Herramientas', descripcion: 'Encuentra las mejores herramientas manuales y eléctricas para tus proyectos.' },\r\n    { nombre: 'Materiales', descripcion: 'Todo lo que necesitas para tus proyectos de construcción y remodelación.' },\r\n    { nombre: 'Seguridad', descripcion: 'Protégete con nuestra línea de equipos de seguridad de alta calidad.' }\r\n  ];\r\n  \r\n  categorias.forEach(categoria => {\r\n    const colDiv = document.createElement('div');\r\n    colDiv.className = 'col-md-4';\r\n    \r\n    colDiv.innerHTML = `\r\n      <div class=\"card h-100 text-center\">\r\n        <img src=\"https://placehold.co/300x200/007bff/white?text=${encodeURIComponent(categoria.nombre)}\" \r\n             class=\"card-img-top\" alt=\"${categoria.nombre}\">\r\n        <div class=\"card-body\">\r\n          <h5 class=\"card-title\">${categoria.nombre}</h5>\r\n          <p class=\"card-text\">${categoria.descripcion}</p>\r\n          <a href=\"/categoria/${categoria.nombre.toLowerCase()}\" class=\"btn btn-primary\">Ver Categoría</a>\r\n        </div>\r\n      </div>\r\n    `;\r\n    \r\n    container.appendChild(colDiv);\r\n  });\r\n}\r\n\r\n// Función para cargar productos estáticos en caso de error\r\nfunction cargarProductosEstaticos(container) {\r\n  // Limpiar el contenedor\r\n  container.innerHTML = '';\r\n  \r\n  // Productos estáticos como fallback\r\n  const productos = [\r\n    { id: 1, nombre: 'Taladro Percutor Bosch', precio: 89990 },\r\n    { id: 2, nombre: 'Set Destornilladores Stanley', precio: 24990 },\r\n    { id: 3, nombre: 'Cemento Polpaico 25kg', precio: 8990 },\r\n    { id: 4, nombre: 'Casco de Seguridad 3M', precio: 12990 }\r\n  ];\r\n  \r\n  productos.forEach(producto => {\r\n    const colDiv = document.createElement('div');\r\n    colDiv.className = 'col-md-3';\r\n    \r\n    colDiv.innerHTML = `\r\n      <div class=\"card h-100\" data-id=\"${producto.id}\">\r\n        <img src=\"https://placehold.co/300x200/007bff/white?text=${encodeURIComponent(producto.nombre)}\" \r\n             class=\"card-img-top\" alt=\"${producto.nombre}\">\r\n        <div class=\"card-body d-flex flex-column\">\r\n          <h5 class=\"card-title\">${producto.nombre}</h5>\r\n          <p class=\"card-text text-danger fw-bold\">$${producto.precio.toLocaleString('es-CL')}</p>\r\n          <div class=\"mt-auto d-grid gap-2\">\r\n            <a href=\"/producto/${producto.id}\" class=\"btn btn-outline-primary\">Ver Detalles</a>\r\n            <button class=\"btn btn-primary add-to-cart-btn\">Agregar al Carrito</button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    `;\r\n    \r\n    container.appendChild(colDiv);\r\n  });\r\n  \r\n  // Configurar eventos para botones \"Agregar al carrito\"\r\n  container.querySelectorAll('.add-to-cart-btn').forEach(button => {\r\n    button.addEventListener('click', function() {\r\n      const card = this.closest('.card');\r\n      const id = card.dataset.id;\r\n      const nombre = card.querySelector('.card-title').textContent;\r\n      const precio = parseInt(card.querySelector('.card-text.text-danger').textContent.replace(/\\D/g, ''));\r\n      const imagen = card.querySelector('.card-img-top').src;\r\n      \r\n      agregarAlCarrito(id, nombre, precio, imagen);\r\n    });\r\n  });\r\n}\r\n\r\n// La siguiente función sólo se ejecutará si la API está disponible\r\nasync function cargarCategorias() {\r\n  try {\r\n    const categorias = await obtenerCategorias();\r\n    \r\n    // Actualizar menú de categorías en navbar\r\n    const menuCategorias = document.getElementById('categorias-menu');\r\n    if (menuCategorias) {\r\n      // Encontrar el separador y el enlace \"Ver todos los productos\"\r\n      const divider = menuCategorias.querySelector('.dropdown-divider');\r\n      \r\n      // Limpiar elementos existentes antes del separador\r\n      Array.from(menuCategorias.children).forEach(child => {\r\n        if (child.querySelector('.dropdown-divider') === null && \r\n            !child.querySelector('a[href=\"/productos\"]')) {\r\n          menuCategorias.removeChild(child);\r\n        }\r\n      });\r\n      \r\n      // Agregar nuevas categorías antes del separador\r\n      categorias.forEach(categoria => {\r\n        const li = document.createElement('li');\r\n        const a = document.createElement('a');\r\n        a.className = 'dropdown-item';\r\n        a.href = `/categoria/${categoria.slug}`;\r\n        a.textContent = categoria.nombre;\r\n        li.appendChild(a);\r\n        menuCategorias.insertBefore(li, divider.parentElement);\r\n      });\r\n    }\r\n    \r\n    // Actualizar sección de categorías principales en la página de inicio\r\n    const categoriasRow = document.querySelector('#categorias-principales .row');\r\n    if (categoriasRow) {\r\n      categoriasRow.innerHTML = '';\r\n      \r\n      // Mostrar solo las primeras 3 categorías en la página principal\r\n      const principalesCategorias = categorias.slice(0, 3);\r\n      \r\n      principalesCategorias.forEach(categoria => {\r\n        const colDiv = document.createElement('div');\r\n        colDiv.className = 'col-md-4';\r\n        \r\n        colDiv.innerHTML = `\r\n          <div class=\"card h-100 text-center\">\r\n            <img src=\"${categoria.imagen || `https://placehold.co/300x200/007bff/white?text=${encodeURIComponent(categoria.nombre)}`}\" \r\n                 class=\"card-img-top\" alt=\"${categoria.nombre}\">\r\n            <div class=\"card-body\">\r\n              <h5 class=\"card-title\">${categoria.nombre}</h5>\r\n              <p class=\"card-text\">${categoria.descripcion || `Encuentra los mejores productos de ${categoria.nombre}`}</p>\r\n              <a href=\"/categoria/${categoria.slug}\" class=\"btn btn-primary\">Ver Categoría</a>\r\n            </div>\r\n          </div>\r\n        `;\r\n        \r\n        categoriasRow.appendChild(colDiv);\r\n      });\r\n    }\r\n    \r\n    // Actualizar categorías en el footer\r\n    const footerCategorias = document.getElementById('footer-categorias');\r\n    if (footerCategorias) {\r\n      footerCategorias.innerHTML = '';\r\n      \r\n      categorias.slice(0, 4).forEach(categoria => {\r\n        const li = document.createElement('li');\r\n        const a = document.createElement('a');\r\n        a.href = `/categoria/${categoria.slug}`;\r\n        a.className = 'text-muted';\r\n        a.textContent = categoria.nombre;\r\n        li.appendChild(a);\r\n        footerCategorias.appendChild(li);\r\n      });\r\n    }\r\n  } catch (error) {\r\n    console.error('Error al cargar categorías:', error);\r\n    throw error;\r\n  }\r\n}\r\n\r\n// La siguiente función sólo se ejecutará si la API está disponible\r\nasync function cargarProductosDestacados() {\r\n  // Implementación existente...\r\n}",
      "imagen-mapper.js": "// Función para mapear nombres de imágenes de la API a rutas locales\r\nconst imagenMapper = (() => {\r\n  // Mapa de imágenes conocidas (nombre en API -> nombre de archivo local)\r\n  const imagenesConocidas = {\r\n    // Ejemplos (actualiza estos con tus imágenes reales)\r\n    'Martillo de Carpintero 16oz.png': '/imagenes/martillo-carpintero.png',\r\n    'Taladro eléctrico.jpg': '/imagenes/taladro-electrico.jpg',\r\n    'Sierra circular.png': '/imagenes/sierra-circular.png',\r\n    // Añade más mapeos según sea necesario\r\n  };\r\n\r\n  // Imágenes por categoría\r\n  const categoriaImagenes = {\r\n    // ID de categoría -> imagen por defecto\r\n    1: '/imagenes/categoria-herramientas.jpg', // Herramientas\r\n    2: '/imagenes/categoria-materiales.jpg',  // Materiales\r\n    3: '/imagenes/categoria-seguridad.jpg',   // Seguridad\r\n    // Añade más categorías según sea necesario\r\n  };\r\n\r\n  // Imágenes por defecto para productos sin imagen\r\n  const imagenesPorDefecto = [\r\n    '/imagenes/producto-default-1.jpg',\r\n    '/imagenes/producto-default-2.jpg',\r\n    '/imagenes/producto-default-3.jpg'\r\n  ];\r\n\r\n  // Obtiene la URL de la imagen basada en la información del producto y la imagen\r\n  function getImageUrl(imagen, producto) {\r\n    // Si recibimos un objeto imagen completo\r\n    if (imagen && typeof imagen === 'object') {\r\n      if (imagen.url) {\r\n        return getImageUrl(imagen.url, producto);\r\n      }\r\n      return getDefaultImage(producto);\r\n    }\r\n\r\n    // Si es una URL completa externa\r\n    if (imagen && (imagen.startsWith('http://') || imagen.startsWith('https://'))) {\r\n      return imagen;\r\n    }\r\n\r\n    // Obtener solo el nombre del archivo\r\n    const nombreArchivo = imagen ? imagen.split('/').pop().split('\\\\').pop() : null;\r\n\r\n    // Verificar si tenemos una imagen mapeada para este nombre\r\n    if (nombreArchivo && imagenesConocidas[nombreArchivo]) {\r\n      return imagenesConocidas[nombreArchivo];\r\n    }\r\n\r\n    // Si no tenemos una imagen mapeada pero sí el nombre de archivo, podemos construir una ruta predecible\r\n    if (nombreArchivo) {\r\n      // Reemplazar espacios con guiones y convertir a minúsculas para normalizar el nombre\r\n      const nombreArchivoProcesado = nombreArchivo.toLowerCase().replace(/\\s+/g, '-');\r\n      return `/imagenes/${nombreArchivoProcesado}`;\r\n    }\r\n\r\n    // Si no hay nombre de archivo, usar imagen por defecto\r\n    return getDefaultImage(producto);\r\n  }\r\n\r\n  // Obtiene una imagen por defecto basada en la categoría del producto o una imagen genérica\r\n  function getDefaultImage(producto) {\r\n    if (producto && producto.categoria_id && categoriaImagenes[producto.categoria_id]) {\r\n      return categoriaImagenes[producto.categoria_id];\r\n    }\r\n\r\n    // Usar un índice basado en el ID del producto para variar las imágenes por defecto\r\n    if (producto && producto.id) {\r\n      const index = producto.id % imagenesPorDefecto.length;\r\n      return imagenesPorDefecto[index];\r\n    }\r\n\r\n    // Si todo falla, usar la primera imagen por defecto\r\n    return imagenesPorDefecto[0];\r\n  }\r\n\r\n  // API pública\r\n  return {\r\n    getImageUrl,\r\n    getDefaultImage\r\n  };\r\n})();",
      "login.js": "document.addEventListener('DOMContentLoaded', function() {\r\n  const loginForm = document.getElementById('login-form');\r\n  const emailInput = document.getElementById('email');\r\n  const passwordInput = document.getElementById('password');\r\n  const errorDiv = document.getElementById('error-message');\r\n  \r\n  // Verificar si ya está autenticado\r\n  if (estaAutenticado()) {\r\n    window.location.href = '/';\r\n    return;\r\n  }\r\n  \r\n  loginForm.addEventListener('submit', async function(e) {\r\n    e.preventDefault();\r\n    \r\n    // Limpiar mensaje de error anterior\r\n    errorDiv.classList.add('d-none');\r\n    \r\n    // Validación básica del lado del cliente\r\n    if (!emailInput.value.trim()) {\r\n      errorDiv.textContent = 'El correo electrónico es obligatorio';\r\n      errorDiv.classList.remove('d-none');\r\n      return;\r\n    }\r\n    \r\n    if (!passwordInput.value) {\r\n      errorDiv.textContent = 'La contraseña es obligatoria';\r\n      errorDiv.classList.remove('d-none');\r\n      return;\r\n    }\r\n    \r\n    try {\r\n      const data = await iniciarSesion({ \r\n        email: emailInput.value, \r\n        password: passwordInput.value \r\n      });\r\n      // Redirigir al usuario a la página principal\r\n      window.location.href = '/';\r\n    } catch (error) {\r\n      // Mostrar mensaje de error\r\n      errorDiv.textContent = error.message;\r\n      errorDiv.classList.remove('d-none');\r\n    }\r\n  });\r\n});\r\n\r\nasync function verificarEstadoAPI() {\r\n  try {\r\n    const response = await fetch(`${API_URL}`, {\r\n      method: 'GET'\r\n    });\r\n    \r\n    if (response.ok) {\r\n      console.log('✅ API funcionando correctamente');\r\n      const data = await response.json();\r\n      console.log('Información de la API:', data);\r\n    } else {\r\n      console.error('❌ API responde pero con error:', response.status);\r\n    }\r\n  } catch (error) {\r\n    console.error('❌ Error al conectar con la API:', error);\r\n  }\r\n}\r\n\r\nverificarEstadoAPI();",
      "productos-page.js": "// Script que maneja la página de productos\r\ndocument.addEventListener('DOMContentLoaded', async function() {\r\n  // Configurar manejo de errores global\r\n  window.addEventListener('error', function(e) {\r\n    console.error('Error en la página:', e.message);\r\n    mostrarErrorGeneral('Ha ocurrido un error en la página. Por favor, intenta nuevamente.');\r\n  });\r\n\r\n  try {\r\n    console.log('Inicializando página de productos...');\r\n    \r\n    // Verificar que los elementos DOM necesarios existen\r\n    const elementosRequeridos = [\r\n      'productos-container',\r\n      'loading',\r\n      'no-products',\r\n      'pagination'\r\n    ];\r\n    \r\n    for (const id of elementosRequeridos) {\r\n      if (!document.getElementById(id)) {\r\n        console.warn(`Elemento ${id} no encontrado en el DOM`);\r\n      }\r\n    }\r\n    \r\n    // Verificar autenticación para mostrar el menú de usuario adecuado\r\n    if (window.estaAutenticado && typeof estaAutenticado === 'function' && estaAutenticado()) {\r\n      const usuario = getUsuarioActual();\r\n      \r\n      // Actualizar nombre de usuario\r\n      const userNameElement = document.getElementById('user-name');\r\n      if (userNameElement && usuario) {\r\n        userNameElement.textContent = usuario.nombre;\r\n      }\r\n      \r\n      // Mostrar dropdown de usuario y ocultar enlace de login\r\n      const loginItem = document.getElementById('login-item');\r\n      const userDropdown = document.getElementById('user-dropdown');\r\n      \r\n      if (loginItem) loginItem.classList.add('d-none');\r\n      if (userDropdown) userDropdown.classList.remove('d-none');\r\n      \r\n      // Configurar evento de logout\r\n      const logoutLink = document.getElementById('logout-link');\r\n      if (logoutLink && typeof cerrarSesion === 'function') {\r\n        logoutLink.addEventListener('click', function(e) {\r\n          e.preventDefault();\r\n          cerrarSesion();\r\n        });\r\n      }\r\n    }\r\n    \r\n    // Cargar categorías\r\n    await cargarCategorias().catch(error => {\r\n      console.error('Error al cargar categorías:', error);\r\n      mostrarErrorCategorias('No se pudieron cargar las categorías');\r\n    });\r\n    \r\n    // Cargar productos (primera página)\r\n    await cargarProductos(1).catch(error => {\r\n      console.error('Error al cargar productos:', error);\r\n      const loadingElement = document.getElementById('loading');\r\n      const noProductsElement = document.getElementById('no-products');\r\n      \r\n      if (loadingElement) loadingElement.classList.add('d-none');\r\n      if (noProductsElement) {\r\n        noProductsElement.classList.remove('d-none');\r\n        const mensajeElement = noProductsElement.querySelector('p');\r\n        if (mensajeElement) {\r\n          mensajeElement.textContent = 'Error al cargar productos. Intente nuevamente.';\r\n        }\r\n      }\r\n    });\r\n    \r\n    // Configurar búsqueda\r\n    const searchButton = document.getElementById('search-button');\r\n    const searchInput = document.getElementById('search-input');\r\n    \r\n    if (searchButton && searchInput) {\r\n      searchButton.addEventListener('click', function() {\r\n        const termino = searchInput.value.trim();\r\n        if (termino) {\r\n          window.location.href = `/buscar?q=${encodeURIComponent(termino)}`;\r\n        }\r\n      });\r\n      \r\n      // Permitir búsqueda también presionando Enter\r\n      searchInput.addEventListener('keypress', function(e) {\r\n        if (e.key === 'Enter' && searchButton) {\r\n          searchButton.click();\r\n        }\r\n      });\r\n    }\r\n    \r\n    // Configurar ordenamiento\r\n    const sortSelect = document.getElementById('sort-select');\r\n    if (sortSelect) {\r\n      sortSelect.addEventListener('change', function() {\r\n        const currentPage = new URLSearchParams(window.location.search).get('page') || 1;\r\n        cargarProductos(parseInt(currentPage));\r\n      });\r\n    }\r\n\r\n    // Verificar si hay parámetros de página en la URL\r\n    const urlParams = new URLSearchParams(window.location.search);\r\n    const pageParam = urlParams.get('page');\r\n    if (pageParam) {\r\n      cargarProductos(parseInt(pageParam));\r\n    }\r\n  } catch (error) {\r\n    console.error('Error al inicializar la página de productos:', error);\r\n    mostrarErrorGeneral('No se pudo cargar la página de productos. Por favor, intenta nuevamente más tarde.');\r\n  }\r\n});\r\n\r\n// Función para cargar categorías\r\nasync function cargarCategorias() {\r\n  try {\r\n    console.log('Cargando categorías...');\r\n    const categorias = await obtenerCategorias();\r\n    console.log('Categorías obtenidas:', categorias);\r\n    \r\n    // Verificar que tenemos categorías válidas\r\n    if (!Array.isArray(categorias)) {\r\n      throw new Error('La API no devolvió un array de categorías');\r\n    }\r\n    \r\n    // Llenar menú de categorías en navbar\r\n    const menuCategorias = document.getElementById('categorias-menu');\r\n    if (!menuCategorias) {\r\n      console.warn('Elemento categorias-menu no encontrado');\r\n      return;\r\n    }\r\n    \r\n    // Encontrar el divisor para saber dónde insertar las categorías\r\n    const divider = menuCategorias.querySelector('hr');\r\n    let dividerParent = divider ? divider.parentElement : null;\r\n    \r\n    // Si no hay divisor, intentar encontrar el elemento \"Ver todos los productos\"\r\n    if (!dividerParent) {\r\n      const verTodosLink = Array.from(menuCategorias.querySelectorAll('a')).find(\r\n        a => a.textContent.includes('Ver todos los productos')\r\n      );\r\n      \r\n      if (verTodosLink) {\r\n        dividerParent = verTodosLink.parentElement;\r\n      } else {\r\n        // Si no hay divisor ni enlace \"Ver todos\", simplemente limpiar el menú\r\n        menuCategorias.innerHTML = '';\r\n      }\r\n    }\r\n    \r\n    // Limpiar categorías existentes manteniendo el divisor\r\n    if (dividerParent) {\r\n      // Eliminar todos los elementos antes del divisor\r\n      while (menuCategorias.firstChild && menuCategorias.firstChild !== dividerParent) {\r\n        menuCategorias.removeChild(menuCategorias.firstChild);\r\n      }\r\n    }\r\n    \r\n    // Agregar nuevas categorías\r\n    categorias.forEach(categoria => {\r\n      // Verificar que la categoría tiene los datos necesarios\r\n      if (!categoria || !categoria.nombre) {\r\n        console.warn('Categoría inválida:', categoria);\r\n        return;\r\n      }\r\n      \r\n      const li = document.createElement('li');\r\n      const a = document.createElement('a');\r\n      a.className = 'dropdown-item';\r\n      a.href = `/categoria/${categoria.slug || categoria.id}`;\r\n      a.textContent = categoria.nombre;\r\n      li.appendChild(a);\r\n      \r\n      if (dividerParent) {\r\n        menuCategorias.insertBefore(li, dividerParent);\r\n      } else {\r\n        menuCategorias.appendChild(li);\r\n      }\r\n    });\r\n    \r\n    // Si no había divisor ni enlace \"Ver todos\", añadirlos ahora\r\n    if (!dividerParent) {\r\n      // Añadir divisor\r\n      const dividerLi = document.createElement('li');\r\n      dividerLi.innerHTML = '<hr class=\"dropdown-divider\">';\r\n      menuCategorias.appendChild(dividerLi);\r\n      \r\n      // Añadir enlace \"Ver todos\"\r\n      const verTodosLi = document.createElement('li');\r\n      const verTodosA = document.createElement('a');\r\n      verTodosA.className = 'dropdown-item';\r\n      verTodosA.href = '/productos';\r\n      verTodosA.textContent = 'Ver todos los productos';\r\n      verTodosLi.appendChild(verTodosA);\r\n      menuCategorias.appendChild(verTodosLi);\r\n    }\r\n    \r\n    // Llenar categorías en el footer\r\n    const footerCategorias = document.getElementById('footer-categorias');\r\n    if (footerCategorias) {\r\n      footerCategorias.innerHTML = '';\r\n      \r\n      const categoriasAMostrar = categorias.slice(0, 4);\r\n      categoriasAMostrar.forEach(categoria => {\r\n        const li = document.createElement('li');\r\n        const a = document.createElement('a');\r\n        a.href = `/categoria/${categoria.slug || categoria.id}`;\r\n        a.className = 'text-muted';\r\n        a.textContent = categoria.nombre;\r\n        li.appendChild(a);\r\n        footerCategorias.appendChild(li);\r\n      });\r\n    }\r\n    \r\n  } catch (error) {\r\n    console.error('Error al cargar categorías:', error);\r\n    mostrarErrorCategorias('No se pudieron cargar las categorías');\r\n    throw error;\r\n  }\r\n}\r\n\r\n// Función para cargar productos\r\nasync function cargarProductos(page = 1) {\r\n  try {\r\n    console.log(`Cargando productos página ${page}...`);\r\n    \r\n    // Obtener elementos del DOM necesarios\r\n    const containerElement = document.getElementById('productos-container');\r\n    const loadingElement = document.getElementById('loading');\r\n    const noProductsElement = document.getElementById('no-products');\r\n    \r\n    // Verificar que existan los elementos necesarios\r\n    if (!containerElement) {\r\n      throw new Error('Elemento productos-container no encontrado');\r\n    }\r\n    \r\n    // Mostrar indicador de carga\r\n    if (loadingElement) {\r\n      loadingElement.classList.remove('d-none');\r\n    }\r\n    \r\n    // Ocultar mensaje de no productos\r\n    if (noProductsElement) {\r\n      noProductsElement.classList.add('d-none');\r\n    }\r\n    \r\n    // Limpiar contenedor de productos\r\n    containerElement.innerHTML = '';\r\n    \r\n    // Obtener ordenamiento seleccionado\r\n    const sortSelect = document.getElementById('sort-select');\r\n    const sortValue = sortSelect ? sortSelect.value : 'default';\r\n    \r\n    // Obtener productos desde la API\r\n    const resultado = await obtenerProductos(page, 12);\r\n    console.log('Productos obtenidos:', resultado);\r\n    \r\n    // Verificar que la respuesta tiene la estructura esperada\r\n    if (!resultado || !resultado.productos) {\r\n      throw new Error('Respuesta de API inválida');\r\n    }\r\n    \r\n    // Ocultar indicador de carga\r\n    if (loadingElement) {\r\n      loadingElement.classList.add('d-none');\r\n    }\r\n    \r\n    // Verificar si hay productos\r\n    if (resultado.productos.length === 0) {\r\n      if (noProductsElement) {\r\n        noProductsElement.classList.remove('d-none');\r\n      }\r\n      return;\r\n    }\r\n    \r\n    // Ordenar productos según selección\r\n    let productosOrdenados = [...resultado.productos];\r\n    switch (sortValue) {\r\n      case 'price_asc':\r\n        productosOrdenados.sort((a, b) => (a.precio_oferta || a.precio) - (b.precio_oferta || b.precio));\r\n        break;\r\n      case 'price_desc':\r\n        productosOrdenados.sort((a, b) => (b.precio_oferta || b.precio) - (a.precio_oferta || a.precio));\r\n        break;\r\n      case 'name_asc':\r\n        productosOrdenados.sort((a, b) => a.nombre.localeCompare(b.nombre));\r\n        break;\r\n      case 'name_desc':\r\n        productosOrdenados.sort((a, b) => b.nombre.localeCompare(a.nombre));\r\n        break;\r\n      default:\r\n        // Mantener orden original\r\n        break;\r\n    }\r\n    \r\n    // Crear las tarjetas de productos usando la estructura de los datos de la API\r\n    productosOrdenados.forEach(producto => {\r\n      // Crear tarjeta de producto con placeholder de imagen\r\n      const productCard = crearTarjetaProducto(producto);\r\n      containerElement.appendChild(productCard);\r\n    });\r\n    \r\n    // Cargar imágenes de los productos en segundo plano\r\n    cargarImagenesProductos(productosOrdenados);\r\n    \r\n    // Crear paginación\r\n    if (resultado.pagination) {\r\n      generarPaginacion(resultado.pagination);\r\n    }\r\n    \r\n  } catch (error) {\r\n    console.error('Error al cargar productos:', error);\r\n    const loadingElement = document.getElementById('loading');\r\n    const noProductsElement = document.getElementById('no-products');\r\n    \r\n    if (loadingElement) {\r\n      loadingElement.classList.add('d-none');\r\n    }\r\n    \r\n    if (noProductsElement) {\r\n      noProductsElement.classList.remove('d-none');\r\n      const mensajeElement = noProductsElement.querySelector('p');\r\n      if (mensajeElement) {\r\n        mensajeElement.textContent = 'Error al cargar productos. Intente nuevamente.';\r\n      }\r\n    }\r\n    \r\n    throw error;\r\n  }\r\n}\r\n\r\n// Función auxiliar para crear una tarjeta de producto\r\nfunction crearTarjetaProducto(producto) {\r\n  const col = document.createElement('div');\r\n  col.className = 'col-md-3 mb-4';\r\n  \r\n  const card = document.createElement('div');\r\n  card.className = 'card h-100';\r\n  card.dataset.id = producto.id;\r\n  \r\n  // Imagen del producto (inicialmente placeholder)\r\n  const img = document.createElement('img');\r\n  img.className = 'card-img-top';\r\n  img.src = `https://placehold.co/300x200/007bff/white?text=${encodeURIComponent(producto.nombre)}`;\r\n  img.alt = producto.nombre;\r\n  \r\n  const cardBody = document.createElement('div');\r\n  cardBody.className = 'card-body d-flex flex-column';\r\n  \r\n  // Título del producto\r\n  const title = document.createElement('h5');\r\n  title.className = 'card-title';\r\n  title.textContent = producto.nombre;\r\n  \r\n  // Precio\r\n  const price = document.createElement('p');\r\n  price.className = 'card-text text-danger fw-bold';\r\n  \r\n  if (producto.precio_oferta && producto.precio_oferta < producto.precio) {\r\n    // Si hay precio de oferta\r\n    const oldPrice = document.createElement('span');\r\n    oldPrice.className = 'text-muted text-decoration-line-through me-2';\r\n    oldPrice.textContent = `$${producto.precio.toLocaleString('es-CL')}`;\r\n    \r\n    const newPrice = document.createTextNode(`$${producto.precio_oferta.toLocaleString('es-CL')}`);\r\n    \r\n    price.appendChild(oldPrice);\r\n    price.appendChild(newPrice);\r\n  } else {\r\n    // Precio normal\r\n    price.textContent = `$${producto.precio.toLocaleString('es-CL')}`;\r\n  }\r\n  \r\n  // Stock (si está disponible)\r\n  if (producto.stock !== undefined) {\r\n    const stock = document.createElement('p');\r\n    stock.className = 'card-text small';\r\n    \r\n    if (producto.stock > 10) {\r\n      stock.innerHTML = '<span class=\"text-success\"><i class=\"fas fa-check-circle me-1\"></i>En stock</span>';\r\n    } else if (producto.stock > 0) {\r\n      stock.innerHTML = `<span class=\"text-warning\"><i class=\"fas fa-exclamation-circle me-1\"></i>Quedan ${producto.stock} unidades</span>`;\r\n    } else {\r\n      stock.innerHTML = '<span class=\"text-danger\"><i class=\"fas fa-times-circle me-1\"></i>Sin stock</span>';\r\n    }\r\n    \r\n    cardBody.appendChild(stock);\r\n  }\r\n  \r\n  // Botones\r\n  const buttonDiv = document.createElement('div');\r\n  buttonDiv.className = 'mt-auto d-grid gap-2';\r\n  \r\n  const detailBtn = document.createElement('a');\r\n  detailBtn.className = 'btn btn-outline-primary';\r\n  detailBtn.href = `/producto/${producto.id}`;\r\n  detailBtn.textContent = 'Ver Detalles';\r\n  \r\n  const addBtn = document.createElement('button');\r\n  addBtn.className = 'btn btn-primary';\r\n  addBtn.textContent = 'Agregar al Carrito';\r\n  \r\n  // Deshabilitar botón si no hay stock\r\n  if (producto.stock !== undefined && producto.stock <= 0) {\r\n    addBtn.disabled = true;\r\n    addBtn.textContent = 'Sin Stock';\r\n  }\r\n  \r\n  // Configurar evento click\r\n  addBtn.addEventListener('click', function() {\r\n    if (typeof agregarAlCarrito === 'function') {\r\n      agregarAlCarrito(\r\n        producto.id, \r\n        producto.nombre, \r\n        producto.precio_oferta || producto.precio, \r\n        img.src\r\n      );\r\n    } else {\r\n      console.error('Función agregarAlCarrito no disponible');\r\n    }\r\n  });\r\n  \r\n  // Añadir elementos al DOM\r\n  buttonDiv.appendChild(detailBtn);\r\n  buttonDiv.appendChild(addBtn);\r\n  \r\n  cardBody.appendChild(title);\r\n  cardBody.appendChild(price);\r\n  cardBody.appendChild(buttonDiv);\r\n  \r\n  card.appendChild(img);\r\n  card.appendChild(cardBody);\r\n  \r\n  col.appendChild(card);\r\n  \r\n  return col;\r\n}\r\n\r\n// Función auxiliar para cargar imágenes de productos\r\nasync function cargarImagenesProductos(productos) {\r\n  if (!productos || productos.length === 0) return;\r\n  \r\n  try {\r\n    // Para cada producto, intentar obtener sus imágenes\r\n    for (const producto of productos) {\r\n      try {\r\n        // Buscar la tarjeta del producto\r\n        const card = document.querySelector(`.card[data-id=\"${producto.id}\"]`);\r\n        if (!card) continue;\r\n        \r\n        const img = card.querySelector('img');\r\n        if (!img) continue;\r\n        \r\n        // Intentar cargar imágenes desde la API\r\n        const imagenes = await obtenerImagenesProducto(producto.id).catch(() => []);\r\n        console.log(`Imágenes para producto ${producto.id}:`, imagenes);\r\n        \r\n        // Imagen principal, si existe\r\n        const imagenPrincipal = imagenes.length > 0\r\n          ? imagenes.find(img => img.es_principal) || imagenes[0]\r\n          : null;\r\n        \r\n        // Actualizar la imagen usando el mapeador\r\n        if (imagenPrincipal) {\r\n          img.src = getFullImageUrl(imagenPrincipal, producto);\r\n        } else {\r\n          // Si no hay imágenes, usar el mapeador con solo el producto\r\n          img.src = getFullImageUrl(null, producto);\r\n        }\r\n        \r\n        // Añadir el nombre del producto como alt para accesibilidad\r\n        img.alt = producto.nombre || 'Producto';\r\n        \r\n      } catch (error) {\r\n        console.error(`Error al procesar imágenes del producto ${producto.id}:`, error);\r\n      }\r\n    }\r\n  } catch (error) {\r\n    console.error('Error global al cargar imágenes:', error);\r\n  }\r\n}\r\n\r\n// Función para generar la paginación\r\nfunction generarPaginacion(pagination) {\r\n  const paginationElement = document.getElementById('pagination');\r\n  if (!paginationElement) {\r\n    console.warn('Elemento pagination no encontrado');\r\n    return;\r\n  }\r\n  \r\n  // Limpiar paginación existente\r\n  paginationElement.innerHTML = '';\r\n  \r\n  // Si solo hay una página, no mostrar paginación\r\n  if (pagination.totalPages <= 1) {\r\n    return;\r\n  }\r\n  \r\n  // Botón \"Anterior\"\r\n  const prevLi = document.createElement('li');\r\n  prevLi.className = `page-item ${pagination.page <= 1 ? 'disabled' : ''}`;\r\n  \r\n  const prevLink = document.createElement('a');\r\n  prevLink.className = 'page-link';\r\n  prevLink.href = '#';\r\n  prevLink.setAttribute('aria-label', 'Anterior');\r\n  prevLink.innerHTML = '<span aria-hidden=\"true\">&laquo;</span>';\r\n  \r\n  prevLink.addEventListener('click', function(e) {\r\n    e.preventDefault();\r\n    if (pagination.page > 1) {\r\n      cargarProductos(pagination.page - 1);\r\n      \r\n      // Actualizar URL sin recargar página\r\n      const url = new URL(window.location);\r\n      url.searchParams.set('page', pagination.page - 1);\r\n      window.history.pushState({}, '', url);\r\n    }\r\n  });\r\n  \r\n  prevLi.appendChild(prevLink);\r\n  paginationElement.appendChild(prevLi);\r\n  \r\n  // Determinar qué páginas mostrar\r\n  let startPage = Math.max(1, pagination.page - 2);\r\n  let endPage = Math.min(pagination.totalPages, startPage + 4);\r\n  \r\n  // Ajustar si estamos cerca del final\r\n  if (endPage - startPage < 4) {\r\n    startPage = Math.max(1, endPage - 4);\r\n  }\r\n  \r\n  // Generar números de página\r\n  for (let i = startPage; i <= endPage; i++) {\r\n    const pageLi = document.createElement('li');\r\n    pageLi.className = `page-item ${i === pagination.page ? 'active' : ''}`;\r\n    \r\n    const pageLink = document.createElement('a');\r\n    pageLink.className = 'page-link';\r\n    pageLink.href = '#';\r\n    pageLink.textContent = i;\r\n    \r\n    pageLink.addEventListener('click', function(e) {\r\n      e.preventDefault();\r\n      cargarProductos(i);\r\n      \r\n      // Actualizar URL sin recargar página\r\n      const url = new URL(window.location);\r\n      url.searchParams.set('page', i);\r\n      window.history.pushState({}, '', url);\r\n    });\r\n    \r\n    pageLi.appendChild(pageLink);\r\n    paginationElement.appendChild(pageLi);\r\n  }\r\n  \r\n  // Botón \"Siguiente\"\r\n  const nextLi = document.createElement('li');\r\n  nextLi.className = `page-item ${pagination.page >= pagination.totalPages ? 'disabled' : ''}`;\r\n  \r\n  const nextLink = document.createElement('a');\r\n  nextLink.className = 'page-link';\r\n  nextLink.href = '#';\r\n  nextLink.setAttribute('aria-label', 'Siguiente');\r\n  nextLink.innerHTML = '<span aria-hidden=\"true\">&raquo;</span>';\r\n  \r\n  nextLink.addEventListener('click', function(e) {\r\n    e.preventDefault();\r\n    if (pagination.page < pagination.totalPages) {\r\n      cargarProductos(pagination.page + 1);\r\n      \r\n      // Actualizar URL sin recargar página\r\n      const url = new URL(window.location);\r\n      url.searchParams.set('page', pagination.page + 1);\r\n      window.history.pushState({}, '', url);\r\n    }\r\n  });\r\n  \r\n  nextLi.appendChild(nextLink);\r\n  paginationElement.appendChild(nextLi);\r\n}\r\n\r\n// Función para mostrar error general\r\nfunction mostrarErrorGeneral(mensaje) {\r\n  const container = document.querySelector('.container.my-5');\r\n  if (!container) {\r\n    console.error('No se encontró contenedor para mostrar error:', mensaje);\r\n    alert(mensaje); // Fallback a alert si no hay contenedor\r\n    return;\r\n  }\r\n  \r\n  const alerta = document.createElement('div');\r\n  alerta.className = 'alert alert-danger mb-4';\r\n  alerta.role = 'alert';\r\n  alerta.innerHTML = `\r\n    <i class=\"fas fa-exclamation-triangle me-2\"></i>\r\n    ${mensaje}\r\n  `;\r\n  \r\n  // Insertar al principio del contenedor\r\n  container.insertBefore(alerta, container.firstChild);\r\n  \r\n  // Eliminar después de 10 segundos\r\n  setTimeout(() => {\r\n    if (alerta.parentNode) {\r\n      alerta.remove();\r\n    }\r\n  }, 10000);\r\n}\r\n\r\n// Función para mostrar error de categorías\r\nfunction mostrarErrorCategorias(mensaje) {\r\n  console.log('Mostrando error de categorías:', mensaje);\r\n  const menuCategorias = document.getElementById('categorias-menu');\r\n  if (!menuCategorias) {\r\n    console.error('No se encontró el menú de categorías');\r\n    return;\r\n  }\r\n  \r\n  // Buscar el divisor\r\n  const divider = menuCategorias.querySelector('hr');\r\n  const dividerParent = divider ? divider.parentElement : null;\r\n  \r\n  // Agregar mensaje de error\r\n  const errorLi = document.createElement('li');\r\n  errorLi.className = 'px-3 py-2 text-danger small';\r\n  errorLi.innerHTML = `<i class=\"fas fa-exclamation-circle me-1\"></i> ${mensaje}`;\r\n  \r\n  if (dividerParent) {\r\n    menuCategorias.insertBefore(errorLi, dividerParent);\r\n  } else {\r\n    menuCategorias.appendChild(errorLi);\r\n  }\r\n  \r\n  // Agregar categorías estáticas como fallback\r\n  const categorias = [\r\n    { nombre: 'Herramientas', slug: 'herramientas' },\r\n    { nombre: 'Materiales', slug: 'materiales' },\r\n    { nombre: 'Seguridad', slug: 'seguridad' }\r\n  ];\r\n  \r\n  // Agregar categorías estáticas\r\n  categorias.forEach(categoria => {\r\n    const li = document.createElement('li');\r\n    const a = document.createElement('a');\r\n    a.className = 'dropdown-item';\r\n    a.href = `/categoria/${categoria.slug}`;\r\n    a.textContent = categoria.nombre;\r\n    li.appendChild(a);\r\n    \r\n    if (dividerParent) {\r\n      menuCategorias.insertBefore(li, dividerParent);\r\n    } else {\r\n      menuCategorias.appendChild(li);\r\n    }\r\n  });\r\n}",
      "productos.js": "// productos.js - Funciones para consumir la API de productos\r\n// Url de la API (actualizada al puerto 3001)\r\nconst API_URL = 'http://localhost:3001/api';\r\n\r\n// Función para manejar errores de fetch\r\nconst handleFetchError = (response) => {\r\n  if (!response.ok) {\r\n    throw new Error(`Error en la petición: ${response.status} ${response.statusText}`);\r\n  }\r\n  return response.json();\r\n};\r\n\r\n// Función para obtener todas las categorías\r\nasync function obtenerCategorias() {\r\n  try {\r\n    console.log('Obteniendo categorías desde:', `${API_URL}/categorias`);\r\n    const response = await fetch(`${API_URL}/categorias`);\r\n    return handleFetchError(response);\r\n  } catch (error) {\r\n    console.error('Error al obtener categorías:', error);\r\n    throw error;\r\n  }\r\n}\r\n\r\n// Función para obtener productos con paginación\r\nasync function obtenerProductos(page = 1, limit = 12) {\r\n  try {\r\n    console.log(`Obteniendo productos página ${page} desde:`, `${API_URL}/productos?page=${page}&limit=${limit}`);\r\n    const response = await fetch(`${API_URL}/productos?page=${page}&limit=${limit}`);\r\n    return handleFetchError(response);\r\n  } catch (error) {\r\n    console.error('Error al obtener productos:', error);\r\n    throw error;\r\n  }\r\n}\r\n\r\n// Función para obtener un producto por su ID\r\nasync function obtenerProductoPorId(id) {\r\n  try {\r\n    const response = await fetch(`${API_URL}/productos/${id}`);\r\n    return handleFetchError(response);\r\n  } catch (error) {\r\n    console.error(`Error al obtener producto con ID ${id}:`, error);\r\n    throw error;\r\n  }\r\n}\r\n\r\n// Función para obtener las imágenes de un producto\r\nasync function obtenerImagenesProducto(productoId) {\r\n  try {\r\n    console.log(`Obteniendo imágenes del producto ${productoId} desde:`, `${API_URL}/productos/${productoId}/imagenes`);\r\n    const response = await fetch(`${API_URL}/productos/${productoId}/imagenes`);\r\n    return handleFetchError(response);\r\n  } catch (error) {\r\n    console.error(`Error al obtener imágenes del producto ${productoId}:`, error);\r\n    throw error;\r\n  }\r\n}\r\n\r\nfunction getFullImageUrl(imagen, producto) {\r\n  // Usar el mapeador de imágenes si está disponible\r\n  if (window.imagenMapper) {\r\n    return imagenMapper.getImageUrl(imagen, producto);\r\n  }\r\n  \r\n  // Implementación de respaldo para cuando el mapeador no esté disponible\r\n  \r\n  // Si recibimos un objeto imagen completo\r\n  if (imagen && typeof imagen === 'object') {\r\n    // Si tiene url, usarla\r\n    if (imagen.url) {\r\n      return getFullImageUrl(imagen.url, producto);\r\n    }\r\n    // Si no tiene ninguna URL, usar un placeholder\r\n    return `https://placehold.co/300x200/007bff/white?text=${encodeURIComponent('Producto')}`;\r\n  }\r\n  \r\n  // Si la URL es nula o vacía, devolver un placeholder\r\n  if (!imagen) {\r\n    const categoriaTexto = producto && producto.categoria_id ? `Cat ${producto.categoria_id}` : 'Producto';\r\n    return `https://placehold.co/300x200/007bff/white?text=${encodeURIComponent(categoriaTexto)}`;\r\n  }\r\n  \r\n  // Si ya es una URL completa, devolverla tal cual\r\n  if (imagen.startsWith('http://') || imagen.startsWith('https://')) {\r\n    return imagen;\r\n  }\r\n  \r\n  // Obtener solo el nombre del archivo\r\n  const nombreArchivo = imagen.split('/').pop().split('\\\\').pop();\r\n  \r\n  // Crear un placeholder con el nombre del producto o archivo\r\n  const textoProducto = producto && producto.nombre ? producto.nombre : nombreArchivo;\r\n  return `https://placehold.co/300x200/007bff/white?text=${encodeURIComponent(textoProducto)}`;\r\n}\r\n\r\n\r\n// Función para obtener productos por categoría\r\nasync function obtenerProductosPorCategoria(categoriaId, page = 1, limit = 12) {\r\n  try {\r\n    const response = await fetch(`${API_URL}/categorias/${categoriaId}/productos?page=${page}&limit=${limit}`);\r\n    return handleFetchError(response);\r\n  } catch (error) {\r\n    console.error(`Error al obtener productos de la categoría ${categoriaId}:`, error);\r\n    throw error;\r\n  }\r\n}\r\n\r\n// Función para obtener productos destacados\r\nasync function obtenerProductosDestacados(limit = 10) {\r\n  try {\r\n    const response = await fetch(`${API_URL}/productos/destacados?limit=${limit}`);\r\n    return handleFetchError(response);\r\n  } catch (error) {\r\n    console.error('Error al obtener productos destacados:', error);\r\n    throw error;\r\n  }\r\n}\r\n\r\n// Función para obtener productos nuevos\r\nasync function obtenerProductosNuevos(limit = 10) {\r\n  try {\r\n    const response = await fetch(`${API_URL}/productos/nuevos?limit=${limit}`);\r\n    return handleFetchError(response);\r\n  } catch (error) {\r\n    console.error('Error al obtener productos nuevos:', error);\r\n    throw error;\r\n  }\r\n}\r\n\r\n// Función para buscar productos\r\nasync function buscarProductos(query, page = 1, limit = 12) {\r\n  try {\r\n    const response = await fetch(`${API_URL}/productos/buscar?q=${encodeURIComponent(query)}&page=${page}&limit=${limit}`);\r\n    return handleFetchError(response);\r\n  } catch (error) {\r\n    console.error('Error al buscar productos:', error);\r\n    throw error;\r\n  }\r\n}\r\n\r\n// Función para agregar un producto al carrito\r\nfunction agregarAlCarrito(id, nombre, precio, imagen) {\r\n  let carrito = JSON.parse(localStorage.getItem('carrito')) || [];\r\n  \r\n  // Verificar si el producto ya está en el carrito\r\n  const productoExistente = carrito.find(item => item.id === id);\r\n  \r\n  if (productoExistente) {\r\n    // Incrementar cantidad si ya existe\r\n    productoExistente.cantidad += 1;\r\n  } else {\r\n    // Agregar nuevo producto al carrito\r\n    carrito.push({\r\n      id,\r\n      nombre,\r\n      precio,\r\n      imagen,\r\n      cantidad: 1\r\n    });\r\n  }\r\n  \r\n  // Guardar carrito actualizado\r\n  localStorage.setItem('carrito', JSON.stringify(carrito));\r\n  \r\n  // Mostrar notificación\r\n  mostrarNotificacion(`${nombre} añadido al carrito`);\r\n  \r\n  // Actualizar contador del carrito\r\n  actualizarContadorCarrito();\r\n}\r\n\r\n// Función para mostrar notificación \r\nfunction mostrarNotificacion(mensaje) {\r\n  // Verificar si Bootstrap está disponible\r\n  if (typeof bootstrap !== 'undefined') {\r\n    // Crear elemento de notificación\r\n    const notificacion = document.createElement('div');\r\n    notificacion.className = 'toast align-items-center text-white bg-success';\r\n    notificacion.setAttribute('role', 'alert');\r\n    notificacion.setAttribute('aria-live', 'assertive');\r\n    notificacion.setAttribute('aria-atomic', 'true');\r\n    notificacion.innerHTML = `\r\n      <div class=\"d-flex\">\r\n        <div class=\"toast-body\">\r\n          ${mensaje}\r\n        </div>\r\n        <button type=\"button\" class=\"btn-close btn-close-white me-2 m-auto\" data-bs-dismiss=\"toast\" aria-label=\"Close\"></button>\r\n      </div>\r\n    `;\r\n    \r\n    // Crear contenedor si no existe\r\n    let toastContainer = document.querySelector('.toast-container');\r\n    if (!toastContainer) {\r\n      toastContainer = document.createElement('div');\r\n      toastContainer.className = 'toast-container position-fixed bottom-0 end-0 p-3';\r\n      document.body.appendChild(toastContainer);\r\n    }\r\n    \r\n    // Agregar notificación al contenedor\r\n    toastContainer.appendChild(notificacion);\r\n    \r\n    // Mostrar notificación\r\n    const toast = new bootstrap.Toast(notificacion);\r\n    toast.show();\r\n    \r\n    // Eliminar notificación después de ocultarse\r\n    notificacion.addEventListener('hidden.bs.toast', function() {\r\n      notificacion.remove();\r\n    });\r\n  } else {\r\n    // Si Bootstrap no está disponible, usar alert\r\n    alert(mensaje);\r\n  }\r\n}\r\n\r\n// Función para actualizar contador de carrito\r\nfunction actualizarContadorCarrito() {\r\n  const carrito = JSON.parse(localStorage.getItem('carrito')) || [];\r\n  const totalItems = carrito.reduce((total, item) => total + item.cantidad, 0);\r\n  \r\n  const cartLink = document.getElementById('cart-link');\r\n  if (cartLink) {\r\n    cartLink.innerHTML = `<i class=\"fas fa-shopping-cart me-1\"></i> Carrito ${totalItems > 0 ? `(${totalItems})` : ''}`;\r\n  }\r\n}",
      "profile.js": "document.addEventListener('DOMContentLoaded', function() {\r\n  if (!estaAutenticado()) {\r\n    window.location.href = '/login';\r\n    return;\r\n  }\r\n  \r\n  // Cargar datos del usuario\r\n  const usuario = getUsuarioActual();\r\n  \r\n  // Cargar datos personales\r\n  document.getElementById('profile-nombre').value = usuario.nombre || '';\r\n  document.getElementById('profile-apellido').value = usuario.apellido || '';\r\n  document.getElementById('profile-rut').value = usuario.rut || '';\r\n  document.getElementById('profile-email').value = usuario.email || '';\r\n  document.getElementById('profile-telefono').value = usuario.telefono || '';\r\n  \r\n  // Cargar direcciones\r\n  cargarDirecciones();\r\n  \r\n  // Configurar cerrar sesión\r\n  document.getElementById('logout-btn').addEventListener('click', function(e) {\r\n    e.preventDefault();\r\n    cerrarSesion();\r\n  });\r\n  \r\n  // Configurar formulario de perfil\r\n  document.getElementById('profile-form').addEventListener('submit', async function(e) {\r\n    e.preventDefault();\r\n    \r\n    const userData = {\r\n      nombre: document.getElementById('profile-nombre').value,\r\n      apellido: document.getElementById('profile-apellido').value,\r\n      telefono: document.getElementById('profile-telefono').value\r\n    };\r\n    \r\n    try {\r\n      await actualizarPerfil(usuario.id, userData);\r\n      \r\n      const successDiv = document.getElementById('profile-success');\r\n      successDiv.classList.remove('d-none');\r\n      \r\n      // Ocultar mensaje después de 3 segundos\r\n      setTimeout(() => {\r\n        successDiv.classList.add('d-none');\r\n      }, 3000);\r\n    } catch (error) {\r\n      const errorDiv = document.getElementById('profile-error');\r\n      errorDiv.textContent = error.message;\r\n      errorDiv.classList.remove('d-none');\r\n    }\r\n  });\r\n  \r\n  // Configurar formulario de cambio de contraseña\r\n  document.getElementById('password-form').addEventListener('submit', async function(e) {\r\n    e.preventDefault();\r\n    \r\n    const currentPassword = document.getElementById('current-password').value;\r\n    const newPassword = document.getElementById('new-password').value;\r\n    const confirmPassword = document.getElementById('confirm-password').value;\r\n    \r\n    if (newPassword !== confirmPassword) {\r\n      const errorDiv = document.getElementById('password-error');\r\n      errorDiv.textContent = 'Las contraseñas no coinciden';\r\n      errorDiv.classList.remove('d-none');\r\n      return;\r\n    }\r\n    \r\n    try {\r\n      const token = localStorage.getItem('authToken');\r\n      \r\n      const response = await fetch(`${API_URL}/usuarios/${usuario.id}/change-password`, {\r\n        method: 'PUT',\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n          'Authorization': `Bearer ${token}`\r\n        },\r\n        body: JSON.stringify({\r\n          currentPassword,\r\n          newPassword\r\n        })\r\n      });\r\n      \r\n      const data = await response.json();\r\n      \r\n      if (!response.ok) {\r\n        throw new Error(data.message || 'Error al cambiar contraseña');\r\n      }\r\n      \r\n      // Limpiar campos\r\n      document.getElementById('current-password').value = '';\r\n      document.getElementById('new-password').value = '';\r\n      document.getElementById('confirm-password').value = '';\r\n      \r\n      // Mostrar mensaje de éxito\r\n      const successDiv = document.getElementById('password-success');\r\n      successDiv.classList.remove('d-none');\r\n      \r\n      // Ocultar mensaje después de 3 segundos\r\n      setTimeout(() => {\r\n        successDiv.classList.add('d-none');\r\n      }, 3000);\r\n    } catch (error) {\r\n      const errorDiv = document.getElementById('password-error');\r\n      errorDiv.textContent = error.message;\r\n      errorDiv.classList.remove('d-none');\r\n    }\r\n  });\r\n  \r\n  // Configurar modal de direcciones\r\n  const addressModal = new bootstrap.Modal(document.getElementById('address-modal'));\r\n  \r\n  // Botón para agregar dirección\r\n  document.getElementById('add-address-btn').addEventListener('click', function() {\r\n    // Limpiar formulario\r\n    document.getElementById('address-form').reset();\r\n    document.getElementById('address-id').value = '';\r\n    document.getElementById('address-modal-title').textContent = 'Agregar dirección';\r\n    \r\n    // Mostrar modal\r\n    addressModal.show();\r\n  });\r\n  \r\n  // Guardar dirección\r\n  document.getElementById('save-address-btn').addEventListener('click', async function() {\r\n    const addressId = document.getElementById('address-id').value;\r\n    const isNewAddress = !addressId;\r\n    \r\n    const addressData = {\r\n      usuario_id: usuario.id,\r\n      direccion: document.getElementById('address-direccion').value,\r\n      comuna: document.getElementById('address-comuna').value,\r\n      ciudad: document.getElementById('address-ciudad').value,\r\n      region: document.getElementById('address-region').value,\r\n      codigo_postal: document.getElementById('address-codigo-postal').value,\r\n      telefono: document.getElementById('address-telefono').value,\r\n      instrucciones: document.getElementById('address-instrucciones').value,\r\n      predeterminada: document.getElementById('address-predeterminada').checked\r\n    };\r\n    \r\n    try {\r\n      const token = localStorage.getItem('authToken');\r\n      \r\n      let response;\r\n      \r\n      if (isNewAddress) {\r\n        // Crear nueva dirección\r\n        response = await fetch(`${API_URL}/direcciones`, {\r\n          method: 'POST',\r\n          headers: {\r\n            'Content-Type': 'application/json',\r\n            'Authorization': `Bearer ${token}`\r\n          },\r\n          body: JSON.stringify(addressData)\r\n        });\r\n      } else {\r\n        // Actualizar dirección existente\r\n        response = await fetch(`${API_URL}/direcciones/${addressId}`, {\r\n          method: 'PUT',\r\n          headers: {\r\n            'Content-Type': 'application/json',\r\n            'Authorization': `Bearer ${token}`\r\n          },\r\n          body: JSON.stringify(addressData)\r\n        });\r\n      }\r\n      \r\n      const data = await response.json();\r\n      \r\n      if (!response.ok) {\r\n        throw new Error(data.message || 'Error al guardar dirección');\r\n      }\r\n      \r\n      // Cerrar modal\r\n      addressModal.hide();\r\n      \r\n      // Recargar direcciones\r\n      cargarDirecciones();\r\n    } catch (error) {\r\n      const errorDiv = document.getElementById('address-modal-error');\r\n      errorDiv.textContent = error.message;\r\n      errorDiv.classList.remove('d-none');\r\n    }\r\n  });\r\n});\r\n\r\n// Función para cargar direcciones del usuario\r\nasync function cargarDirecciones() {\r\n  try {\r\n    const usuario = getUsuarioActual();\r\n    const token = localStorage.getItem('authToken');\r\n    \r\n    const response = await fetch(`${API_URL}/direcciones/usuario/${usuario.id}`, {\r\n      method: 'GET',\r\n      headers: {\r\n        'Authorization': `Bearer ${token}`\r\n      }\r\n    });\r\n    \r\n    const direcciones = await response.json();\r\n    \r\n    const container = document.getElementById('address-container');\r\n    const noAddresses = document.getElementById('no-addresses');\r\n    \r\n    // Limpiar contenedor\r\n    container.innerHTML = '';\r\n    \r\n    if (direcciones.length === 0) {\r\n      noAddresses.classList.remove('d-none');\r\n      return;\r\n    }\r\n    \r\n    noAddresses.classList.add('d-none');\r\n    \r\n    // Mostrar direcciones\r\n    direcciones.forEach(direccion => {\r\n      const col = document.createElement('div');\r\n      col.className = 'col-md-6 mb-3';\r\n      \r\n      const card = document.createElement('div');\r\n      card.className = 'card h-100';\r\n      if (direccion.predeterminada) {\r\n        card.classList.add('border-primary');\r\n      }\r\n      \r\n      const cardBody = document.createElement('div');\r\n      cardBody.className = 'card-body';\r\n      \r\n      // Insignia de predeterminada\r\n      if (direccion.predeterminada) {\r\n        const badge = document.createElement('span');\r\n        badge.className = 'badge bg-primary float-end';\r\n        badge.textContent = 'Predeterminada';\r\n        cardBody.appendChild(badge);\r\n      }\r\n      \r\n      // Contenido de la dirección\r\n      const content = document.createElement('div');\r\n      \r\n      // Dirección completa\r\n      const addressLine = document.createElement('p');\r\n      addressLine.className = 'mb-1';\r\n      addressLine.textContent = direccion.direccion;\r\n      content.appendChild(addressLine);\r\n      \r\n      // Comuna, ciudad y región\r\n      const locationLine = document.createElement('p');\r\n      locationLine.className = 'mb-1 text-muted';\r\n      locationLine.textContent = `${direccion.comuna}, ${direccion.ciudad}, ${direccion.region}`;\r\n      content.appendChild(locationLine);\r\n      \r\n      // Código postal\r\n      if (direccion.codigo_postal) {\r\n        const postalCode = document.createElement('p');\r\n        postalCode.className = 'mb-1 text-muted';\r\n        postalCode.textContent = `CP: ${direccion.codigo_postal}`;\r\n        content.appendChild(postalCode);\r\n      }\r\n      \r\n      // Teléfono\r\n      if (direccion.telefono) {\r\n        const phone = document.createElement('p');\r\n        phone.className = 'mb-1';\r\n        phone.textContent = `Tel: ${direccion.telefono}`;\r\n        content.appendChild(phone);\r\n      }\r\n      \r\n      // Instrucciones\r\n      if (direccion.instrucciones) {\r\n        const instructions = document.createElement('p');\r\n        instructions.className = 'mb-1 fst-italic';\r\n        instructions.textContent = direccion.instrucciones;\r\n        content.appendChild(instructions);\r\n      }\r\n      \r\n      cardBody.appendChild(content);\r\n      \r\n      // Botones de acción\r\n      const actions = document.createElement('div');\r\n      actions.className = 'mt-3 d-flex justify-content-end';\r\n      \r\n      // Botón editar\r\n      const editBtn = document.createElement('button');\r\n      editBtn.className = 'btn btn-sm btn-outline-primary me-2';\r\n      editBtn.innerHTML = '<i class=\"fas fa-edit\"></i> Editar';\r\n      editBtn.addEventListener('click', () => editarDireccion(direccion));\r\n      actions.appendChild(editBtn);\r\n      \r\n      // Botón eliminar\r\n      const deleteBtn = document.createElement('button');\r\n      deleteBtn.className = 'btn btn-sm btn-outline-danger';\r\n      deleteBtn.innerHTML = '<i class=\"fas fa-trash\"></i> Eliminar';\r\n      deleteBtn.addEventListener('click', () => eliminarDireccion(direccion.id));\r\n      actions.appendChild(deleteBtn);\r\n      \r\n      cardBody.appendChild(actions);\r\n      \r\n      card.appendChild(cardBody);\r\n      col.appendChild(card);\r\n      container.appendChild(col);\r\n    });\r\n  } catch (error) {\r\n    console.error('Error al cargar direcciones:', error);\r\n  }\r\n}\r\n\r\n// Función para editar dirección\r\nfunction editarDireccion(direccion) {\r\n  // Llenar formulario con datos de la dirección\r\n  document.getElementById('address-id').value = direccion.id;\r\n  document.getElementById('address-direccion').value = direccion.direccion;\r\n  document.getElementById('address-comuna').value = direccion.comuna;\r\n  document.getElementById('address-ciudad').value = direccion.ciudad;\r\n  document.getElementById('address-region').value = direccion.region;\r\n  document.getElementById('address-codigo-postal').value = direccion.codigo_postal || '';\r\n  document.getElementById('address-telefono').value = direccion.telefono || '';\r\n  document.getElementById('address-instrucciones').value = direccion.instrucciones || '';\r\n  document.getElementById('address-predeterminada').checked = direccion.predeterminada;\r\n  \r\n  // Cambiar título del modal\r\n  document.getElementById('address-modal-title').textContent = 'Editar dirección';\r\n  \r\n  // Mostrar modal\r\n  const addressModal = new bootstrap.Modal(document.getElementById('address-modal'));\r\n  addressModal.show();\r\n}\r\n\r\n// Función para eliminar dirección\r\nasync function eliminarDireccion(direccionId) {\r\n  if (!confirm('¿Estás seguro de eliminar esta dirección?')) {\r\n    return;\r\n  }\r\n  \r\n  try {\r\n    const token = localStorage.getItem('authToken');\r\n    \r\n    const response = await fetch(`${API_URL}/direcciones/${direccionId}`, {\r\n      method: 'DELETE',\r\n      headers: {\r\n        'Authorization': `Bearer ${token}`\r\n      }\r\n    });\r\n    \r\n    if (!response.ok) {\r\n      const data = await response.json();\r\n      throw new Error(data.message || 'Error al eliminar dirección');\r\n    }\r\n    \r\n    // Recargar direcciones\r\n    cargarDirecciones();\r\n  } catch (error) {\r\n    console.error('Error al eliminar dirección:', error);\r\n    alert(error.message);\r\n  }\r\n}",
      "register.js": "document.addEventListener('DOMContentLoaded', function() {\r\n  const registerForm = document.getElementById('register-form');\r\n  const nombreInput = document.getElementById('nombre');\r\n  const emailInput = document.getElementById('email');\r\n  const passwordInput = document.getElementById('password');\r\n  const passwordConfirmInput = document.getElementById('password-confirm');\r\n  const errorDiv = document.getElementById('error-message');\r\n  \r\n  // Verificar si ya está autenticado\r\n  if (estaAutenticado()) {\r\n    window.location.href = '/';\r\n    return;\r\n  }\r\n  \r\n  registerForm.addEventListener('submit', async function(e) {\r\n    e.preventDefault();\r\n    \r\n    // Limpiar mensaje de error anterior\r\n    errorDiv.classList.add('d-none');\r\n    \r\n    // Validación básica del lado del cliente\r\n    if (!nombreInput.value.trim()) {\r\n      errorDiv.textContent = 'El nombre es obligatorio';\r\n      errorDiv.classList.remove('d-none');\r\n      return;\r\n    }\r\n    \r\n    if (!emailInput.value.trim()) {\r\n      errorDiv.textContent = 'El correo electrónico es obligatorio';\r\n      errorDiv.classList.remove('d-none');\r\n      return;\r\n    }\r\n    \r\n    if (!passwordInput.value) {\r\n      errorDiv.textContent = 'La contraseña es obligatoria';\r\n      errorDiv.classList.remove('d-none');\r\n      return;\r\n    }\r\n    \r\n    if (passwordInput.value !== passwordConfirmInput.value) {\r\n      errorDiv.textContent = 'Las contraseñas no coinciden';\r\n      errorDiv.classList.remove('d-none');\r\n      return;\r\n    }\r\n    \r\n    const userData = {\r\n      nombre: nombreInput.value,\r\n      apellido: document.getElementById('apellido').value,\r\n      rut: document.getElementById('rut').value,\r\n      email: emailInput.value,\r\n      telefono: document.getElementById('telefono').value,\r\n      password: passwordInput.value,\r\n      direccion: document.getElementById('direccion').value,\r\n      comuna: document.getElementById('comuna').value,\r\n      ciudad: document.getElementById('ciudad').value,\r\n      region: document.getElementById('region').value\r\n    };\r\n    \r\n    try {\r\n      const data = await registrarUsuario(userData);\r\n      // Redirigir al usuario a la página principal\r\n      window.location.href = '/';\r\n    } catch (error) {\r\n      // Mostrar mensaje de error\r\n      errorDiv.textContent = error.message || 'Error al registrar usuario';\r\n      errorDiv.classList.remove('d-none');\r\n    }\r\n  });\r\n});\r\n\r\nasync function verificarEstadoAPI() {\r\n  try {\r\n    const response = await fetch(`${API_URL}`, {\r\n      method: 'GET'\r\n    });\r\n    \r\n    if (response.ok) {\r\n      console.log('✅ API funcionando correctamente');\r\n      const data = await response.json();\r\n      console.log('Información de la API:', data);\r\n    } else {\r\n      console.error('❌ API responde pero con error:', response.status);\r\n    }\r\n  } catch (error) {\r\n    console.error('❌ Error al conectar con la API:', error);\r\n  }\r\n}\r\n\r\n// Ejecutar al cargar la página\r\nverificarEstadoAPI();",
      "reset-password.js": "document.addEventListener('DOMContentLoaded', function() {\r\n  const resetPasswordForm = document.getElementById('reset-password-form');\r\n  const newPasswordInput = document.getElementById('new-password');\r\n  const confirmPasswordInput = document.getElementById('confirm-password');\r\n  const errorDiv = document.getElementById('error-message');\r\n  const successDiv = document.getElementById('success-message');\r\n  const tokenInput = document.getElementById('token');\r\n  \r\n  // Obtener token de la URL\r\n  const urlParams = new URLSearchParams(window.location.search);\r\n  const token = urlParams.get('token');\r\n  \r\n  if (!token) {\r\n    errorDiv.textContent = 'Token no proporcionado. Por favor, utiliza el enlace que se te envió por correo electrónico.';\r\n    errorDiv.classList.remove('d-none');\r\n    resetPasswordForm.style.display = 'none';\r\n    return;\r\n  }\r\n  \r\n  tokenInput.value = token;\r\n  \r\n  resetPasswordForm.addEventListener('submit', async function(e) {\r\n    e.preventDefault();\r\n    \r\n    // Limpiar mensajes anteriores\r\n    errorDiv.classList.add('d-none');\r\n    successDiv.classList.add('d-none');\r\n    \r\n    // Validación básica del lado del cliente\r\n    if (!newPasswordInput.value) {\r\n      errorDiv.textContent = 'La nueva contraseña es obligatoria';\r\n      errorDiv.classList.remove('d-none');\r\n      return;\r\n    }\r\n    \r\n    if (newPasswordInput.value !== confirmPasswordInput.value) {\r\n      errorDiv.textContent = 'Las contraseñas no coinciden';\r\n      errorDiv.classList.remove('d-none');\r\n      return;\r\n    }\r\n    \r\n    try {\r\n      const response = await fetch(`${API_URL}/auth/reset-password`, {\r\n        method: 'POST',\r\n        headers: {\r\n          'Content-Type': 'application/json'\r\n        },\r\n        body: JSON.stringify({\r\n          token: tokenInput.value,\r\n          newPassword: newPasswordInput.value\r\n        })\r\n      });\r\n      \r\n      const data = await response.json();\r\n      \r\n      if (!response.ok) {\r\n        throw new Error(data.message || 'Error al restablecer contraseña');\r\n      }\r\n      \r\n      // Mostrar mensaje de éxito\r\n      successDiv.classList.remove('d-none');\r\n      resetPasswordForm.style.display = 'none';\r\n      \r\n    } catch (error) {\r\n      // Mostrar mensaje de error\r\n      errorDiv.textContent = error.message;\r\n      errorDiv.classList.remove('d-none');\r\n    }\r\n  });\r\n});"
    },
    "pages": {
      "diagnostico.html": "<!DOCTYPE html>\r\n<html lang=\"es\">\r\n<head>\r\n  <meta charset=\"UTF-8\">\r\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\r\n  <title>Diagnóstico API | FERREMAS</title>\r\n  <link href=\"https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css\" rel=\"stylesheet\">\r\n</head>\r\n<body>\r\n  <div class=\"container my-5\">\r\n\r\n    <div class=\"container my-5\">\r\n    <h1>Diagnóstico de Conexión con API</h1>\r\n    \r\n    <div class=\"card mb-4\">\r\n      <div class=\"card-header\">Probar conexión con API</div>\r\n      <div class=\"card-body\">\r\n        <button id=\"boton-probar-api\" class=\"btn btn-primary mb-3\">Probar conexión</button>\r\n        <div id=\"diagnostico-resultados\"></div>\r\n      </div>\r\n    </div>\r\n    <h1>Diagnóstico de Conexión con API</h1>\r\n    \r\n    <div class=\"card mb-4\">\r\n      <div class=\"card-header\">Estado de la API</div>\r\n      <div class=\"card-body\">\r\n        <div id=\"api-status\">Comprobando conexión...</div>\r\n      </div>\r\n    </div>\r\n    \r\n    <div class=\"card mb-4\">\r\n      <div class=\"card-header\">Prueba de Registro</div>\r\n      <div class=\"card-body\">\r\n        <form id=\"test-register-form\">\r\n          <div class=\"mb-3\">\r\n            <label for=\"nombre\" class=\"form-label\">Nombre</label>\r\n            <input type=\"text\" class=\"form-control\" id=\"nombre\" value=\"Usuario Test\">\r\n          </div>\r\n          <div class=\"mb-3\">\r\n            <label for=\"email\" class=\"form-label\">Email</label>\r\n            <input type=\"email\" class=\"form-control\" id=\"email\" value=\"test@example.com\">\r\n          </div>\r\n          <div class=\"mb-3\">\r\n            <label for=\"password\" class=\"form-label\">Contraseña</label>\r\n            <input type=\"password\" class=\"form-control\" id=\"password\" value=\"password123\">\r\n          </div>\r\n          <button type=\"submit\" class=\"btn btn-primary\">Probar Registro</button>\r\n        </form>\r\n        <div id=\"register-result\" class=\"mt-3\"></div>\r\n      </div>\r\n    </div>\r\n    \r\n    <div class=\"card mb-4\">\r\n      <div class=\"card-header\">Prueba de Login</div>\r\n      <div class=\"card-body\">\r\n        <form id=\"test-login-form\">\r\n          <div class=\"mb-3\">\r\n            <label for=\"login-email\" class=\"form-label\">Email</label>\r\n            <input type=\"email\" class=\"form-control\" id=\"login-email\" value=\"test@example.com\">\r\n          </div>\r\n          <div class=\"mb-3\">\r\n            <label for=\"login-password\" class=\"form-label\">Contraseña</label>\r\n            <input type=\"password\" class=\"form-control\" id=\"login-password\" value=\"password123\">\r\n          </div>\r\n          <button type=\"submit\" class=\"btn btn-primary\">Probar Login</button>\r\n        </form>\r\n        <div id=\"login-result\" class=\"mt-3\"></div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n  <script src=\"https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js\"></script>\r\n  <script src=\"/js/diagnostico.js\"></script>\r\n  <script>\r\n    \r\n    const API_URL = 'http://localhost:3003/api';\r\n    \r\n    // Verificar estado de la API\r\n    async function checkApiStatus() {\r\n      try {\r\n        const response = await fetch(`${API_URL}`, {\r\n          method: 'GET'\r\n        });\r\n        \r\n        const statusDiv = document.getElementById('api-status');\r\n        \r\n        if (response.ok) {\r\n          const data = await response.json();\r\n          statusDiv.innerHTML = `\r\n            <div class=\"alert alert-success\">\r\n              <strong>✅ API funcionando correctamente</strong>\r\n              <pre>${JSON.stringify(data, null, 2)}</pre>\r\n            </div>\r\n          `;\r\n        } else {\r\n          statusDiv.innerHTML = `\r\n            <div class=\"alert alert-warning\">\r\n              <strong>⚠️ API responde pero con error: ${response.status}</strong>\r\n            </div>\r\n          `;\r\n        }\r\n      } catch (error) {\r\n        document.getElementById('api-status').innerHTML = `\r\n          <div class=\"alert alert-danger\">\r\n            <strong>❌ Error al conectar con la API</strong>\r\n            <p>${error.message}</p>\r\n            <p>Asegúrate de que el servidor de la API esté ejecutándose en http://localhost:3003</p>\r\n          </div>\r\n        `;\r\n      }\r\n    }\r\n    \r\n    // Probar registro\r\n    document.getElementById('test-register-form').addEventListener('submit', async function(e) {\r\n      e.preventDefault();\r\n      \r\n      const resultDiv = document.getElementById('register-result');\r\n      resultDiv.innerHTML = `<div class=\"alert alert-info\">Enviando solicitud...</div>`;\r\n      \r\n      try {\r\n        const response = await fetch(`${API_URL}/auth/register`, {\r\n          method: 'POST',\r\n          headers: {\r\n            'Content-Type': 'application/json'\r\n          },\r\n          body: JSON.stringify({\r\n            nombre: document.getElementById('nombre').value,\r\n            email: document.getElementById('email').value,\r\n            password: document.getElementById('password').value\r\n          })\r\n        });\r\n        \r\n        const data = await response.json();\r\n        \r\n        if (response.ok) {\r\n          resultDiv.innerHTML = `\r\n            <div class=\"alert alert-success\">\r\n              <strong>✅ Registro exitoso</strong>\r\n              <pre>${JSON.stringify(data, null, 2)}</pre>\r\n            </div>\r\n          `;\r\n        } else {\r\n          resultDiv.innerHTML = `\r\n            <div class=\"alert alert-warning\">\r\n              <strong>⚠️ Error en registro: ${response.status}</strong>\r\n              <pre>${JSON.stringify(data, null, 2)}</pre>\r\n            </div>\r\n          `;\r\n        }\r\n      } catch (error) {\r\n        resultDiv.innerHTML = `\r\n          <div class=\"alert alert-danger\">\r\n            <strong>❌ Error al enviar solicitud</strong>\r\n            <p>${error.message}</p>\r\n          </div>\r\n        `;\r\n      }\r\n    });\r\n    \r\n    // Probar login\r\n    document.getElementById('test-login-form').addEventListener('submit', async function(e) {\r\n      e.preventDefault();\r\n      \r\n      const resultDiv = document.getElementById('login-result');\r\n      resultDiv.innerHTML = `<div class=\"alert alert-info\">Enviando solicitud...</div>`;\r\n      \r\n      try {\r\n        const response = await fetch(`${API_URL}/auth/login`, {\r\n          method: 'POST',\r\n          headers: {\r\n            'Content-Type': 'application/json'\r\n          },\r\n          body: JSON.stringify({\r\n            email: document.getElementById('login-email').value,\r\n            password: document.getElementById('login-password').value\r\n          })\r\n        });\r\n        \r\n        const data = await response.json();\r\n        \r\n        if (response.ok) {\r\n          resultDiv.innerHTML = `\r\n            <div class=\"alert alert-success\">\r\n              <strong>✅ Login exitoso</strong>\r\n              <pre>${JSON.stringify(data, null, 2)}</pre>\r\n            </div>\r\n          `;\r\n        } else {\r\n          resultDiv.innerHTML = `\r\n            <div class=\"alert alert-warning\">\r\n              <strong>⚠️ Error en login: ${response.status}</strong>\r\n              <pre>${JSON.stringify(data, null, 2)}</pre>\r\n            </div>\r\n          `;\r\n        }\r\n      } catch (error) {\r\n        resultDiv.innerHTML = `\r\n          <div class=\"alert alert-danger\">\r\n            <strong>❌ Error al enviar solicitud</strong>\r\n            <p>${error.message}</p>\r\n          </div>\r\n        `;\r\n      }\r\n    });\r\n    \r\n    // Ejecutar al cargar la página\r\n    checkApiStatus();\r\n  </script>\r\n</body>\r\n</html>",
      "forgot-password.html": "<!DOCTYPE html>\r\n<html lang=\"es\">\r\n<head>\r\n  <meta charset=\"UTF-8\">\r\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\r\n  <title>Recuperar Contraseña | FERREMAS</title>\r\n  <link href=\"https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css\" rel=\"stylesheet\">\r\n  <link rel=\"stylesheet\" href=\"https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css\" />\r\n  <link rel=\"stylesheet\" href=\"/styles.css\">\r\n</head>\r\n<body>\r\n  <!-- Barra superior -->\r\n  <div class=\"bg-dark text-white py-2\">\r\n    <div class=\"container d-flex justify-content-between align-items-center\">\r\n      <small>Envío gratuito en compras sobre $50.000</small>\r\n      <div>\r\n        <small class=\"me-3\">\r\n          <i class=\"fas fa-home me-1\"></i>\r\n          Santiago, Chile\r\n        </small>\r\n        <small>\r\n          <i class=\"fas fa-phone me-1\"></i>+56 2 2345 6789\r\n        </small>\r\n      </div>\r\n    </div>\r\n  </div>\r\n\r\n  <!-- Navbar -->\r\n  <nav class=\"navbar navbar-expand-lg navbar-dark bg-primary py-3\">\r\n    <div class=\"container\">\r\n      <a class=\"navbar-brand\" href=\"/\">\r\n        <img src=\"https://placehold.co/150x50/primary/white?text=FERREMAS\" alt=\"FERREMAS\" height=\"40\">\r\n      </a>\r\n      <button class=\"navbar-toggler\" type=\"button\" data-bs-toggle=\"collapse\" data-bs-target=\"#navbarNav\">\r\n        <span class=\"navbar-toggler-icon\"></span>\r\n      </button>\r\n      <div class=\"collapse navbar-collapse\" id=\"navbarNav\">\r\n        <ul class=\"navbar-nav me-auto\">\r\n          <li class=\"nav-item\">\r\n            <a class=\"nav-link mx-2\" href=\"/\">Inicio</a>\r\n          </li>\r\n          <li class=\"nav-item dropdown\">\r\n            <a class=\"nav-link dropdown-toggle mx-2\" href=\"#\" role=\"button\" data-bs-toggle=\"dropdown\">\r\n              Categorías\r\n            </a>\r\n            <ul class=\"dropdown-menu\">\r\n              <li><a class=\"dropdown-item\" href=\"/categoria/herramientas\">Herramientas</a></li>\r\n              <li><a class=\"dropdown-item\" href=\"/categoria/materiales\">Materiales de Construcción</a></li>\r\n              <li><a class=\"dropdown-item\" href=\"/categoria/seguridad\">Equipos de Seguridad</a></li>\r\n              <li><hr class=\"dropdown-divider\"></li>\r\n              <li><a class=\"dropdown-item\" href=\"/productos\">Ver todos los productos</a></li>\r\n            </ul>\r\n          </li>\r\n          <li class=\"nav-item\">\r\n            <a class=\"nav-link mx-2\" href=\"/ofertas\">Ofertas</a>\r\n          </li>\r\n          <li class=\"nav-item\">\r\n            <a class=\"nav-link mx-2\" href=\"/contacto\">Contacto</a>\r\n          </li>\r\n        </ul>\r\n        <ul class=\"navbar-nav ms-auto\">\r\n          <li class=\"nav-item\">\r\n            <a class=\"nav-link mx-2\" href=\"/carrito\" id=\"cart-link\">\r\n              <i class=\"fas fa-shopping-cart me-1\"></i> Carrito\r\n            </a>\r\n          </li>\r\n          <li class=\"nav-item active\">\r\n            <a class=\"nav-link mx-2\" href=\"/login\">\r\n              <i class=\"fas fa-user me-1\"></i> Iniciar Sesión\r\n            </a>\r\n          </li>\r\n        </ul>\r\n      </div>\r\n    </div>\r\n  </nav>\r\n\r\n  <div class=\"container my-5\">\r\n    <div class=\"row justify-content-center\">\r\n      <div class=\"col-md-6\">\r\n        <div class=\"card shadow\">\r\n          <div class=\"card-body p-5\">\r\n            <h2 class=\"text-center mb-4\">Recuperar Contraseña</h2>\r\n            <div id=\"error-message\" class=\"alert alert-danger d-none\"></div>\r\n            <div id=\"success-message\" class=\"alert alert-success d-none\">Se ha enviado un correo con instrucciones para recuperar tu contraseña.</div>\r\n            \r\n            <p class=\"text-muted mb-4\">Ingresa tu correo electrónico y te enviaremos un enlace para restablecer tu contraseña.</p>\r\n            \r\n            <form id=\"forgot-password-form\">\r\n              <div class=\"mb-3\">\r\n                <label for=\"email\" class=\"form-label\">Correo Electrónico</label>\r\n                <input type=\"email\" class=\"form-control\" id=\"email\" required>\r\n              </div>\r\n              \r\n              <div class=\"d-grid gap-2\">\r\n                <button type=\"submit\" class=\"btn btn-primary\">Enviar Enlace</button>\r\n              </div>\r\n            </form>\r\n            \r\n            <hr class=\"my-4\">\r\n            \r\n            <div class=\"text-center\">\r\n              <p>¿Recordaste tu contraseña? <a href=\"/login\">Volver a Iniciar Sesión</a></p>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n\r\n  <!-- Footer -->\r\n  <footer class=\"bg-dark text-light py-4 mt-5\">\r\n    <div class=\"container\">\r\n      <div class=\"row\">\r\n        <div class=\"col-md-4 mb-4 mb-md-0\">\r\n          <h5>FERREMAS</h5>\r\n          <p class=\"text-muted\">\r\n            Empresa chilena de productos de ferretería y construcción, \r\n            establecida desde la década de los 80 con más de 7 sucursales \r\n            en todo el país.\r\n          </p>\r\n        </div>\r\n        <div class=\"col-md-3 mb-4 mb-md-0\">\r\n          <h5>Enlaces Rápidos</h5>\r\n          <ul class=\"list-unstyled\">\r\n            <li><a href=\"/\" class=\"text-muted\">Inicio</a></li>\r\n            <li><a href=\"/productos\" class=\"text-muted\">Productos</a></li>\r\n            <li><a href=\"/ofertas\" class=\"text-muted\">Ofertas</a></li>\r\n            <li><a href=\"/contacto\" class=\"text-muted\">Contacto</a></li>\r\n          </ul>\r\n        </div>\r\n        <div class=\"col-md-3 mb-4 mb-md-0\">\r\n          <h5>Categorías</h5>\r\n          <ul class=\"list-unstyled\">\r\n            <li><a href=\"/categoria/herramientas\" class=\"text-muted\">Herramientas</a></li>\r\n            <li><a href=\"/categoria/materiales\" class=\"text-muted\">Materiales</a></li>\r\n            <li><a href=\"/categoria/seguridad\" class=\"text-muted\">Seguridad</a></li>\r\n            <li><a href=\"/categoria/accesorios\" class=\"text-muted\">Accesorios</a></li>\r\n          </ul>\r\n        </div>\r\n        <div class=\"col-md-2\">\r\n          <h5>Contacto</h5>\r\n          <ul class=\"list-unstyled\">\r\n            <li class=\"mb-2\">\r\n              <i class=\"fas fa-map-marker-alt me-2\"></i>\r\n              <span class=\"text-muted\">Santiago, Chile</span>\r\n            </li>\r\n            <li class=\"mb-2\">\r\n              <i class=\"fas fa-phone me-2\"></i>\r\n              <span class=\"text-muted\">+56 2 2345 6789</span>\r\n            </li>\r\n            <li>\r\n              <i class=\"fas fa-envelope me-2\"></i>\r\n              <span class=\"text-muted\">contacto@ferremas.cl</span>\r\n            </li>\r\n          </ul>\r\n        </div>\r\n      </div>\r\n      <hr class=\"my-4 bg-secondary\">\r\n      <div class=\"row\">\r\n        <div class=\"col text-center text-muted\">\r\n          <p class=\"mb-0\">© 2025 FERREMAS. Todos los derechos reservados.</p>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </footer>\r\n\r\n  <!-- Scripts -->\r\n  <script src=\"https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js\"></script>\r\n  <script src=\"/js/auth.js\"></script>\r\n  <script src=\"/js/forgot-password.js\"></script>\r\n</body>\r\n</html>",
      "login.html": "<!DOCTYPE html>\r\n<html lang=\"es\">\r\n<head>\r\n  <meta charset=\"UTF-8\">\r\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\r\n  <title>Iniciar Sesión | FERREMAS</title>\r\n  <link href=\"https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css\" rel=\"stylesheet\">\r\n  <link rel=\"stylesheet\" href=\"https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css\" />\r\n  <link rel=\"stylesheet\" href=\"/styles.css\">\r\n</head>\r\n<body>\r\n  <!-- Barra superior -->\r\n  <div class=\"bg-dark text-white py-2\">\r\n    <div class=\"container d-flex justify-content-between align-items-center\">\r\n      <small>Envío gratuito en compras sobre $50.000</small>\r\n      <div>\r\n        <small class=\"me-3\">\r\n          <i class=\"fas fa-home me-1\"></i>\r\n          Santiago, Chile\r\n        </small>\r\n        <small>\r\n          <i class=\"fas fa-phone me-1\"></i>+56 2 2345 6789\r\n        </small>\r\n      </div>\r\n    </div>\r\n  </div>\r\n\r\n  <!-- Navbar -->\r\n  <nav class=\"navbar navbar-expand-lg navbar-dark bg-primary py-3\">\r\n    <div class=\"container\">\r\n      <a class=\"navbar-brand\" href=\"/\">\r\n        <img src=\"https://placehold.co/150x50/primary/white?text=FERREMAS\" alt=\"FERREMAS\" height=\"40\">\r\n      </a>\r\n      <button class=\"navbar-toggler\" type=\"button\" data-bs-toggle=\"collapse\" data-bs-target=\"#navbarNav\">\r\n        <span class=\"navbar-toggler-icon\"></span>\r\n      </button>\r\n      <div class=\"collapse navbar-collapse\" id=\"navbarNav\">\r\n        <ul class=\"navbar-nav me-auto\">\r\n          <li class=\"nav-item\">\r\n            <a class=\"nav-link mx-2\" href=\"/\">Inicio</a>\r\n          </li>\r\n          <li class=\"nav-item dropdown\">\r\n            <a class=\"nav-link dropdown-toggle mx-2\" href=\"#\" role=\"button\" data-bs-toggle=\"dropdown\">\r\n              Categorías\r\n            </a>\r\n            <ul class=\"dropdown-menu\">\r\n              <li><a class=\"dropdown-item\" href=\"/categoria/herramientas\">Herramientas</a></li>\r\n              <li><a class=\"dropdown-item\" href=\"/categoria/materiales\">Materiales de Construcción</a></li>\r\n              <li><a class=\"dropdown-item\" href=\"/categoria/seguridad\">Equipos de Seguridad</a></li>\r\n              <li><hr class=\"dropdown-divider\"></li>\r\n              <li><a class=\"dropdown-item\" href=\"/productos\">Ver todos los productos</a></li>\r\n            </ul>\r\n          </li>\r\n          <li class=\"nav-item\">\r\n            <a class=\"nav-link mx-2\" href=\"/ofertas\">Ofertas</a>\r\n          </li>\r\n          <li class=\"nav-item\">\r\n            <a class=\"nav-link mx-2\" href=\"/contacto\">Contacto</a>\r\n          </li>\r\n        </ul>\r\n        <ul class=\"navbar-nav ms-auto\">\r\n          <li class=\"nav-item\">\r\n            <a class=\"nav-link mx-2\" href=\"/carrito\" id=\"cart-link\">\r\n              <i class=\"fas fa-shopping-cart me-1\"></i> Carrito\r\n            </a>\r\n          </li>\r\n          <li class=\"nav-item active\">\r\n            <a class=\"nav-link mx-2\" href=\"/login\">\r\n              <i class=\"fas fa-user me-1\"></i> Iniciar Sesión\r\n            </a>\r\n          </li>\r\n        </ul>\r\n      </div>\r\n    </div>\r\n  </nav>\r\n\r\n  <div class=\"container my-5\">\r\n    <div class=\"row justify-content-center\">\r\n      <div class=\"col-md-6\">\r\n        <div class=\"card shadow\">\r\n          <div class=\"card-body p-5\">\r\n            <h2 class=\"text-center mb-4\">Iniciar Sesión</h2>\r\n            <div id=\"error-message\" class=\"alert alert-danger d-none\"></div>\r\n            \r\n            <form id=\"login-form\">\r\n              <div class=\"mb-3\">\r\n                <label for=\"email\" class=\"form-label\">Correo Electrónico</label>\r\n                <input type=\"email\" class=\"form-control\" id=\"email\" required>\r\n              </div>\r\n              <div class=\"mb-3\">\r\n                <label for=\"password\" class=\"form-label\">Contraseña</label>\r\n                <input type=\"password\" class=\"form-control\" id=\"password\" required>\r\n              </div>\r\n              <div class=\"mb-3 form-check\">\r\n                <input type=\"checkbox\" class=\"form-check-input\" id=\"remember-me\">\r\n                <label class=\"form-check-label\" for=\"remember-me\">Recordarme</label>\r\n              </div>\r\n              <div class=\"d-grid gap-2\">\r\n                <button type=\"submit\" class=\"btn btn-primary\">Iniciar Sesión</button>\r\n              </div>\r\n            </form>\r\n            \r\n            <div class=\"text-center mt-3\">\r\n              <a href=\"/forgot-password\">¿Olvidaste tu contraseña?</a>\r\n            </div>\r\n            \r\n            <hr class=\"my-4\">\r\n            \r\n            <div class=\"text-center\">\r\n              <p>¿No tienes una cuenta? <a href=\"/register\">Regístrate</a></p>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n\r\n  <!-- Footer -->\r\n  <footer class=\"bg-dark text-light py-4 mt-5\">\r\n    <div class=\"container\">\r\n      <div class=\"row\">\r\n        <div class=\"col-md-4 mb-4 mb-md-0\">\r\n          <h5>FERREMAS</h5>\r\n          <p class=\"text-muted\">\r\n            Empresa chilena de productos de ferretería y construcción, \r\n            establecida desde la década de los 80 con más de 7 sucursales \r\n            en todo el país.\r\n          </p>\r\n        </div>\r\n        <div class=\"col-md-3 mb-4 mb-md-0\">\r\n          <h5>Enlaces Rápidos</h5>\r\n          <ul class=\"list-unstyled\">\r\n            <li><a href=\"/\" class=\"text-muted\">Inicio</a></li>\r\n            <li><a href=\"/productos\" class=\"text-muted\">Productos</a></li>\r\n            <li><a href=\"/ofertas\" class=\"text-muted\">Ofertas</a></li>\r\n            <li><a href=\"/contacto\" class=\"text-muted\">Contacto</a></li>\r\n          </ul>\r\n        </div>\r\n        <div class=\"col-md-3 mb-4 mb-md-0\">\r\n          <h5>Categorías</h5>\r\n          <ul class=\"list-unstyled\">\r\n            <li><a href=\"/categoria/herramientas\" class=\"text-muted\">Herramientas</a></li>\r\n            <li><a href=\"/categoria/materiales\" class=\"text-muted\">Materiales</a></li>\r\n            <li><a href=\"/categoria/seguridad\" class=\"text-muted\">Seguridad</a></li>\r\n            <li><a href=\"/categoria/accesorios\" class=\"text-muted\">Accesorios</a></li>\r\n          </ul>\r\n        </div>\r\n        <div class=\"col-md-2\">\r\n          <h5>Contacto</h5>\r\n          <ul class=\"list-unstyled\">\r\n            <li class=\"mb-2\">\r\n              <i class=\"fas fa-map-marker-alt me-2\"></i>\r\n              <span class=\"text-muted\">Santiago, Chile</span>\r\n            </li>\r\n            <li class=\"mb-2\">\r\n              <i class=\"fas fa-phone me-2\"></i>\r\n              <span class=\"text-muted\">+56 2 2345 6789</span>\r\n            </li>\r\n            <li>\r\n              <i class=\"fas fa-envelope me-2\"></i>\r\n              <span class=\"text-muted\">contacto@ferremas.cl</span>\r\n            </li>\r\n          </ul>\r\n        </div>\r\n      </div>\r\n      <hr class=\"my-4 bg-secondary\">\r\n      <div class=\"row\">\r\n        <div class=\"col text-center text-muted\">\r\n          <p class=\"mb-0\">© 2025 FERREMAS. Todos los derechos reservados.</p>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </footer>\r\n\r\n  <!-- Scripts -->\r\n  <script src=\"https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js\"></script>\r\n  <script src=\"/js/auth.js\"></script>\r\n  <script src=\"/js/login.js\"></script>\r\n</body>\r\n</html>",
      "productos.html": "<!DOCTYPE html>\r\n<html lang=\"es\">\r\n<head>\r\n  <meta charset=\"UTF-8\">\r\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\r\n  <title>Productos | FERREMAS</title>\r\n  <link href=\"https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css\" rel=\"stylesheet\">\r\n  <link rel=\"stylesheet\" href=\"https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css\" />\r\n  <link rel=\"stylesheet\" href=\"/styles.css\">\r\n</head>\r\n<body>\r\n  <!-- Barra superior -->\r\n  <div class=\"bg-dark text-white py-2\">\r\n    <div class=\"container d-flex justify-content-between align-items-center\">\r\n      <small>Envío gratuito en compras sobre $50.000</small>\r\n      <div>\r\n        <small class=\"me-3\">\r\n          <i class=\"fas fa-home me-1\"></i>\r\n          Santiago, Chile\r\n        </small>\r\n        <small>\r\n          <i class=\"fas fa-phone me-1\"></i>+56 2 2345 6789\r\n        </small>\r\n      </div>\r\n    </div>\r\n  </div>\r\n\r\n  <!-- Navbar -->\r\n  <nav class=\"navbar navbar-expand-lg navbar-dark bg-primary py-3\">\r\n    <div class=\"container\">\r\n      <a class=\"navbar-brand\" href=\"/\">\r\n        <img src=\"https://placehold.co/150x50/primary/white?text=FERREMAS\" alt=\"FERREMAS\" height=\"40\">\r\n      </a>\r\n      <button class=\"navbar-toggler\" type=\"button\" data-bs-toggle=\"collapse\" data-bs-target=\"#navbarNav\">\r\n        <span class=\"navbar-toggler-icon\"></span>\r\n      </button>\r\n      <div class=\"collapse navbar-collapse\" id=\"navbarNav\">\r\n        <ul class=\"navbar-nav me-auto\">\r\n          <li class=\"nav-item\">\r\n            <a class=\"nav-link mx-2\" href=\"/\">Inicio</a>\r\n          </li>\r\n          <li class=\"nav-item dropdown\">\r\n            <a class=\"nav-link dropdown-toggle mx-2 active\" href=\"#\" role=\"button\" data-bs-toggle=\"dropdown\">\r\n              Categorías\r\n            </a>\r\n            <ul class=\"dropdown-menu\" id=\"categorias-menu\">\r\n              <!-- Las categorías se cargarán dinámicamente aquí -->\r\n              <li><hr class=\"dropdown-divider\"></li>\r\n              <li><a class=\"dropdown-item active\" href=\"/productos\">Ver todos los productos</a></li>\r\n            </ul>\r\n          </li>\r\n          <li class=\"nav-item\">\r\n            <a class=\"nav-link mx-2\" href=\"/ofertas\">Ofertas</a>\r\n          </li>\r\n          <li class=\"nav-item\">\r\n            <a class=\"nav-link mx-2\" href=\"/contacto\">Contacto</a>\r\n          </li>\r\n        </ul>\r\n        <ul class=\"navbar-nav ms-auto\">\r\n          <li class=\"nav-item\">\r\n            <a class=\"nav-link mx-2\" href=\"/carrito\" id=\"cart-link\">\r\n              <i class=\"fas fa-shopping-cart me-1\"></i> Carrito\r\n            </a>\r\n          </li>\r\n          <li class=\"nav-item\" id=\"login-item\">\r\n            <a class=\"nav-link mx-2\" href=\"/login\">\r\n              <i class=\"fas fa-user me-1\"></i> Iniciar Sesión\r\n            </a>\r\n          </li>\r\n          <li class=\"nav-item dropdown d-none\" id=\"user-dropdown\">\r\n            <a class=\"nav-link dropdown-toggle mx-2\" href=\"#\" role=\"button\" data-bs-toggle=\"dropdown\">\r\n              <i class=\"fas fa-user-circle me-1\"></i> <span id=\"user-name\">Usuario</span>\r\n            </a>\r\n            <ul class=\"dropdown-menu dropdown-menu-end\">\r\n              <li><a class=\"dropdown-item\" href=\"/profile\">Mi Perfil</a></li>\r\n              <li><a class=\"dropdown-item\" href=\"/profile#pedidos\">Mis Pedidos</a></li>\r\n              <li><hr class=\"dropdown-divider\"></li>\r\n              <li><a class=\"dropdown-item text-danger\" href=\"#\" id=\"logout-link\">Cerrar Sesión</a></li>\r\n            </ul>\r\n          </li>\r\n        </ul>\r\n      </div>\r\n    </div>\r\n  </nav>\r\n\r\n  <!-- Contenido principal -->\r\n  <div class=\"container my-5\">\r\n    <h1 class=\"mb-4\">Todos los Productos</h1>\r\n    \r\n    <!-- Filtros y ordenamiento -->\r\n    <div class=\"row mb-4\">\r\n      <div class=\"col-md-6\">\r\n        <div class=\"input-group\">\r\n          <input type=\"text\" class=\"form-control\" placeholder=\"Buscar productos...\" id=\"search-input\">\r\n          <button class=\"btn btn-primary\" type=\"button\" id=\"search-button\">\r\n            <i class=\"fas fa-search\"></i>\r\n          </button>\r\n        </div>\r\n      </div>\r\n      <div class=\"col-md-6 text-md-end mt-3 mt-md-0\">\r\n        <select class=\"form-select d-inline-block w-auto\" id=\"sort-select\">\r\n          <option value=\"default\">Ordenar por</option>\r\n          <option value=\"price_asc\">Precio: Menor a Mayor</option>\r\n          <option value=\"price_desc\">Precio: Mayor a Menor</option>\r\n          <option value=\"name_asc\">Nombre: A-Z</option>\r\n          <option value=\"name_desc\">Nombre: Z-A</option>\r\n        </select>\r\n      </div>\r\n    </div>\r\n    \r\n    <!-- Grid de productos -->\r\n    <div class=\"row g-4\" id=\"productos-container\">\r\n      <!-- Los productos se cargarán dinámicamente aquí -->\r\n      <div class=\"col-12 text-center py-5\" id=\"loading\">\r\n        <div class=\"spinner-border text-primary\" role=\"status\">\r\n          <span class=\"visually-hidden\">Cargando...</span>\r\n        </div>\r\n        <p class=\"mt-2\">Cargando productos...</p>\r\n      </div>\r\n      <div class=\"col-12 text-center py-5 d-none\" id=\"no-products\">\r\n        <p class=\"text-muted\">No se encontraron productos</p>\r\n      </div>\r\n    </div>\r\n    \r\n    <!-- Paginación -->\r\n    <nav aria-label=\"Paginación de productos\" class=\"mt-5\">\r\n      <ul class=\"pagination justify-content-center\" id=\"pagination\">\r\n        <!-- La paginación se generará dinámicamente -->\r\n      </ul>\r\n    </nav>\r\n  </div>\r\n\r\n  <!-- Footer -->\r\n  <footer class=\"bg-dark text-light py-4 mt-5\">\r\n    <div class=\"container\">\r\n      <div class=\"row\">\r\n        <div class=\"col-md-4 mb-4 mb-md-0\">\r\n          <h5>FERREMAS</h5>\r\n          <p class=\"text-muted\">\r\n            Empresa chilena de productos de ferretería y construcción, \r\n            establecida desde la década de los 80 con más de 7 sucursales \r\n            en todo el país.\r\n          </p>\r\n        </div>\r\n        <div class=\"col-md-3 mb-4 mb-md-0\">\r\n          <h5>Enlaces Rápidos</h5>\r\n          <ul class=\"list-unstyled\">\r\n            <li><a href=\"/\" class=\"text-muted\">Inicio</a></li>\r\n            <li><a href=\"/productos\" class=\"text-muted\">Productos</a></li>\r\n            <li><a href=\"/ofertas\" class=\"text-muted\">Ofertas</a></li>\r\n            <li><a href=\"/contacto\" class=\"text-muted\">Contacto</a></li>\r\n          </ul>\r\n        </div>\r\n        <div class=\"col-md-3 mb-4 mb-md-0\">\r\n          <h5>Categorías</h5>\r\n          <ul class=\"list-unstyled\" id=\"footer-categorias\">\r\n            <!-- Las categorías se cargarán dinámicamente aquí -->\r\n          </ul>\r\n        </div>\r\n        <div class=\"col-md-2\">\r\n          <h5>Contacto</h5>\r\n          <ul class=\"list-unstyled\">\r\n            <li class=\"mb-2\">\r\n              <i class=\"fas fa-map-marker-alt me-2\"></i>\r\n              <span class=\"text-muted\">Santiago, Chile</span>\r\n            </li>\r\n            <li class=\"mb-2\">\r\n              <i class=\"fas fa-phone me-2\"></i>\r\n              <span class=\"text-muted\">+56 2 2345 6789</span>\r\n            </li>\r\n            <li>\r\n              <i class=\"fas fa-envelope me-2\"></i>\r\n              <span class=\"text-muted\">contacto@ferremas.cl</span>\r\n            </li>\r\n          </ul>\r\n        </div>\r\n      </div>\r\n      <hr class=\"my-4 bg-secondary\">\r\n      <div class=\"row\">\r\n        <div class=\"col text-center text-muted\">\r\n          <p class=\"mb-0\">© 2025 FERREMAS. Todos los derechos reservados.</p>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </footer>\r\n\r\n  <!-- Scripts -->\r\n<script src=\"https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js\"></script>\r\n<script src=\"/js/auth.js\"></script>\r\n<script src=\"/js/ferremas-api-client.js\"></script>\r\n</body>\r\n</html>",
      "profile.html": "<!DOCTYPE html>\r\n<html lang=\"es\">\r\n<head>\r\n  <meta charset=\"UTF-8\">\r\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\r\n  <title>Mi Perfil | FERREMAS</title>\r\n  <link href=\"https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css\" rel=\"stylesheet\">\r\n  <link rel=\"stylesheet\" href=\"https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css\" />\r\n  <link rel=\"stylesheet\" href=\"/styles.css\">\r\n</head>\r\n<body>\r\n  <!-- Barra superior -->\r\n  <div class=\"bg-dark text-white py-2\">\r\n    <div class=\"container d-flex justify-content-between align-items-center\">\r\n      <small>Envío gratuito en compras sobre $50.000</small>\r\n      <div>\r\n        <small class=\"me-3\">\r\n          <i class=\"fas fa-home me-1\"></i>\r\n          Santiago, Chile\r\n        </small>\r\n        <small>\r\n          <i class=\"fas fa-phone me-1\"></i>+56 2 2345 6789\r\n        </small>\r\n      </div>\r\n    </div>\r\n  </div>\r\n\r\n  <!-- Navbar -->\r\n  <nav class=\"navbar navbar-expand-lg navbar-dark bg-primary py-3\">\r\n    <div class=\"container\">\r\n      <a class=\"navbar-brand\" href=\"/\">\r\n        <img src=\"https://placehold.co/150x50/primary/white?text=FERREMAS\" alt=\"FERREMAS\" height=\"40\">\r\n      </a>\r\n      <button class=\"navbar-toggler\" type=\"button\" data-bs-toggle=\"collapse\" data-bs-target=\"#navbarNav\">\r\n        <span class=\"navbar-toggler-icon\"></span>\r\n      </button>\r\n      <div class=\"collapse navbar-collapse\" id=\"navbarNav\">\r\n        <ul class=\"navbar-nav me-auto\">\r\n          <li class=\"nav-item\">\r\n            <a class=\"nav-link mx-2\" href=\"/\">Inicio</a>\r\n          </li>\r\n          <li class=\"nav-item dropdown\">\r\n            <a class=\"nav-link dropdown-toggle mx-2\" href=\"#\" role=\"button\" data-bs-toggle=\"dropdown\">\r\n              Categorías\r\n            </a>\r\n            <ul class=\"dropdown-menu\">\r\n              <li><a class=\"dropdown-item\" href=\"/categoria/herramientas\">Herramientas</a></li>\r\n              <li><a class=\"dropdown-item\" href=\"/categoria/materiales\">Materiales de Construcción</a></li>\r\n              <li><a class=\"dropdown-item\" href=\"/categoria/seguridad\">Equipos de Seguridad</a></li>\r\n              <li><hr class=\"dropdown-divider\"></li>\r\n              <li><a class=\"dropdown-item\" href=\"/productos\">Ver todos los productos</a></li>\r\n            </ul>\r\n          </li>\r\n          <li class=\"nav-item\">\r\n            <a class=\"nav-link mx-2\" href=\"/ofertas\">Ofertas</a>\r\n          </li>\r\n          <li class=\"nav-item\">\r\n            <a class=\"nav-link mx-2\" href=\"/contacto\">Contacto</a>\r\n          </li>\r\n        </ul>\r\n        <ul class=\"navbar-nav ms-auto\">\r\n          <li class=\"nav-item\">\r\n            <a class=\"nav-link mx-2\" href=\"/carrito\" id=\"cart-link\">\r\n              <i class=\"fas fa-shopping-cart me-1\"></i> Carrito\r\n            </a>\r\n          </li>\r\n          <li class=\"nav-item dropdown active\" id=\"user-dropdown\">\r\n            <a class=\"nav-link dropdown-toggle mx-2\" href=\"#\" role=\"button\" data-bs-toggle=\"dropdown\">\r\n              <i class=\"fas fa-user-circle me-1\"></i> <span id=\"user-name\">Usuario</span>\r\n            </a>\r\n            <ul class=\"dropdown-menu dropdown-menu-end\">\r\n              <li><a class=\"dropdown-item\" href=\"/profile\">Mi Perfil</a></li>\r\n              <li><a class=\"dropdown-item\" href=\"/profile#pedidos\">Mis Pedidos</a></li>\r\n              <li><hr class=\"dropdown-divider\"></li>\r\n              <li><a class=\"dropdown-item text-danger\" href=\"#\" id=\"navbar-logout-link\">Cerrar Sesión</a></li>\r\n            </ul>\r\n          </li>\r\n        </ul>\r\n      </div>\r\n    </div>\r\n  </nav>\r\n\r\n  <div class=\"container my-5\">\r\n    <div class=\"row\">\r\n      <!-- Menú lateral -->\r\n      <div class=\"col-md-3 mb-4\">\r\n        <div class=\"card\">\r\n          <div class=\"card-body\">\r\n            <h5 class=\"card-title mb-4\">Mi cuenta</h5>\r\n            <ul class=\"nav flex-column nav-pills\">\r\n              <li class=\"nav-item mb-2\">\r\n                <a class=\"nav-link active\" href=\"#datos-personales\" data-bs-toggle=\"tab\">Datos personales</a>\r\n              </li>\r\n              <li class=\"nav-item mb-2\">\r\n                <a class=\"nav-link\" href=\"#direcciones\" data-bs-toggle=\"tab\">Mis direcciones</a>\r\n              </li>\r\n              <li class=\"nav-item mb-2\">\r\n                <a class=\"nav-link\" href=\"#pedidos\" data-bs-toggle=\"tab\">Mis pedidos</a>\r\n              </li>\r\n              <li class=\"nav-item mb-2\">\r\n                <a class=\"nav-link\" href=\"#cambiar-password\" data-bs-toggle=\"tab\">Cambiar contraseña</a>\r\n              </li>\r\n              <li class=\"nav-item\">\r\n                <a class=\"nav-link text-danger\" href=\"#\" id=\"logout-btn\">Cerrar sesión</a>\r\n              </li>\r\n            </ul>\r\n          </div>\r\n        </div>\r\n      </div>\r\n      \r\n      <!-- Contenido principal -->\r\n      <div class=\"col-md-9\">\r\n        <div class=\"tab-content\">\r\n          <!-- Datos personales -->\r\n          <div class=\"tab-pane fade show active\" id=\"datos-personales\">\r\n            <div class=\"card\">\r\n              <div class=\"card-header bg-primary text-white\">\r\n                <h5 class=\"card-title mb-0\">Datos personales</h5>\r\n              </div>\r\n              <div class=\"card-body\">\r\n                <div id=\"profile-error\" class=\"alert alert-danger d-none\"></div>\r\n                <div id=\"profile-success\" class=\"alert alert-success d-none\">Datos actualizados correctamente</div>\r\n                \r\n                <form id=\"profile-form\">\r\n                  <div class=\"row\">\r\n                    <div class=\"col-md-6 mb-3\">\r\n                      <label for=\"profile-nombre\" class=\"form-label\">Nombre</label>\r\n                      <input type=\"text\" class=\"form-control\" id=\"profile-nombre\" required>\r\n                    </div>\r\n                    <div class=\"col-md-6 mb-3\">\r\n                      <label for=\"profile-apellido\" class=\"form-label\">Apellido</label>\r\n                      <input type=\"text\" class=\"form-control\" id=\"profile-apellido\">\r\n                    </div>\r\n                  </div>\r\n                  \r\n                  <div class=\"mb-3\">\r\n                    <label for=\"profile-rut\" class=\"form-label\">RUT</label>\r\n                    <input type=\"text\" class=\"form-control\" id=\"profile-rut\" disabled>\r\n                  </div>\r\n                  \r\n                  <div class=\"mb-3\">\r\n                    <label for=\"profile-email\" class=\"form-label\">Correo Electrónico</label>\r\n                    <input type=\"email\" class=\"form-control\" id=\"profile-email\" disabled>\r\n                  </div>\r\n                  \r\n                  <div class=\"mb-3\">\r\n                    <label for=\"profile-telefono\" class=\"form-label\">Teléfono</label>\r\n                    <input type=\"tel\" class=\"form-control\" id=\"profile-telefono\">\r\n                  </div>\r\n                  \r\n                  <div class=\"text-end\">\r\n                    <button type=\"submit\" class=\"btn btn-primary\">Guardar cambios</button>\r\n                  </div>\r\n                </form>\r\n              </div>\r\n            </div>\r\n          </div>\r\n          \r\n          <!-- Mis direcciones -->\r\n          <div class=\"tab-pane fade\" id=\"direcciones\">\r\n            <div class=\"card\">\r\n              <div class=\"card-header bg-primary text-white d-flex justify-content-between align-items-center\">\r\n                <h5 class=\"card-title mb-0\">Mis direcciones</h5>\r\n                <button class=\"btn btn-light btn-sm\" id=\"add-address-btn\">\r\n                  <i class=\"fas fa-plus\"></i> Agregar dirección\r\n                </button>\r\n              </div>\r\n              <div class=\"card-body\">\r\n                <div id=\"address-container\" class=\"row\">\r\n                  <!-- Las direcciones se cargarán dinámicamente aquí -->\r\n                  <div class=\"col-12 text-center py-5\" id=\"no-addresses\">\r\n                    <p class=\"text-muted\">No tienes direcciones registradas</p>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n          \r\n          <!-- Mis pedidos -->\r\n          <div class=\"tab-pane fade\" id=\"pedidos\">\r\n            <div class=\"card\">\r\n              <div class=\"card-header bg-primary text-white\">\r\n                <h5 class=\"card-title mb-0\">Mis pedidos</h5>\r\n              </div>\r\n              <div class=\"card-body\">\r\n                <div id=\"orders-container\">\r\n                  <!-- Los pedidos se cargarán dinámicamente aquí -->\r\n                  <div class=\"text-center py-5\" id=\"no-orders\">\r\n                    <p class=\"text-muted\">No tienes pedidos realizados</p>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n          \r\n          <!-- Cambiar contraseña -->\r\n          <div class=\"tab-pane fade\" id=\"cambiar-password\">\r\n            <div class=\"card\">\r\n              <div class=\"card-header bg-primary text-white\">\r\n                <h5 class=\"card-title mb-0\">Cambiar contraseña</h5>\r\n              </div>\r\n              <div class=\"card-body\">\r\n                <div id=\"password-error\" class=\"alert alert-danger d-none\"></div>\r\n                <div id=\"password-success\" class=\"alert alert-success d-none\">Contraseña actualizada correctamente</div>\r\n                \r\n                <form id=\"password-form\">\r\n                  <div class=\"mb-3\">\r\n                    <label for=\"current-password\" class=\"form-label\">Contraseña actual</label>\r\n                    <input type=\"password\" class=\"form-control\" id=\"current-password\" required>\r\n                  </div>\r\n                  \r\n                  <div class=\"mb-3\">\r\n                    <label for=\"new-password\" class=\"form-label\">Nueva contraseña</label>\r\n                    <input type=\"password\" class=\"form-control\" id=\"new-password\" required>\r\n                  </div>\r\n                  \r\n                  <div class=\"mb-3\">\r\n                    <label for=\"confirm-password\" class=\"form-label\">Confirmar nueva contraseña</label>\r\n                    <input type=\"password\" class=\"form-control\" id=\"confirm-password\" required>\r\n                  </div>\r\n                  \r\n                  <div class=\"text-end\">\r\n                    <button type=\"submit\" class=\"btn btn-primary\">Cambiar contraseña</button>\r\n                  </div>\r\n                </form>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n\r\n  <!-- Modal para agregar/editar dirección -->\r\n  <div class=\"modal fade\" id=\"address-modal\" tabindex=\"-1\" aria-hidden=\"true\">\r\n    <div class=\"modal-dialog\">\r\n      <div class=\"modal-content\">\r\n        <div class=\"modal-header\">\r\n          <h5 class=\"modal-title\" id=\"address-modal-title\">Agregar dirección</h5>\r\n          <button type=\"button\" class=\"btn-close\" data-bs-dismiss=\"modal\" aria-label=\"Close\"></button>\r\n        </div>\r\n        <div class=\"modal-body\">\r\n          <div id=\"address-modal-error\" class=\"alert alert-danger d-none\"></div>\r\n          \r\n          <form id=\"address-form\">\r\n            <input type=\"hidden\" id=\"address-id\">\r\n            \r\n            <div class=\"mb-3\">\r\n              <label for=\"address-direccion\" class=\"form-label\">Dirección</label>\r\n              <input type=\"text\" class=\"form-control\" id=\"address-direccion\" required>\r\n            </div>\r\n            \r\n            <div class=\"row\">\r\n              <div class=\"col-md-4 mb-3\">\r\n                <label for=\"address-comuna\" class=\"form-label\">Comuna</label>\r\n                <input type=\"text\" class=\"form-control\" id=\"address-comuna\" required>\r\n              </div>\r\n              <div class=\"col-md-4 mb-3\">\r\n                <label for=\"address-ciudad\" class=\"form-label\">Ciudad</label>\r\n                <input type=\"text\" class=\"form-control\" id=\"address-ciudad\" required>\r\n              </div>\r\n              <div class=\"col-md-4 mb-3\">\r\n                <label for=\"address-region\" class=\"form-label\">Región</label>\r\n                <input type=\"text\" class=\"form-control\" id=\"address-region\" required>\r\n              </div>\r\n            </div>\r\n            \r\n            <div class=\"mb-3\">\r\n              <label for=\"address-codigo-postal\" class=\"form-label\">Código Postal</label>\r\n              <input type=\"text\" class=\"form-control\" id=\"address-codigo-postal\">\r\n            </div>\r\n            \r\n            <div class=\"mb-3\">\r\n              <label for=\"address-telefono\" class=\"form-label\">Teléfono de contacto</label>\r\n              <input type=\"tel\" class=\"form-control\" id=\"address-telefono\">\r\n            </div>\r\n            \r\n            <div class=\"mb-3\">\r\n              <label for=\"address-instrucciones\" class=\"form-label\">Instrucciones de entrega</label>\r\n              <textarea class=\"form-control\" id=\"address-instrucciones\" rows=\"2\"></textarea>\r\n            </div>\r\n            \r\n            <div class=\"mb-3 form-check\">\r\n              <input type=\"checkbox\" class=\"form-check-input\" id=\"address-predeterminada\">\r\n              <label class=\"form-check-label\" for=\"address-predeterminada\">Establecer como dirección predeterminada</label>\r\n            </div>\r\n          </form>\r\n        </div>\r\n        <div class=\"modal-footer\">\r\n          <button type=\"button\" class=\"btn btn-secondary\" data-bs-dismiss=\"modal\">Cancelar</button>\r\n          <button type=\"button\" class=\"btn btn-primary\" id=\"save-address-btn\">Guardar</button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n\r\n  <!-- Footer -->\r\n  <footer class=\"bg-dark text-light py-4 mt-5\">\r\n    <div class=\"container\">\r\n      <div class=\"row\">\r\n        <div class=\"col-md-4 mb-4 mb-md-0\">\r\n          <h5>FERREMAS</h5>\r\n          <p class=\"text-muted\">\r\n            Empresa chilena de productos de ferretería y construcción, \r\n            establecida desde la década de los 80 con más de 7 sucursales \r\n            en todo el país.\r\n          </p>\r\n        </div>\r\n        <div class=\"col-md-3 mb-4 mb-md-0\">\r\n          <h5>Enlaces Rápidos</h5>\r\n          <ul class=\"list-unstyled\">\r\n            <li><a href=\"/\" class=\"text-muted\">Inicio</a></li>\r\n            <li><a href=\"/productos\" class=\"text-muted\">Productos</a></li>\r\n            <li><a href=\"/ofertas\" class=\"text-muted\">Ofertas</a></li>\r\n            <li><a href=\"/contacto\" class=\"text-muted\">Contacto</a></li>\r\n          </ul>\r\n        </div>\r\n        <div class=\"col-md-3 mb-4 mb-md-0\">\r\n          <h5>Categorías</h5>\r\n          <ul class=\"list-unstyled\">\r\n            <li><a href=\"/categoria/herramientas\" class=\"text-muted\">Herramientas</a></li>\r\n            <li><a href=\"/categoria/materiales\" class=\"text-muted\">Materiales</a></li>\r\n            <li><a href=\"/categoria/seguridad\" class=\"text-muted\">Seguridad</a></li>\r\n            <li><a href=\"/categoria/accesorios\" class=\"text-muted\">Accesorios</a></li>\r\n          </ul>\r\n        </div>\r\n        <div class=\"col-md-2\">\r\n          <h5>Contacto</h5>\r\n          <ul class=\"list-unstyled\">\r\n            <li class=\"mb-2\">\r\n              <i class=\"fas fa-map-marker-alt me-2\"></i>\r\n              <span class=\"text-muted\">Santiago, Chile</span>\r\n            </li>\r\n            <li class=\"mb-2\">\r\n              <i class=\"fas fa-phone me-2\"></i>\r\n              <span class=\"text-muted\">+56 2 2345 6789</span>\r\n            </li>\r\n            <li>\r\n              <i class=\"fas fa-envelope me-2\"></i>\r\n              <span class=\"text-muted\">contacto@ferremas.cl</span>\r\n            </li>\r\n          </ul>\r\n        </div>\r\n      </div>\r\n      <hr class=\"my-4 bg-secondary\">\r\n      <div class=\"row\">\r\n        <div class=\"col text-center text-muted\">\r\n          <p class=\"mb-0\">© 2025 FERREMAS. Todos los derechos reservados.</p>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </footer>\r\n\r\n  <!-- Scripts -->\r\n  <script src=\"https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js\"></script>\r\n  <script src=\"/js/auth.js\"></script>\r\n  <script src=\"/js/profile.js\"></script>\r\n</body>\r\n</html>",
      "register.html": "<!DOCTYPE html>\r\n<html lang=\"es\">\r\n<head>\r\n  <meta charset=\"UTF-8\">\r\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\r\n  <title>Registro | FERREMAS</title>\r\n  <link href=\"https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css\" rel=\"stylesheet\">\r\n  <link rel=\"stylesheet\" href=\"https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css\" />\r\n  <link rel=\"stylesheet\" href=\"/styles.css\">\r\n</head>\r\n<body>\r\n  <!-- Barra superior -->\r\n  <div class=\"bg-dark text-white py-2\">\r\n    <div class=\"container d-flex justify-content-between align-items-center\">\r\n      <small>Envío gratuito en compras sobre $50.000</small>\r\n      <div>\r\n        <small class=\"me-3\">\r\n          <i class=\"fas fa-home me-1\"></i>\r\n          Santiago, Chile\r\n        </small>\r\n        <small>\r\n          <i class=\"fas fa-phone me-1\"></i>+56 2 2345 6789\r\n        </small>\r\n      </div>\r\n    </div>\r\n  </div>\r\n\r\n  <!-- Navbar -->\r\n  <nav class=\"navbar navbar-expand-lg navbar-dark bg-primary py-3\">\r\n    <div class=\"container\">\r\n      <a class=\"navbar-brand\" href=\"/\">\r\n        <img src=\"https://placehold.co/150x50/primary/white?text=FERREMAS\" alt=\"FERREMAS\" height=\"40\">\r\n      </a>\r\n      <button class=\"navbar-toggler\" type=\"button\" data-bs-toggle=\"collapse\" data-bs-target=\"#navbarNav\">\r\n        <span class=\"navbar-toggler-icon\"></span>\r\n      </button>\r\n      <div class=\"collapse navbar-collapse\" id=\"navbarNav\">\r\n        <ul class=\"navbar-nav me-auto\">\r\n          <li class=\"nav-item\">\r\n            <a class=\"nav-link mx-2\" href=\"/\">Inicio</a>\r\n          </li>\r\n          <li class=\"nav-item dropdown\">\r\n            <a class=\"nav-link dropdown-toggle mx-2\" href=\"#\" role=\"button\" data-bs-toggle=\"dropdown\">\r\n              Categorías\r\n            </a>\r\n            <ul class=\"dropdown-menu\">\r\n              <li><a class=\"dropdown-item\" href=\"/categoria/herramientas\">Herramientas</a></li>\r\n              <li><a class=\"dropdown-item\" href=\"/categoria/materiales\">Materiales de Construcción</a></li>\r\n              <li><a class=\"dropdown-item\" href=\"/categoria/seguridad\">Equipos de Seguridad</a></li>\r\n              <li><hr class=\"dropdown-divider\"></li>\r\n              <li><a class=\"dropdown-item\" href=\"/productos\">Ver todos los productos</a></li>\r\n            </ul>\r\n          </li>\r\n          <li class=\"nav-item\">\r\n            <a class=\"nav-link mx-2\" href=\"/ofertas\">Ofertas</a>\r\n          </li>\r\n          <li class=\"nav-item\">\r\n            <a class=\"nav-link mx-2\" href=\"/contacto\">Contacto</a>\r\n          </li>\r\n        </ul>\r\n        <ul class=\"navbar-nav ms-auto\">\r\n          <li class=\"nav-item\">\r\n            <a class=\"nav-link mx-2\" href=\"/carrito\" id=\"cart-link\">\r\n              <i class=\"fas fa-shopping-cart me-1\"></i> Carrito\r\n            </a>\r\n          </li>\r\n          <li class=\"nav-item active\">\r\n            <a class=\"nav-link mx-2\" href=\"/login\">\r\n              <i class=\"fas fa-user me-1\"></i> Iniciar Sesión\r\n            </a>\r\n          </li>\r\n        </ul>\r\n      </div>\r\n    </div>\r\n  </nav>\r\n\r\n  <div class=\"container my-5\">\r\n    <div class=\"row justify-content-center\">\r\n      <div class=\"col-md-8\">\r\n        <div class=\"card shadow\">\r\n          <div class=\"card-body p-5\">\r\n            <h2 class=\"text-center mb-4\">Crear Cuenta</h2>\r\n            <div id=\"error-message\" class=\"alert alert-danger d-none\"></div>\r\n            \r\n            <form id=\"register-form\">\r\n              <div class=\"row\">\r\n                <div class=\"col-md-6 mb-3\">\r\n                  <label for=\"nombre\" class=\"form-label\">Nombre</label>\r\n                  <input type=\"text\" class=\"form-control\" id=\"nombre\" required>\r\n                </div>\r\n                <div class=\"col-md-6 mb-3\">\r\n                  <label for=\"apellido\" class=\"form-label\">Apellido</label>\r\n                  <input type=\"text\" class=\"form-control\" id=\"apellido\">\r\n                </div>\r\n              </div>\r\n              \r\n              <div class=\"mb-3\">\r\n                <label for=\"rut\" class=\"form-label\">RUT (opcional)</label>\r\n                <input type=\"text\" class=\"form-control\" id=\"rut\">\r\n              </div>\r\n              \r\n              <div class=\"mb-3\">\r\n                <label for=\"email\" class=\"form-label\">Correo Electrónico</label>\r\n                <input type=\"email\" class=\"form-control\" id=\"email\" required>\r\n              </div>\r\n              \r\n              <div class=\"mb-3\">\r\n                <label for=\"telefono\" class=\"form-label\">Teléfono</label>\r\n                <input type=\"tel\" class=\"form-control\" id=\"telefono\">\r\n              </div>\r\n              \r\n              <div class=\"row\">\r\n                <div class=\"col-md-6 mb-3\">\r\n                  <label for=\"password\" class=\"form-label\">Contraseña</label>\r\n                  <input type=\"password\" class=\"form-control\" id=\"password\" required>\r\n                </div>\r\n                <div class=\"col-md-6 mb-3\">\r\n                  <label for=\"password-confirm\" class=\"form-label\">Confirmar Contraseña</label>\r\n                  <input type=\"password\" class=\"form-control\" id=\"password-confirm\" required>\r\n                </div>\r\n              </div>\r\n              \r\n              <h4 class=\"mt-4 mb-3\">Dirección (opcional)</h4>\r\n              \r\n              <div class=\"mb-3\">\r\n                <label for=\"direccion\" class=\"form-label\">Dirección</label>\r\n                <input type=\"text\" class=\"form-control\" id=\"direccion\">\r\n              </div>\r\n              \r\n              <div class=\"row\">\r\n                <div class=\"col-md-4 mb-3\">\r\n                  <label for=\"comuna\" class=\"form-label\">Comuna</label>\r\n                  <input type=\"text\" class=\"form-control\" id=\"comuna\">\r\n                </div>\r\n                <div class=\"col-md-4 mb-3\">\r\n                  <label for=\"ciudad\" class=\"form-label\">Ciudad</label>\r\n                  <input type=\"text\" class=\"form-control\" id=\"ciudad\">\r\n                </div>\r\n                <div class=\"col-md-4 mb-3\">\r\n                  <label for=\"region\" class=\"form-label\">Región</label>\r\n                  <input type=\"text\" class=\"form-control\" id=\"region\">\r\n                </div>\r\n              </div>\r\n              \r\n              <div class=\"mb-3 form-check\">\r\n                <input type=\"checkbox\" class=\"form-check-input\" id=\"accept-terms\" required>\r\n                <label class=\"form-check-label\" for=\"accept-terms\">Acepto los <a href=\"/terminos-condiciones\">términos y condiciones</a></label>\r\n              </div>\r\n              \r\n              <div class=\"d-grid gap-2\">\r\n                <button type=\"submit\" class=\"btn btn-primary\">Registrarme</button>\r\n              </div>\r\n            </form>\r\n            \r\n            <hr class=\"my-4\">\r\n            \r\n            <div class=\"text-center\">\r\n              <p>¿Ya tienes una cuenta? <a href=\"/login\">Inicia Sesión</a></p>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n\r\n  <!-- Footer -->\r\n  <footer class=\"bg-dark text-light py-4 mt-5\">\r\n    <div class=\"container\">\r\n      <div class=\"row\">\r\n        <div class=\"col-md-4 mb-4 mb-md-0\">\r\n          <h5>FERREMAS</h5>\r\n          <p class=\"text-muted\">\r\n            Empresa chilena de productos de ferretería y construcción, \r\n            establecida desde la década de los 80 con más de 7 sucursales \r\n            en todo el país.\r\n          </p>\r\n        </div>\r\n        <div class=\"col-md-3 mb-4 mb-md-0\">\r\n          <h5>Enlaces Rápidos</h5>\r\n          <ul class=\"list-unstyled\">\r\n            <li><a href=\"/\" class=\"text-muted\">Inicio</a></li>\r\n            <li><a href=\"/productos\" class=\"text-muted\">Productos</a></li>\r\n            <li><a href=\"/ofertas\" class=\"text-muted\">Ofertas</a></li>\r\n            <li><a href=\"/contacto\" class=\"text-muted\">Contacto</a></li>\r\n          </ul>\r\n        </div>\r\n        <div class=\"col-md-3 mb-4 mb-md-0\">\r\n          <h5>Categorías</h5>\r\n          <ul class=\"list-unstyled\">\r\n            <li><a href=\"/categoria/herramientas\" class=\"text-muted\">Herramientas</a></li>\r\n            <li><a href=\"/categoria/materiales\" class=\"text-muted\">Materiales</a></li>\r\n            <li><a href=\"/categoria/seguridad\" class=\"text-muted\">Seguridad</a></li>\r\n            <li><a href=\"/categoria/accesorios\" class=\"text-muted\">Accesorios</a></li>\r\n          </ul>\r\n        </div>\r\n        <div class=\"col-md-2\">\r\n          <h5>Contacto</h5>\r\n          <ul class=\"list-unstyled\">\r\n            <li class=\"mb-2\">\r\n              <i class=\"fas fa-map-marker-alt me-2\"></i>\r\n              <span class=\"text-muted\">Santiago, Chile</span>\r\n            </li>\r\n            <li class=\"mb-2\">\r\n              <i class=\"fas fa-phone me-2\"></i>\r\n              <span class=\"text-muted\">+56 2 2345 6789</span>\r\n            </li>\r\n            <li>\r\n              <i class=\"fas fa-envelope me-2\"></i>\r\n              <span class=\"text-muted\">contacto@ferremas.cl</span>\r\n            </li>\r\n          </ul>\r\n        </div>\r\n      </div>\r\n      <hr class=\"my-4 bg-secondary\">\r\n      <div class=\"row\">\r\n        <div class=\"col text-center text-muted\">\r\n          <p class=\"mb-0\">© 2025 FERREMAS. Todos los derechos reservados.</p>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </footer>\r\n\r\n  <!-- Scripts -->\r\n  <script src=\"https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js\"></script>\r\n  <script src=\"/js/auth.js\"></script>\r\n  <script src=\"/js/register.js\"></script>\r\n</body>\r\n</html>",
      "reset-password.html": "<!DOCTYPE html>\r\n<html lang=\"es\">\r\n<head>\r\n  <meta charset=\"UTF-8\">\r\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\r\n  <title>Restablecer Contraseña | FERREMAS</title>\r\n  <link href=\"https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css\" rel=\"stylesheet\">\r\n  <link rel=\"stylesheet\" href=\"https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css\" />\r\n  <link rel=\"stylesheet\" href=\"/styles.css\">\r\n</head>\r\n<body>\r\n  <!-- Barra superior -->\r\n  <div class=\"bg-dark text-white py-2\">\r\n    <div class=\"container d-flex justify-content-between align-items-center\">\r\n      <small>Envío gratuito en compras sobre $50.000</small>\r\n      <div>\r\n        <small class=\"me-3\">\r\n          <i class=\"fas fa-home me-1\"></i>\r\n          Santiago, Chile\r\n        </small>\r\n        <small>\r\n          <i class=\"fas fa-phone me-1\"></i>+56 2 2345 6789\r\n        </small>\r\n      </div>\r\n    </div>\r\n  </div>\r\n\r\n  <!-- Navbar -->\r\n  <nav class=\"navbar navbar-expand-lg navbar-dark bg-primary py-3\">\r\n    <div class=\"container\">\r\n      <a class=\"navbar-brand\" href=\"/\">\r\n        <img src=\"https://placehold.co/150x50/primary/white?text=FERREMAS\" alt=\"FERREMAS\" height=\"40\">\r\n      </a>\r\n      <button class=\"navbar-toggler\" type=\"button\" data-bs-toggle=\"collapse\" data-bs-target=\"#navbarNav\">\r\n        <span class=\"navbar-toggler-icon\"></span>\r\n      </button>\r\n      <div class=\"collapse navbar-collapse\" id=\"navbarNav\">\r\n        <ul class=\"navbar-nav me-auto\">\r\n          <li class=\"nav-item\">\r\n            <a class=\"nav-link mx-2\" href=\"/\">Inicio</a>\r\n          </li>\r\n          <li class=\"nav-item dropdown\">\r\n            <a class=\"nav-link dropdown-toggle mx-2\" href=\"#\" role=\"button\" data-bs-toggle=\"dropdown\">\r\n              Categorías\r\n            </a>\r\n            <ul class=\"dropdown-menu\"><li><a class=\"dropdown-item\" href=\"/categoria/herramientas\">Herramientas</a></li>\r\n              <li><a class=\"dropdown-item\" href=\"/categoria/materiales\">Materiales de Construcción</a></li>\r\n              <li><a class=\"dropdown-item\" href=\"/categoria/seguridad\">Equipos de Seguridad</a></li>\r\n              <li><hr class=\"dropdown-divider\"></li>\r\n              <li><a class=\"dropdown-item\" href=\"/productos\">Ver todos los productos</a></li>\r\n            </ul>\r\n          </li>\r\n          <li class=\"nav-item\">\r\n            <a class=\"nav-link mx-2\" href=\"/ofertas\">Ofertas</a>\r\n          </li>\r\n          <li class=\"nav-item\">\r\n            <a class=\"nav-link mx-2\" href=\"/contacto\">Contacto</a>\r\n          </li>\r\n        </ul>\r\n        <ul class=\"navbar-nav ms-auto\">\r\n          <li class=\"nav-item\">\r\n            <a class=\"nav-link mx-2\" href=\"/carrito\" id=\"cart-link\">\r\n              <i class=\"fas fa-shopping-cart me-1\"></i> Carrito\r\n            </a>\r\n          </li>\r\n          <li class=\"nav-item active\">\r\n            <a class=\"nav-link mx-2\" href=\"/login\">\r\n              <i class=\"fas fa-user me-1\"></i> Iniciar Sesión\r\n            </a>\r\n          </li>\r\n        </ul>\r\n      </div>\r\n    </div>\r\n  </nav>\r\n\r\n  <div class=\"container my-5\">\r\n    <div class=\"row justify-content-center\">\r\n      <div class=\"col-md-6\">\r\n        <div class=\"card shadow\">\r\n          <div class=\"card-body p-5\">\r\n            <h2 class=\"text-center mb-4\">Restablecer Contraseña</h2>\r\n            <div id=\"error-message\" class=\"alert alert-danger d-none\"></div>\r\n            <div id=\"success-message\" class=\"alert alert-success d-none\">Contraseña actualizada correctamente. <a href=\"/login\">Iniciar sesión</a></div>\r\n            \r\n            <p class=\"text-muted mb-4\">Establece una nueva contraseña para tu cuenta.</p>\r\n            \r\n            <form id=\"reset-password-form\">\r\n              <input type=\"hidden\" id=\"token\">\r\n              \r\n              <div class=\"mb-3\">\r\n                <label for=\"new-password\" class=\"form-label\">Nueva Contraseña</label>\r\n                <input type=\"password\" class=\"form-control\" id=\"new-password\" required>\r\n              </div>\r\n              \r\n              <div class=\"mb-3\">\r\n                <label for=\"confirm-password\" class=\"form-label\">Confirmar Contraseña</label>\r\n                <input type=\"password\" class=\"form-control\" id=\"confirm-password\" required>\r\n              </div>\r\n              \r\n              <div class=\"d-grid gap-2\">\r\n                <button type=\"submit\" class=\"btn btn-primary\">Cambiar Contraseña</button>\r\n              </div>\r\n            </form>\r\n            \r\n            <hr class=\"my-4\">\r\n            \r\n            <div class=\"text-center\">\r\n              <p>¿Recordaste tu contraseña? <a href=\"/login\">Volver a Iniciar Sesión</a></p>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n\r\n  <!-- Footer -->\r\n  <footer class=\"bg-dark text-light py-4 mt-5\">\r\n    <div class=\"container\">\r\n      <div class=\"row\">\r\n        <div class=\"col-md-4 mb-4 mb-md-0\">\r\n          <h5>FERREMAS</h5>\r\n          <p class=\"text-muted\">\r\n            Empresa chilena de productos de ferretería y construcción, \r\n            establecida desde la década de los 80 con más de 7 sucursales \r\n            en todo el país.\r\n          </p>\r\n        </div>\r\n        <div class=\"col-md-3 mb-4 mb-md-0\">\r\n          <h5>Enlaces Rápidos</h5>\r\n          <ul class=\"list-unstyled\">\r\n            <li><a href=\"/\" class=\"text-muted\">Inicio</a></li>\r\n            <li><a href=\"/productos\" class=\"text-muted\">Productos</a></li>\r\n            <li><a href=\"/ofertas\" class=\"text-muted\">Ofertas</a></li>\r\n            <li><a href=\"/contacto\" class=\"text-muted\">Contacto</a></li>\r\n          </ul>\r\n        </div>\r\n        <div class=\"col-md-3 mb-4 mb-md-0\">\r\n          <h5>Categorías</h5>\r\n          <ul class=\"list-unstyled\">\r\n            <li><a href=\"/categoria/herramientas\" class=\"text-muted\">Herramientas</a></li>\r\n            <li><a href=\"/categoria/materiales\" class=\"text-muted\">Materiales</a></li>\r\n            <li><a href=\"/categoria/seguridad\" class=\"text-muted\">Seguridad</a></li>\r\n            <li><a href=\"/categoria/accesorios\" class=\"text-muted\">Accesorios</a></li>\r\n          </ul>\r\n        </div>\r\n        <div class=\"col-md-2\">\r\n          <h5>Contacto</h5>\r\n          <ul class=\"list-unstyled\">\r\n            <li class=\"mb-2\">\r\n              <i class=\"fas fa-map-marker-alt me-2\"></i>\r\n              <span class=\"text-muted\">Santiago, Chile</span>\r\n            </li>\r\n            <li class=\"mb-2\">\r\n              <i class=\"fas fa-phone me-2\"></i>\r\n              <span class=\"text-muted\">+56 2 2345 6789</span>\r\n            </li>\r\n            <li>\r\n              <i class=\"fas fa-envelope me-2\"></i>\r\n              <span class=\"text-muted\">contacto@ferremas.cl</span>\r\n            </li>\r\n          </ul>\r\n        </div>\r\n      </div>\r\n      <hr class=\"my-4 bg-secondary\">\r\n      <div class=\"row\">\r\n        <div class=\"col text-center text-muted\">\r\n          <p class=\"mb-0\">© 2025 FERREMAS. Todos los derechos reservados.</p>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </footer>\r\n\r\n  <!-- Scripts -->\r\n  <script src=\"https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js\"></script>\r\n  <script src=\"/js/auth.js\"></script>\r\n  <script src=\"/js/reset-password.js\"></script>\r\n</body>\r\n</html>"
    },
    "script.js": "document.addEventListener('DOMContentLoaded', function() {\r\n  // Inicializar tooltips\r\n  var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle=\"tooltip\"]'))\r\n  var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {\r\n    return new bootstrap.Tooltip(tooltipTriggerEl)\r\n  });\r\n\r\n  // Inicializar el carrusel\r\n  var myCarousel = new bootstrap.Carousel(document.getElementById('mainCarousel'), {\r\n    interval: 5000\r\n  });\r\n  \r\n  // Inicializar funcionalidad de carrito\r\n  inicializarCarrito();\r\n});\r\n\r\n// Función para agregar al carrito\r\nfunction agregarAlCarrito(id, nombre, precio, imagen) {\r\n  let carrito = JSON.parse(localStorage.getItem('carrito')) || [];\r\n  \r\n  // Verificar si el producto ya está en el carrito\r\n  const productoEnCarrito = carrito.find(item => item.id === id);\r\n  \r\n  if (productoEnCarrito) {\r\n    // Actualizar cantidad si ya existe\r\n    productoEnCarrito.cantidad += 1;\r\n  } else {\r\n    // Agregar nuevo producto al carrito\r\n    carrito.push({\r\n      id,\r\n      nombre,\r\n      precio,\r\n      imagen: imagen || `https://placehold.co/300x200/007bff/white?text=${encodeURIComponent(nombre)}`,\r\n      cantidad: 1\r\n    });\r\n  }\r\n  \r\n  // Guardar carrito en localStorage\r\n  localStorage.setItem('carrito', JSON.stringify(carrito));\r\n  \r\n  // Mostrar notificación\r\n  mostrarNotificacion(`${nombre} añadido al carrito`);\r\n  \r\n  // Actualizar contador de carrito\r\n  actualizarContadorCarrito();\r\n}\r\n\r\n// Función para mostrar notificación\r\nfunction mostrarNotificacion(mensaje) {\r\n  // Crear elemento de notificación\r\n  const notificacion = document.createElement('div');\r\n  notificacion.className = 'toast align-items-center text-white bg-success';\r\n  notificacion.setAttribute('role', 'alert');\r\n  notificacion.setAttribute('aria-live', 'assertive');\r\n  notificacion.setAttribute('aria-atomic', 'true');\r\n  notificacion.innerHTML = `\r\n    <div class=\"d-flex\">\r\n      <div class=\"toast-body\">\r\n        ${mensaje}\r\n      </div>\r\n      <button type=\"button\" class=\"btn-close btn-close-white me-2 m-auto\" data-bs-dismiss=\"toast\" aria-label=\"Close\"></button>\r\n    </div>\r\n  `;\r\n  \r\n  // Crear contenedor si no existe\r\n  let toastContainer = document.querySelector('.toast-container');\r\n  if (!toastContainer) {\r\n    toastContainer = document.createElement('div');\r\n    toastContainer.className = 'toast-container position-fixed bottom-0 end-0 p-3';\r\n    document.body.appendChild(toastContainer);\r\n  }\r\n  \r\n  // Agregar notificación al contenedor\r\n  toastContainer.appendChild(notificacion);\r\n  \r\n  // Mostrar notificación\r\n  const toast = new bootstrap.Toast(notificacion);\r\n  toast.show();\r\n  \r\n  // Eliminar notificación después de ocultarse\r\n  notificacion.addEventListener('hidden.bs.toast', function() {\r\n    notificacion.remove();\r\n  });\r\n}\r\n\r\n// Función para actualizar contador de carrito\r\nfunction actualizarContadorCarrito() {\r\n  const carrito = JSON.parse(localStorage.getItem('carrito')) || [];\r\n  const totalItems = carrito.reduce((total, item) => total + item.cantidad, 0);\r\n  \r\n  // Buscar o crear el badge\r\n  let cartBadge = document.querySelector('#cart-badge');\r\n  \r\n  if (totalItems > 0) {\r\n    if (!cartBadge) {\r\n      // Crear badge si no existe\r\n      cartBadge = document.createElement('span');\r\n      cartBadge.id = 'cart-badge';\r\n      cartBadge.className = 'position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger';\r\n      cartBadge.style.fontSize = '0.6rem';\r\n      \r\n      const cartLink = document.querySelector('#cart-link');\r\n      cartLink.style.position = 'relative';\r\n      cartLink.appendChild(cartBadge);\r\n    }\r\n    \r\n    cartBadge.textContent = totalItems;\r\n  } else if (cartBadge) {\r\n    // Eliminar badge si el carrito está vacío\r\n    cartBadge.remove();\r\n  }\r\n}\r\n\r\n// Función para inicializar carrito\r\nfunction inicializarCarrito() {\r\n  // Agregar listener a todos los botones de \"Agregar al Carrito\"\r\n  const botonesAgregar = document.querySelectorAll('.card .btn-primary');\r\n  \r\n  botonesAgregar.forEach(boton => {\r\n    boton.addEventListener('click', function(e) {\r\n      const card = this.closest('.card');\r\n      const id = card.dataset.id || Math.random().toString(36).substring(2, 15);\r\n      const nombre = card.querySelector('.card-title').textContent;\r\n      const precioText = card.querySelector('.card-text.text-danger').textContent;\r\n      const precio = parseInt(precioText.replace(/\\D/g, ''));\r\n      const imagen = card.querySelector('.card-img-top').src;\r\n      \r\n      agregarAlCarrito(id, nombre, precio, imagen);\r\n    });\r\n  });\r\n  \r\n  // Actualizar contador de carrito al cargar la página\r\n  actualizarContadorCarrito();\r\n}",
    "styles.css": "/* Estilos generales */\r\nbody {\r\n  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;\r\n}\r\n\r\n/* Carousel */\r\n.carousel-item img {\r\n  height: 400px;\r\n  object-fit: cover;\r\n}\r\n\r\n.carousel-caption {\r\n  background-color: rgba(0, 0, 0, 0.5);\r\n  padding: 20px;\r\n  border-radius: 5px;\r\n}\r\n\r\n/* Cards */\r\n.card {\r\n  transition: transform 0.3s, box-shadow 0.3s;\r\n}\r\n\r\n.card:hover {\r\n  transform: translateY(-5px);\r\n  box-shadow: 0 10px 20px rgba(0,0,0,0.1);\r\n}\r\n\r\n.card-img-top {\r\n  height: 200px;\r\n  object-fit: cover;\r\n}\r\n\r\n/* Badge para el carrito */\r\n#cart-link {\r\n  position: relative;\r\n}\r\n\r\n#cart-badge {\r\n  font-size: 0.6rem;\r\n}\r\n\r\n/* Página de perfil */\r\n.nav-pills .nav-link.active {\r\n  background-color: #0d6efd;\r\n}\r\n\r\n.tab-pane {\r\n  padding-top: 1rem;\r\n}\r\n\r\n/* Direcciones */\r\n.card.border-primary {\r\n  border-width: 2px;\r\n}\r\n\r\n/* Responsive adjustments */\r\n@media (max-width: 768px) {\r\n  .carousel-item img {\r\n    height: 250px;\r\n  }\r\n  \r\n  .card-img-top {\r\n    height: 180px;\r\n  }\r\n}"
  }
}